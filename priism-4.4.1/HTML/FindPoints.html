<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Priism Help: FindPoints</title>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Description" content="Very incomplete on-line help for FindPoints.">
   <meta name="Keywords" content="Priism,modeling,masking">
   <meta name="GENERATOR" content="Mozilla/4.7 [en] (X11; I; IRIX 6.3 IP32) [Netscape]">
   <LINK REV=MADE HREF="mailto:ive@msg.ucsf.edu">
</head>
<body>
<h1><a NAME="FindPoints">FindPoints</a></h1>

<h2>Overview</h2>
<P>FindPoints searches a data set for peaks which exceed a threshold set in
terms of an estimate of the data's standard deviation and mean. You can
instruct the search process to automatically lower this threshold until
a minimum number of points is found. To further constrain the search, you
can load polygon data (typically from
<a href="EditPolygon.html">EditPolygon</a>)
and either have FindPoints assemble the polygons into volumes (objects)
of interest or load an old-style object list from <a href="VolumeBuilder.html">VolumeBuilder</a>.
<p>Once FindPoints has identified the peaks, you can also have it use the
peaks as the starting point for region growing or for measurements of the
points' intensity and their interrelationships.
<h3>Topics</h3>
<P>Overview | <a href="#image_data">Image data</a> | <a href="#3DObjects">3D
objects</a> | <a href="#process">Process mode</a> | <a href="#pick_mode">Image
windows</a> | <a href="#statistics">Statistics</a> | <a href="#peak_finding">Peak
finding</a> | <a href="#region_growing">Region growing</a> | <a href="#submit">Submit
to queue</a> | <a href="#output">Results</a> | <a href="#loop">Looping</a>
| <a href="#defaults">Defaults</a>
<h3>Related Priism Topics</h3>
<P><a href="Priism.html">Priism</a> | <a href="EditPolygon.html">EditPolygon</a>
| <a href="VolumeBuilder.html">VolumeBuilder</a>
<hr>
<h2><a NAME="image_data">Image Data</a></h2>
<P>FindPoints requires either a Priism image file or window to determine the
intensity at each volume element. If you use an image window, you can add
or delete points found or select objects of interest using the right mouse
button. See the section on <a href="#pick_mode">picking</a> for more details.
<p>You can set which two dimensional cross-sections of the data set are
used with the <a NAME="Z">Z</a>, <a NAME="T">T</a>, and <a NAME="W">W</a>
controls on the main FindPoints dialog. For the z direction and time, the
controls show the first section used, the maximum possible value for the
last section used, and the amount by which the section index is adjusted
when moving to an adjacent section whose data is used. Toggles allow you
to set which wavelengths are used.
<h3>Topics</h3>
<P><a href="#FindPoints">Overview</a> | Image data | <a href="#3DObjects">3D
objects</a> | <a href="#pick_mode">Picking</a> | <a href="#statistics">Statistics</a>
| <a href="#peak_finding">Peak finding</a> | <a href="#region_growing">Region
growing</a> | <a href="#submit">Submit to queue</a> | <a href="#output">Results</a>
| <a href="#loop">Looping</a>
<hr>
<h2><a NAME="3DObjects">3D Objects</a></h2>
<P>You can constrain FindPoints' operations by specifying volumes of interest
(objects). To do so, you need to supply FindPoints with polygon data that
represents cross-sections through the volumes; this data can either be
in a file or, if you are working with an image window, the polygon data
that has already been loaded into that window.
<a href="EditPolygon.html">EditPolygon</a>
can be used to generate either of these sources of data.
<p>After loading the polygon data, it needs to be assembled into volumes.
FindPoints can do this assembling for you if you press the <EM>Create</EM>
button. When you do so, FindPoints works through the sections examining
polygons in nearby sections; based on the amount of overlapping area, it
associates those polygons into volumes. To limit what FindPoints considers
a nearby section, set the <a NAME="gap">max z gap</a>; i.e.
if you use a gap of 1, a polygon from section six in z can not be associated
with a polygon in section eight unless there is a polygon in section seven
which can be associated with the polygon in section six and the one in
section eight.
<p>The other option for assembling the polygons into volumes is to enter
a filename into the object file field. The polygon file must already be
loaded before entering this file name. The object file is an an existing
file which specifies how the polygons are grouped.
<a href="VolumeBuilder.html">VolumeBuilder</a> can be used to generate this
file (it must be in the <EM>old-style</EM> format).
<h3>Topics</h3>
<P><a href="#FindPoints">Overview</a> | <a href="#image_data">Image data</a>
| 3D objects | <a href="#pick_mode">Picking</a> | <a href="#statistics">Statistics</a>
| <a href="#peak_finding">Peak finding</a> | <a href="#region_growing">Region
growing</a> | <a href="#submit">Submit to queue</a> | <a href="#output">Results</a>
| <a href="#loop">Looping</a>
<hr>
<h2><a NAME="process">Process Mode</a></h2>
<P>There are three modes for analyzing data with FindPoints. This setting
will affect what portion of the data set will be used for the histogram
statistics, peak finding and region growing.
<p>Entire Data Set : is always used when there are no 3D objects. it can
also be used when the data is broken down into 3D objects and all of the
objects are to be processed at once. If region growing is done in this
mode, the output mask data for all the objects will be written out to one
image file, the size of the original data set.
<p>Separate Objects: also processes all the objects in one run, but
in region growing, a separate output mask file is written out for each
object. In this case, the names of the files are the entered name, plus
"-<VAR>num</VAR>", where <VAR>num</VAR> is the number of the object.  This
mode is helpful in speeding up the run time when a huge file is being
processed, since breaking it down into smaller regions for processing will
take up less memory.
<p>Current Object: when there are 3D objects, a single object can be viewed
in the histogram and the best set of parameters can be determined on a
small region before processing the rest of the objects. When in this
mode, either enter the object to analyze in the Current Wave, Time, Obj
field or use the mouse to select the object in the window. See <a href="#pick_mode">Picking</a>.
<p><a href="#FindPoints">Overview</a> | <a href="#image_data">Image data</a>
| <a href="#3DObjects">3D objects</a> | <a href="#pick_mode">Picking</a>
| <a href="#statistics">Statistics</a> | <a href="#peak_finding">Peak finding</a>
| <a href="#region_growing">Region growing</a> | <a href="#submit">Submit
to queue</a> | <a href="#output">Results</a> | <a href="#loop">Looping</a>
<hr>
<h2><a NAME="pick_mode">Picking</a></h2>
The mouse can be used to pick in the image for one of three reasons:
<p>Select Object: when there are 3D Objects loaded, the current object
can be selected by clicking inside the object. The current object is only
meaningful when the process mode is set to current object. When the object
is selected, the polygons will turn blue and the Current Wave, Time, Obj
field should update to the current object.
<p>delete pts: in this mode, existing points can be deleted by clicking
on them with the mouse
<p>add pts: Points can be manually selected with the mouse. When this is
done, the peak intensity in the local region is found. The local region
is defined in using the search range fields in the peak finding menu. The
box size is (2x + 1) of the search range. The point is then refined to
the local center of mass if the <EM>Point Pos</EM> pulldown in the peak finding
menu is set to <EM>Local COM</EM> or <EM>Local COM - Background</EM>.
See <A HREF="#peak_finding">Peak finding</A> for more info on how the local
center of mass is calculated.
<h3>Topics</h3>
<P><a href="#FindPoints">Overview</a> | <a href="#image_data">Image data</a>
| <a href="#3DObjects">3D objects</a> | Image windows | <a href="#statistics">Statistics</a>
| <a href="#peak_finding">Peak finding</a> | <a href="#region_growing">Region
growing</a> | <a href="#submit">Submit to queue</a> | <a href="#output">Results</a>
| <a href="#loop">Looping</a>
<hr>
<h2><a NAME="statistics">Statistics</a></h2>
<P>The Histogram menu displays a histogram of the data being analyzed, and
shows three bars. The red bar is located at the mean of the intensities.
the pink bar shows where the regions growing threshold is currently set
and the white bar shows where the peak finding threshold is. The peak finding
and region growing bars can be dragged to the position that seems appropriate
according to the histogram. The value is reported as both threshold and
multiples of the standard deviation in the histogram menu.  Thresholds
in FindPoints are set based on an estimate of the mean and standard deviation
for the volume of interest.  <a NAME="method">Three different methods</a>
can be used to estimate the mean and standard deviation:
<dl>
<dt>curve fit
<dd>The mean and standard deviation are estimated by fitting a Gaussian to
the histogram of all the values in the volume of interest.

<dt>overall std
<dd>The mean and standard deviation is calculated using all data points in
the volume. These estimates are then iteratively refined five times by
not including points whose intensities are two standard deviations greater
than the mean.</dd>

<dt>dropoff std
<dd>The mean is taken as the center of the bin which is the peak in the
smoothed (over five counts) histogram.
</dl>

<dl>
<dd>
A fourth option is to just enter a threshold value directly. In this case,
no statistics are done on the data. When this pulldown is set to Absolute
thresholds, the peak finding and region growing menus' nstd input fields
will be used for input of the threshold instead.</dd>
</dl>

<h3>Topics</h3>
<P><a href="#FindPoints">Overview</a> | <a href="#image_data">Image data</a>
| <a href="#3DObjects">3D objects</a> | <a href="#pick_mode">Picking</a>
| Statistics | <a href="#peak_finding">Peak finding</a> | <a href="#region_growing">Region
growing</a> | <a href="#submit">Submit to queue</a> | <a href="#output">Results</a>
| <a href="#loop">Looping</a>
<hr>
<h2><a NAME="peak_finding">Peak Finding</a></h2>
<P>The automatic peak finding algorithm uses pixels above the
<EM>threshold</EM> value as starting positions for a local search for peaks.
The threshold value is entered as number of standard deviations, or absolute
threshold, depending on the Method setting in the main menu.
<p>Once the list of peaks is determined, there are several criteria used
to refine this list:
<UL>
  <LI><STRONG>min num pts</STRONG>.  If a minimum number
of points is set and the toggle to auto decrease the threshold is set,
the peak finding will be done over again, lowering the threshold by the
number of stds entered until the minimum number of peaks is found. (note
this function does not work if the absolute threshold is used instead of
nstd).
  <LI><STRONG>min pt separation</STRONG>.  If this value is set above 0,
    points will be eliminated if they are too close to a higher intensity
    point.
  <LI><STRONG>max num pts</STRONG>.  If the resulting number of points is
    greater than the entered max, then the lower intensity points are thrown
    out.
  <LI><STRONG>point position</STRONG>.  The final position for a peak can be
    one of four things:
      <DL>
        <DT>Peak<DD>The peak location is the center of the pixel with the
          peak intensity.
        <DT>Local COM<DD>The peak location is determined by the following
          steps:
          <OL>
            <LI>Determine the origin for the center of mass calculation.
              When the <EM>Search Range</EM> values in the dialog are zero,
              the origin is just the center of the pixel with the peak
              intensity.  Otherwise, a search is done by calculating the
              total intensity in boxes dimensioned 2 * xy search range + 1
              by 2 * xy search range + 1 by 2 * z search range by 1 whose
              centers are no more than xy search range pixels in x or y
              and z search range pixels in z from the peak pixel.  The
              center of the box with the largest total intensity is used
              as the origin for the center of mass calculation.
            <LI>Calculate the center of mass for a box with dimensions
              xy box size by xy box size by z box size which is centered
              at the origin determined in the first step.
            <LI>If the center of the nearest pixel to the calculated center
              of mass is not the origin, reset the origin to the center
              of the pixel closest to the center of mass.  Repeat the
              second and third steps.
          </OL>
        <DT>Local COM - Background<DD>Uses the same procedure as
          Local COM, but when calculating the center of mass, the
          minimum intensity value for the pixels used in the
          center of mass calculation is subtracted from the other
          intensity values before calculating the center of mass.
          This is a way of compensating for a slowly varying background
          that would otherwise tend to bias the position estimate
          towards the center of the box used for the center of mass
          calculation.  It may also help with errors in the position
          estimate caused by a box size that mildly truncates the tails
          of the peak.  When these sources of systematic error are
          not significant, the Local COM method will give less noisy
          estimates of the position.  If the box size substantially truncates
          the tails of the peak, both the Local COM and Local COM - background
          methods will have systematic errors and the Gaussian Fit option
          may give better results.
        <DT>Obj COM (reg grow)<DD>Until region growing is performed,
          the center of the pixel with the peak intensity is reported
          as the peak position.  Once region growing is run, the
          peak position is reported as the calculated center of mass
          from the region grown about the peak pixel.
        <DT>Gaussian fit<DD>Fits the intensity values in the neighborhood
          of the peak to determine the center.  The neighborhood is a
          box-shaped region with the dimensions shown in the
          <EM>COM/Fit Box</EM> fields.  In cases where the fit is unsuccessful,
          the Local COM method (without iteration to reset the origin) is
          used to determine the center.
      </DL>
</UL>
<h3>Topics</h3>
<P><a href="#FindPoints">Overview</a> | <a href="#image_data">Image data</a>
| <a href="#3DObjects">3D objects</a> | <a href="#pick_mode">Picking</a>
| <a href="#statistics">Statistics</a> | Peak finding | <a href="#region_growing">Region
growing</a> | <a href="#submit">Submit to queue</a> | <a href="#output">Results</a>
| <a href="#loop">Looping</a>
<hr>
<h2><a NAME="region_growing">Region Growing</a></h2>
<P>Region Growing starts from the points found with the peak finding or entered
points, and grows out through the data using one of the following criteria to
determine where to stop:

<DL>
  <DT>absolute intensity<DD>A region is grown until the intensity drops
    below the value shown in the threshold value field.  This option
    is only available when the method selected in the main Find Points
    dialog is "Absolute Thresholds".
  <DT>std. dev. from mean<DD>A region is grown until the intensity
    drops below the mean (background) level plus the threshold value
    field times the standard deviation.  The mean and standard deviation
    can be seen in the histogram dialog.  This option is only available
    when the method selected in the main FindPoints dialog is not
    "Absolute Thresholds".
  <DT>half peak value<DD>A region is grown until the intensity drops to
    halfway between the value at the peak (the seed for the region) and
    the mean (background) level.  This is equivalent to using the
    "fraction of peak - mean" option with the threshold value set to 0.5.
  <DT>fraction of peak - mean<DD>A region is grown until the
    intensity drops to the threshold value * (peak intensity - mean) + mean.
  <DT>fraction of peak<DD>A region is grown until the intensity drops
    to the threshold value times the peak intensity.
</DL>

<P>To further limit how the region grows, you may specify the following:

<DL>
  <DT>xyz range<DD>Regions are restricted to be within a box-shaped volume
    centered on the peak.  The dimensions, in pixels, of the box in
    x, y, and z are twice the first, second, and third values, respectively,
    shown in the "xyz range" field.
  <DT>stop at valleys<DD>Growth of the region is stopped when the intensity
    values are observed to increase at further distances from the peak.
</DL>

<P>After the regions are grown, those which contain fewer pixels than
the value shown in the "min pixels to accept point" field will be rejected.

<P>The region growing process may generate two image data sets (if you
use the "Separate Objects" processing mode in the Find Points dialog it
is two data sets per object; in this case, the data set names have a
dash and the number of the object appended).  If a file name or window
number is entered in the "Out Mask (opt)" field, a data set with that name
will be generated.  In it, the pixels that belong to a region will have
an intensity equal to the region's number (a positive integer); all other
pixels will have an intensity of zero.  If a file name or window number
is entered in the "Out Data (opt)" field, a data set with that name
will be generated.  In it, the pixels that belong to a region will have
the intensity value from the input data set; all other pixels will have
an intensity of zero.
<h3>Topics</h3>
<P><a href="#FindPoints">Overview</a> | <a href="#image_data">Image data</a>
| <a href="#3DObjects">3D objects</a> | <a href="#pick_mode">Picking</a>
| <a href="#statistics">Statistics</a> | <a href="#peak_finding">Peak finding</a>
| Region growing | <a href="#submit">Submit to queue</a> | <a href="#output">Results</a>
| <a href="#loop">Looping</a>
<hr>
<h2><a NAME="submit">Submit to queue</a></h2>
<P>Once parameters are chosen for the peaks finding and region growing, the
job can be submitted to queue. Currently, both peak finding and region
growing are run when FindPoints is run in batch mode, and the result is
written to a pick points format file.
<p><STRONG>Submit to queue</STRONG> - select the queue to run on; if
"Write script only" is selected, the command and parameter files will be
created but the calculations will not be started.
<p><STRONG>Command File</STRONG> - contains the environment setup and starts
FindPoints with the parameter file, directing output print statements to a
log file.
<p><STRONG>Parameter File</STRONG> - contains the parameters selected by the
user for the current run.
<p><STRONG>Output Pick File</STRONG> - point information will go to this file.
<p><STRONG>Log file</STRONG> - contains parameters used and tracks progress of
run
<h3>Topics</h3>
<P><a href="#FindPoints">Overview</a> | <a href="#image_data">Image data</a>
| <a href="#3DObjects">3D objects</a> | <a href="#pick_mode">Picking</a>
| <a href="#statistics">Statistics</a> | <a href="#peak_finding">Peak finding</a>
| <a href="#region_growing">Region growing</a> | Submit to queue | <a href="#output">Results</a>
| <a href="#loop">Looping</a>
<hr>
<h2><a NAME="output">Results</a></h2>
<P><STRONG>Save Pick Points Format</STRONG> - output in this format contains the following
information:
<br>&nbsp;&nbsp; Wave Time
<br>&nbsp;&nbsp;&nbsp; L BEAD # - 3DObject num. will be just 1 object if
no polygons used.
<br>&nbsp;&nbsp;&nbsp; mean, standard deviation and threshold used for
this object
<br>&nbsp;&nbsp;&nbsp; Point Info: x,y,z position, number, integrated intensity,
total npts in region grow
<p><STRONG>Load Pick Points Format</STRONG> - an existing point file can be
loaded back into FindPoints
<p>Pt Data in Columns, Save Point Info - these are old, and no longer supported
<p><STRONG>Show Point Info</STRONG> - a table of point info on the screen.
object num, point num, intensity.
<br>&nbsp; table only show info for 20 points at a time so buttons at bottom
let you look through
<br>&nbsp; all the points. top starts at the first object, first point.
next moves forward through the
<br>&nbsp; list, and back move backward through the list.
<h3>Topics</h3>
<P><a href="#FindPoints">Overview</a> | <a href="#image_data">Image data</a>
| <a href="#3DObjects">3D objects</a> | <a href="#pick_mode">Picking</a>
| <a href="#statistics">Statistics</a> | <a href="#peak_finding">Peak finding</a>
| <a href="#region_growing">Region growing</a> | <a href="#submit">Submit
to queue</a> | Results | <a href="#loop">Looping</a>
<hr>
<h2><a NAME="loop">Looping</a></h2>
<P>Looping lets you quickly test a range of thresholds for peak finding and/or
region growing to determine optimal parameters. The entire data set or
one single object can be tested depending on the setting of the process
mode pulldown in the main menu.
<p><STRONG>output pt list file</STRONG> - this is the name for the output pick
points file. point positions and integrated intensities are reported in
this file.
<p><STRONG>peak nstd start, inc</STRONG> - enter the starting multiple of the
standard deviation to use as the threshold for peak finding and the increment
multiple for the successive rounds. it makes the most sense to increment either
the peak finding or the region growing but usually not both at the same
time. set inc to zero to use the same peak finding threshold for each loop.
<p><STRONG>reg grow nstd start, inc</STRONG> - enter the starting multiple of
the standard deviation to use as the threshold for region growing and the
increment multiple for the successive rounds.
<p><STRONG>number of increments</STRONG> - the number of times to set a new
threshold and run peak finding and region growing.
<p><STRONG>Get Looped</STRONG> - do it.
<h3>Topics</h3>
<P><a href="#FindPoints">Overview</a> | <a href="#image_data">Image data</a>
| <a href="#3DObjects">3D objects</a> | <a href="#pick_mode">Picking</a>
| <a href="#statistics">Statistics</a> | <a href="#peak_finding">Peak finding</a>
| <a href="#region_growing">Region growing</a> | <a href="#submit">Submit
to queue</a> | <a href="#output">Results</a> | Looping
<hr>
<h2><a NAME="defaults">Defaults</a></h2>
Save Defaults - saves parameters on the main menu, peak finding and region
growing menus to a file in
<br>the .iveprefs directory. the file is called fp.par. filenames are not
saved to the defaults file.
<p>Load Defaults - loads the defaults parameters back in.
<h3>Topics</h3>
<P><a href="#FindPoints">Overview</a> | <a href="#image_data">Image data</a>
| <a href="#3DObjects">3D objects</a> | <a href="#pick_mode">Picking</a>
| <a href="#statistics">Statistics</a> | <a href="#peak_finding">Peak finding</a>
| <a href="#region_growing">Region growing</a> | <a href="#submit">Submit
to queue</a> | <a href="#output">Results</a> | <a href="#loop">Looping</a>
<hr>
</body>
</html>
