<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
  <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <TITLE>Priism Help: 2D Convolution</TITLE>
  <META NAME="Description" CONTENT="On-line help for 2D convolution application.">
  <META NAME="Keywords" CONTENT="Priism">
  <LINK REV=MADE HREF="mailto:ive@msg.ucsf.edu">
</HEAD>
<BODY>

<H1><A NAME="NewConvolution">2D Convolution</A></H1>
<H2>Overview</H2>

<P>This program convolves (replaces each value with a weighted sum
of the surrounding pixels) each section with a two-dimensional
kernel (the rectangular array of weights).  The kernel can be
chosen from a list of common kernels or can be loaded from a file;
in either case, the kernel can be interactively edited.  The
algorithm does not employ Fourier transforms, and pixels where
the summation would extend past the boundaries of the section
are assigned the value from the nearest pixel where the summation
completely fell within the section.

<H3>Topics</H3>
<P>
   Overview |
   <A HREF="Region.html">Dialog</A> |
   <A HREF="#KERNEL_CHOICE">Kernels</A> |
   <A HREF="#KERNEL_RESIZE">Size</A> |
   <A HREF="#KERNEL_FILE_FORMAT">Format</A> |

<H3>Related Priism Topics</H3>
<P>
   <A HREF="Priism.html">Priism</A> |
   <A HREF="ApplicationCategories.html">Categories</A> |
   <A HREF="Applications.html">Applications</A> |

<HR>

<H2><A NAME="KERNEL_CHOICE">Selecting a Kernel</A></H2>

<P>The text field next to this button shows the title of the
currently loaded kernel.  Use the pink button labeled "load
kernel" to access a menu to load one of the default kernels or
to load a kernel from file.  The green button labeled "view/edit
kernel" will open a dialog that allows you to manipulate the
current kernel.  With it, you can save the kernel to a file,
resize it, or change individual values (any changes to individual
values become effective immediately).

<H3>Topics</H3>
<P>
   <A HREF="#NewConvolution">Overview</A> |
   Kernels |
   <A HREF="Region.html">Dialog</A> |
   <A HREF="#KERNEL_RESIZE">Size</A> |
   <A HREF="#KERNEL_FILE_FORMAT">Format</A>
<HR>

<H2><A NAME="KERNEL_RESIZE">Resizing a Kernel</A></H2>

<P>To resize the kernel, first view the kernel using the "view/edit
kernel" button in the main dialog.  Then depress the "change
size/precision" button in the dialog that is opened.  The size
of the kernel is specified by the X and Y half-widths:  the
kernel has (2*x Half-width + 1) columns and (2*Y half-width + 1)
rows.  The decimal places field specifies how many decimal places
are shown on kernel values when the kernel is viewed or saved to
a file.  After changing the size and precision values, depress the
"apply" button to resize the kernel.  When the kernel is resized,
the center of the existing kernel is preserved.   Where the new
kernel extends beyond the old, zeroes are used to fill the
missing values.

<H3>Topics</H3>
<P>
   <A HREF="#NewConvolution">Overview</A> |
   <A HREF="Region.html">Dialog</A> |
   <A HREF="#KERNEL_CHOICE">Kernels</A> |
   Size |
   <A HREF="#KERNEL_FILE_FORMAT">Format</A>
<HR>

<H2><A NAME="KERNEL_FILE_FORMAT">Kernel File Format</A></H2>

<P>The file format used for kernels saved to file is
<PRE>
        &lt;title&gt;&lt;newline&gt;
        NX=&lt;int&gt;&lt;whitespace&gt;NY=&lt/int&gt;&lt;whitespace&gt;PREC=&lt;int&gt;&lt;newline&gt;
        &lt;float array&gt;
</PRE>
<P>The definitions of the individual components are
<PRE>
        &lt;title&gt;       100 or less characters
        &lt;int&gt;         a base 10 integer value
        &lt;whitespace&gt;  one or more tabs or spaces.
        &lt;float array&gt; consists of ny &lt;float lines&gt;
        &lt;float lines&gt; is nx floats separated by &lt;whitespace&gt;
</PRE>
<P>When the convolution is performed on a pixel, p, on a section, it
corresponds to the following operations with the array stored in
the file:
<OL> 
<LI>flip the array horizontally and then vertically center the flipped array
(the center of the flipped array is the element in column (nx-1)/2 and row
(ny-1)/2 where the rows are and columns are numbered from 0) at pixel p in the section (where the section is layed out as it is displayed on the screen)</LI>
<LI>multiply each value in the flipped array with the corresponding element in the section.  The sum of these multiplications is the result at pixel p.</LI> 
</OL>
<P>The list of default kernels used by the NewConvolution program is
read from the file NEWCONVOLUTION_FILTERS located in the CONFIG
directory of the IVE hierarchy.  The format of this file is
<PRE>
        NUM_KERNELS=&lt;int&gt;&lt;newline&gt;
        &lt;kernel description&gt;
</PRE>
<P>where &lt;kernel description&gt; has the same format as the individual
kernel files described above.

<H3>Topics</H3>
<P>
   <A HREF="#NewConvolution">Overview</A> |
   <A HREF="Region.html">Dialog</A> |
   <A HREF="#KERNEL_CHOICE">Kernels</A> |
   <A HREF="#KERNEL_RESIZE">Size</A> |
   Format
<HR>

</BODY>
</HTML>
