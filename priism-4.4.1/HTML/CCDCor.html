<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
  <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <TITLE>Priism Help: CCDCor</TITLE>
  <META NAME="Description" CONTENT="On-line help for Priism's application to correct systematic errors in raw fluorescence micrscopy data.">
  <META NAME="Keywords" CONTENT="Priism,bleaching,CCD,intensity fluctuations,correction">
  <LINK REV=MADE HREF="mailto:ive@msg.ucsf.edu">
</HEAD>
<BODY>

<H1><A NAME="CCDCor">CCDCor</A></H1>
<H2>Overview</H2>
<P>The image correction program is used to correct systematic errors that occur
during data collection. The three basic errors are caused by photobleaching,
inconsistent illumination intensity, and CCD defects. Under most circumstances,
image correction should be performed before all other image processing.

<P>Options for selecting the region to process and aspects of the graphical
front end that CCDCor shares with other applications are described in
<A HREF="BatchRegion.html">BatchRegion.html</A>.

<H3>Topics</H3>
<P>
   Overview |
   <A HREF="#RegionForAnalysis">Region for analysis</A> |
   <A HREF="#SpecialParameters">Special Parameters</A>

<H3>Related Priism Topics</H3>
<P>
   <A HREF="BatchRegion.html">BatchRegion.html</A> |
   <A HREF="Priism.html">Priism</A>
<HR>

<H2><A NAME="RegionForAnalysis">Region for Analysis</A></H2>
<P>In certain cases, you may wish to have a correction calculation based on
a subset of the data processed.  To do so, specify the first and last pixel
coordinates along the x axis in the <EM>X Region for analysis</EM> field and
the first and last pixel coordinates along the y axis in the
<EM>Y Region for analysis</EM> field.  These ranges should fit within
the <A HREF="BatchRegion.html">region processed</A> as shown in the
<EM>X range</EM> and the <EM>Y range</EM> fields.  By default, the region for
analysis has the same size as the region processed.

<P>On the command line, the region for analysis is specified by the area
option:  <EM>-area=x_first:x_last:y_first:y_last</EM>.

<H3>Topics</H3>
<P>
   <A HREF="#CCDCor">Overview</A> |
   Region for analysis |
   <A HREF="#SpecialParameters">Special Parameters</A>
<HR>

<H2><A NAME="SpecialParameters">Special Parameters</A></H2>
<P>Press the <EM>Special Parameters</EM> button in the main menu to access
advanced correction settings.  Most of the time, you will not need to change
any of the advanced settings.

<H3>Topics</H3>
<P>
   <A HREF="#CCDCor">Overview</A> |
   <A HREF="#RegionForAnalysis">Region for analysis</A> |
   Special Parameters

<H3>Special Parameters</H3>
<P>
   <A HREF="#PolynomialOrders">Polynomial orders</A> |
   <A HREF="#PolynomialOrdersToPlot">Polynomial orders to plot</A> |
   <A HREF="#IntensityNormalization">Intensity Normalization</A> |
   <A HREF="#UsePhotosensorData">Use Photosensor Data</A> |
   <A HREF="#BleachCorrection">Bleach Correction</A> |
   <A HREF="#Z-LineCorrection">Z-Line Correction</A> |
   <A HREF="#IntensityReferenceTime">Intensity Reference Time</A>
<HR>

<H2><A NAME="PolynomialOrders">Polynomial Orders</A></H2>
<P>When correcting for changing illumination levels, a polynomial fit
is used to smooth the estimates of the illumination level (either the
photosensor readings or averages from the image data).  The order of the
polynomial fit can be specified for each wave in the
<EM>Polynomial order for fit</EM> field.  You should not need to change
these values; the default, using a fourth order polynomial, is adequate
for most images.

<P>On the command line, specify the order of the fitting polynomials
with <CODE>-norder=</CODE><VAR>order_1</VAR><CODE>:</CODE><VAR>order_2</VAR><CODE>:</CODE><VAR>order_3</VAR><CODE>:</CODE><VAR>order_4</VAR><CODE>:</CODE><VAR>order5</VAR> where
<VAR>order_x</VAR> is the order of the fitting polynomial for wave x.

<P><A HREF="#SpecialParameters">Return to the special parameter list</A>
<HR>

<H2><A NAME="PolynomialOrdersToPlot">Polynomial Orders to Plot</A></H2>
<P>Results for the polynomial fits (one per wave) specified by
<EM><A HREF="#PolynomialOrders">Polynomial order for fit</A></EM> are written
to the file shown in <EM>PlotFile</EM>.  If you want to see the results
for other lower-order fits, use non-zero values in
<EM># of orders to plot</EM>.  In detail, for a wave, w, polynomial fits with
orders from o(w) - p(w) to o(w) are recorded where o(w) is the
wth entry in <EM><A HREF="#PolynomialOrders">Polynomial order for fit</A></EM>
and p(w) is the wth entry in <EM># of orders to plot</EM>.

<P><A HREF="2d_plot.html">2d_plot</A> is useful for displaying the file with
the polynomial fits.

<P>From the command line, specify the number of lower-order fits to plot
with <CODE>-nout=</CODE><VAR>n_1</VAR><CODE>:</CODE><VAR>n_2</VAR><CODE>:</CODE><VAR>n_3</VAR><CODE>:</CODE><VAR>n_4</VAR><CODE>:</CODE><VAR>n_5</VAR>
where <VAR>n_x</VAR> is the number lower-order fits to plot for wave x.

<P><A HREF="#SpecialParameters">Return to the special parameter list</A>
<HR>

<H2><A NAME="IntensityNormalization">Intensity Normalization</A></H2>
<P>The toggles next to <EM>Normalize intensities</EM> set whether or not
to correct for illumination levels that vary from section to section.
The illumination levels can be estimated from the photosensor readings
(the <EM><A HREF="#UsePhotosensorData">Use photosensor data</A></EM> toggles
control this); these estimates are smoothed using a polynomial fit
(see <A HREF="#PolynomialOrders">Polynomial Orders</A> and
<A HREF="#PolynomialOrdersToPlot">Polynomial Orders to Plot</A>.

<P>On the command line, use the option
<CODE>-polyfit=</CODE><VAR>do_1</VAR><CODE>:</CODE><VAR>do_2</VAR><CODE>:</CODE><VAR>do_3</VAR><CODE>:</CODE><VAR>do_4</VAR><CODE>:</CODE><VAR>do_5</VAR>
where <VAR>do_x</VAR> is one if intensity normalization should be applied to
wave x and zero if it should not be applied.

<P><A HREF="#SpecialParameters">Return to the special parameter list</A>
<HR>

<H2><A NAME="UsePhotosensorData">Use Photosensor Data</A></H2>
<P>Use the <EM>Use photosensor data</EM> toggles to set whether the
photosensor readings recorded during data collection are to be used to
calculate the <A HREF="#IntensityNormalization">intensity normalization</A>
correction.  When the photosensor readings are not used, intensity
normalization is based on a polynomial fit to average intensities from the
input images.  By default, the photosensor values are used for all waves.

<P>On the command line, use the option
<CODE>-photon=</CODE><VAR>do_1</VAR><CODE>:</CODE><VAR>do_2</VAR><CODE>:</CODE><VAR>do_3</VAR><CODE>:</CODE><VAR>do_4</VAR><CODE>:</CODE><VAR>do_5</VAR>
where <VAR>do_x</VAR> is one if the photosensor readings should be used when
normalizing the intensities in wave x and zero if they should not be used.

<P><A HREF="#SpecialParameters">Return to the special parameter list</A>
<HR>

<H2><A NAME="BleachCorrection">Bleach Correction</A></H2>
<P>For situations where image intensity changes in a wave are due to the
specimen and not photobleaching, turn this option off. The default is to
apply a bleach correction to all waves.

<P>On the command line, use the option
<CODE>-bleach=</CODE><VAR>do_1</VAR><CODE>:</CODE><VAR>do_2</VAR><CODE>:</CODE><VAR>do_3</VAR><CODE>:</CODE><VAR>do_4</VAR><CODE>:</CODE><VAR>do_5</VAR>
where <VAR>do_x</VAR> is one if bleach correction should be applied to wave
x and zero if it should not be applied.

<P><A HREF="#SpecialParameters">Return to the special parameter list</A>
<HR>

<H2><A NAME="Z-LineCorrection">Z-Line Correction</A></H2>
<P>The Z-Line correction is designed to detect CCD defects by looking for
unusual intensity profiles along the Z-axis.  For example, a dead CCD element
will appear as a straight, dark line along the Z-axis, and a hot CCD element
will appear as straight, bright line along the Z-axis.  Voxels identified
as Z-line errors are replaced with the average of their neighbors. The default
is to apply this correction to all waves.

<P>On the command line, use the option
<CODE>-zline=</CODE><VAR>do_1</VAR><CODE>:</CODE><VAR>do_2</VAR><CODE>:</CODE><VAR>do_3</VAR><CODE>:</CODE><VAR>do_4</VAR><CODE>:</CODE><VAR>do_5</VAR> where
<VAR>do_x</VAR> is one if Z-line correction should be applied to wave x and
zero if it should not be applied.

<P><A HREF="#SpecialParameters">Return to the special parameter list</A>
<HR>

<H2><A NAME="IntensityReferenceTime">Intensity Reference Time</A></H2>
<P>When correcting for varying illumination levels (see
<A HREF="#IntensityNormalization">Intensity Normalization</A>) and the
photosensor data is used as a measure of the illumination level (see
<A HREF="#UsePhotosensorData">Use Photosensor Data</A>), CCDCor uses the
photosensor reading from the first z section at the reference time as
the reference photosensor value.  The default is to use the first time
point (zero) in the input file as the reference time.

<P>On the command line, use <CODE>-itref=</CODE><VAR>t</VAR> to specify
the reference time point, <VAR>t</VAR>.

<P><A HREF="#SpecialParameters">Return to the special parameter list</A>
<HR>
</BODY>
</HTML>
