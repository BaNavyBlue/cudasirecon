<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
  <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <TITLE>Priism Help: tiff2mrc</TITLE>
  <META NAME="Description" CONTENT="On-line help for converter from TIFF to Priism's native file format.">
  <META NAME="Keywords" CONTENT="Priism,TIFF">
  <LINK REV=MADE HREF="mailto:ive@msg.ucsf.edu">
</HEAD>
<BODY>

<H1><A NAME="tiff2mrc">Convert to Priism's Native Format from TIFF</A></H1>
<H2>Overview</H2>

<P>This application takes a TIFF file and converts it into Priism's native
file format.  With the <EM><A HREF="#inputFileMode">Convert</A></EM> menu
select whether you are converting a single file or are combining a series
of TIFF files into one Priism file.  For a single file, enter the name in
<EM>TIFF File</EM> field; combining multiple files is described
<A HREF="#tiffSeries">below</A>.  Enter the destination file or window in
the <EM>MRC File</EM> field and press <EM>DoIt</EM> to perform the
conversion.  The application also has a
<A HREF="#CommandLine">command line interface</A> if that is more convenient
for you.

<H3>Topics</H3>
<P>
   Overview |
   <A HREF="#inputFileMode">File Selection</A> |
   <A HREF="#multipleImages">Multiple Image TIFFs</A> |
   <A HREF="#tiffSeries">Multiple Files</A> |
   <A HREF="#palette">Palettes</A> |
   <A HREF="#log">Messages</A> |
   <A HREF="#CommandLine">Command Line</A>

<H3>Related Priism Topics</H3>
<P>
   <A HREF="Priism.html">Priism</A>
<HR>

<H2><A NAME="inputFileMode">File Selection</A></H2>

<P>The converter either does one file at a time (the <EM>Single File</EM>
option in the <EM>Convert</EM> menu) or combines a numbered series of files
(the <EM>Numbered Series</EM> option).  The inputs not relevant to the
option selected will be grayed out.

<H3>Topics</H3>
<P>
   <A HREF="#tiff2mrc">Overview</A> |
   File Selection |
   <A HREF="#multipleImages">Multiple Image TIFFs</A> |
   <A HREF="#tiffSeries">Multiple Files</A> |
   <A HREF="#palette">Palettes</A> |
   <A HREF="#log">Messages</A> |
   <A HREF="#CommandLine">Command Line</A>
<HR>

<H2><A NAME="multipleImages">TIFF Files With Multiple Images</A></H2>

<P>When converting a single TIFF file, you have the option of setting
how to handle the case when multiple images are present in the file.
The default is to only read the first image in the file.  The other options
are to treat the images as z-sections, separate time measurements, or
wavelengths.  Treating multiple images as waves does not work when each
image has multiple wavelengths already (i.e. RGB data or when
<A HREF="#palette">converting files with color tables to RGB</A>).

<P>When converting a series of TIFF files, tiff2mrc only reads the first image
in each file.

<P>If you do use multiple images per file, you can select how tiff2mrc
interprets the page numbers that may be attached to each image in the file.
You have three options for interpreting the page numbers:
<DL>
  <DT>maintain<DD>Use the maximum number of pages associated with the first
    image as the maximum number of images to convert.  Use the page number
    associated with each image to specify that image's location in the output.
    Images with page numbers greater than or equal to the maximum page number
    associated with the first image are ignored.
  <DT>ignore maximum<DD>Ignore the maximum number of pages.  Use the page
    number associated with each image to specify that image's location in the
    output.
  <DT>ignore all<DD>Ignore all page numbers.  Images will be stored in the
    output in the same order as they appear in the TIFF file.
</DL>

<P>If your file has some images that have page numbers and some images that do
not, you likely want to use "ignore all" when converting the file with
tiff2mrc.

<P>You can also select which images will be converted when reading multiple
images from a single file.  To do so, turn on the toggle button at the end of
the line with the button labeled "Range", and then enter the range of image
indices in the field on that line.  The first value is one bound for the range,
the second value is the other bound for the range, and the third value is the
increment.  When tiff2mrc uses the page numbers for the images (the first
image in the file has a page number and you have not selected to ignore all
page numbers), the range specifies which page numbers will be converted.  When
tiff2mrc does not use page numbers, the range specifies which images to convert
by their position in the input:  the first image has an index of zero, the
second image has an index of one, and so forth.  An image will be transfered to
the output if its index, <VAR>iv</VAR>, satisfies the following: if the
increment is zero, <VAR>iv</VAR> must equal the first bound; otherwise,
<VAR>iv</VAR> minus the first bound must be evenly divisible by the increment
and <VAR>iv</VAR> minus the first bound and then divided by the increment must
be greater than or equal to zero and less than or equal to the second bound
minus the first bound divided by the increment.  The order of the first and
second bounds does not affect how the images are ordered in the output:  the
images will be ordered by page number or by position in the input file.

<H3>Topics</H3>
<P>
   <A HREF="#tiff2mrc">Overview</A> |
   <A HREF="#inputFileMode">File Selection</A> |
   Multiple Image Tiffs |
   <A HREF="#tiffSeries">Multiple Files</A> |
   <A HREF="#palette">Palettes</A> |
   <A HREF="#log">Messages</A> |
   <A HREF="#CommandLine">Command Line</A>
<HR>

<H2><A NAME="tiffSeries">Combining Multiple Files</A></H2>

<P>The <EM>Numbered Series</EM> option in the <EM>Convert</EM> menu allows
you to combine multiple TIFF files into one Priism dataset.  To select the
form of the input file names use the "Name format" menu.  That menu has
three options for predefined file name formats and a fourth that allows for
a custom format.  For all of the predefined formats, the file names will start
with the contents of the "Directory" field, followed by a slash, followed by
the contents of the "Prefix" field.  The remainder of the file name depends on
which predefined format you select:

<DL>
  <DT>prefix_z#_t#.tif<DD>After the prefix, the file name will have _z appended
    followed by the z section number written out, in decimal, with as many
    digits as needed for the largest z section number (if the section number
    has fewer digits than the largest z section number, leading zeros will be
    inserted).  That will be followed by _t and then the time point number
    written out, in decimal, with as many digits as needed for the largest
    time point number (if the time point number has fewer digits than the
    largest time point number, leading zeros will be inserted).  The file
    name will end with a .tif extension.  This option is equivalent to using
    the custom file name template, %d/%p_z%az_t%at.tif.
  <DT>prefix_z#.tif<DD>After the prefix, the file name will have _z appended
    followed by the z section number written out, in decimal, with as many
    digits as needed for the largest z section number (if the section number
    has fewer digits than the largest z section number, leading zeros will be
    inserted).  The file name will end with a .tif extension.  This option is
    equivalent to using the custom file name template, %d/%p_z%az.tif.
  <DT>prefix_t#.tif<DD>After the prefix, the file name will have _t appended
    followed by the time point number written out, in decimal, with as many
    digits as needed for the largest time point number (if the time point
    number has fewer digits than the largest time point number, leading zeros
    will be inserted).  The file name will end with a .tif extension.  This
    option is equivalent to using the custom file name template,
    %d/%p_t%at.tif.
</DL>

<P>If you select the "custom template" option from the "Name format" menu,
the input file names will be generated from the contents of the "Template"
field.  When generating file names, special conversion codes are expanded
in the template.  The conversion codes have the following general form:
%[<VAR>width</VAR>]<VAR>code</VAR>.  The recognized codes are:
<DL>
  <DT><STRONG>%</STRONG><DD>Causes a percent sign to be inserted in the
    file name.
  <DT><STRONG>d</STRONG><DD>This conversion code is replaced with the
    contents of the "Directory" field.
  <DT><STRONG>p</STRONG><DD>This conversion code is replaced with the
    contents of the "Prefix" field.
  <DT><STRONG>z</STRONG><DD>This conversion code is replaced with the z
    section number.
  <DT><STRONG>t</STRONG><DD>This conversion code is replaced with the time
    point number.
</DL>

<P><VAR>width</VAR> is optional and may be used with the <STRONG>z</STRONG>
and <STRONG>t</STRONG> codes to specify the minimum number of digits which are
used to display the index value.  <VAR>width</VAR> may be a positive integer
indicating the minimum number of digits to use or the letter a to indicate
that the minimum number of digits should be the number of digits in the
maximum corresponding index.  If an index would have less than the minimum
number of digits, leading zeros are added to fill in the missing portion.

<P>As an example of a custom template, if you wanted to combine f0001.tif
through f1000.tif from the directory /var/tmp as time points in a single MRC
file.  You would select "custom template" from the "Name format" menu, enter
<SAMP>/var/tmp</SAMP> in the "Directory" field, make sure the "Prefix" field
was empty, enter <SAMP>%d/f%4t.tif</SAMP> in the "Template" field, set the
range of z indices to start at zero and end at zero with a step of one, and set
the range of time points to start at one and end at one thousand with a step
of one.

<P>The "Z Start/End/Step" and "T Start/End/Step" fields set the range of
z and time point indices, respectively, to use when generating file names.
The first value in each field is the starting value, <VAR>s</VAR>, to use;
the second value is the last possible value, <VAR>e</VAR>, to use; and the
third value is the increment, <VAR>i</VAR>. The indices used will be
<VAR>s</VAR>, <VAR>s</VAR> + <VAR>i</VAR>, ..., <VAR>s</VAR> + <VAR>n</VAR> *
<VAR>i</VAR>.  If <VAR>i</VAR> is greater than zero, <VAR>n</VAR> is the
largest integer such that <VAR>s</VAR> + <VAR>n</VAR> * <VAR>i</VAR> is less
than or equal to <VAR>e</VAR>.  If <VAR>i</VAR> is less than zero, <VAR>n</VAR>
is the largest integer such that <VAR>s</VAR> + <VAR>n</VAR> * <VAR>i</VAR>
is greater than or equal to <VAR>e</VAR>.  <VAR>s</VAR> and <VAR>e</VAR> must
be greater than or equal to zero. <VAR>i</VAR> must not be equal to zero.

<H3>Topics</H3>
<P>
   <A HREF="#tiff2mrc">Overview</A> |
   <A HREF="#inputFileMode">File Selection</A> |
   <A HREF="#multipleImages">Multiple Image TIFFs</A> |
   Multiple Files |
   <A HREF="#palette">Palettes</A> |
   <A HREF="#log">Messages</A> |
   <A HREF="#CommandLine">Command Line</A>
<HR>

<H2><A NAME="palette">Palettes</A></H2>

<P>For pseudocolor TIFF files, which have a color table (palette)
that maps the image values to full color RGB, the conversion can use the
color table and create an output file with three waves (the <EM>as RGB</EM>
option), or the color table can be ignored and the raw image values will
be stored in a single wave (the <EM>as Grayscale</EM> or <EM>as Inverted
Grayscale</EM> options).  The former gives better results when the image in
the TIFF file was derived from a full color image.  The latter is better if
you are interested in data values from an originally single color image which
has had a color table applied for visualization purposes.

<P>For images without a color table (full-color RGB or grayscales), this
setting has no effect.  When an image with a color table is converted,
messages to that effect will be written in the <A HREF="#log">log</A>.

<H3>Topics</H3>
<P>
   <A HREF="#tiff2mrc">Overview</A> |
   <A HREF="#inputFileMode">File Selection</A> |
   <A HREF="#multipleImages">Multiple Image TIFFs</A> |
   <A HREF="#tiffSeries">Multiple Files</A> |
   Palettes |
   <A HREF="#log">Messages</A> |
   <A HREF="#CommandLine">Command Line</A>
<HR>

<H2><A NAME="log">Messages</A></H2>

<P>Errors that cause the conversion to fail will cause a dialog to appear
telling generally in what stage of the process the error occurred.  For more
information about why the conversion failed or possible non-fatal problems
with the conversion, the <EM>View Log</EM> button in the dialog can be used
to display the messages generated.  Messages that start with tiff2mrc are
generated by the application itself; other messages are from the underlying
conversion library.

<H3>Topics</H3>
<P>
   <A HREF="#tiff2mrc">Overview</A> |
   <A HREF="#inputFileMode">File Selection</A> |
   <A HREF="#multipleImages">Multiple Image TIFFs</A> |
   <A HREF="#tiffSeries">Multiple Files</A> |
   <A HREF="#palette">Palettes</A> |
   Messages |
   <A HREF="#CommandLine">Command Line</A>
<HR>

<H2><A NAME="CommandLine">Command Line</A></H2>
<P>The command line syntax for tiff2mrc is<BR>
<CODE>tiff2mrc</CODE> <VAR>options</VAR> <VAR>output_file_name</VAR>

<P><VAR>options</VAR> may be one or more of the following; you must
specify either the -in or -template options to indicate which input file
or files to use.

<DL>
  <DT><CODE>-dir=</CODE><VAR>dir</VAR>
  <DD>Sets the name of the directory to use in the input file name template.
    The -in or -template options control whether or not a file name template
    is used to generate the input file names.  If you do not specify the
    directory, tiff2mrc will use an empty string.

  <DT><CODE>-ignore_pagenum=</CODE><VAR>option</VAR>
  <DD>If you use -in and -multi to read multiple images from one file,
    -ignore_pagenum will set how tiff2mrc interprets the page numbers
    associated with each image.  If you do not use -ignore_pagenum,
    tiff2mrc acts as if you used -ignore_pagenum=none.  <VAR>option</VAR>
    may be one of the following:
    <DL>
      <DT>none<DD>Use the maximum number of pages associated with the first
        image as the maximum number of images to convert.  Use the page
        number associated with each image to specify that image's location in
        the output.  Images with page numbers greater than or equal to the
        maximum page number associated with the first image are ignored.
      <DT>max<DD>Ignore the maximum number of pages.  Use the page number
        associated with each image to specify that image's location in the
        output.
      <DT>all<DD>Ignore all page numbers.  Images will be stored in the output
        in the same order as they appear in the TIFF file.
    </DL>

  <DT><CODE>-in=</CODE><VAR>name</VAR> or <CODE>-in=</CODE><VAR>name_format</VAR>
  <DD>The first form selects a single input file to convert.  The second
    form selects one or more files whose names correspond to a predefined
    template.  If you have multiple files that do not correspond to one
    of the predefined templates, you should use the -template option which
    has precedence over the -in option.  The allowed values for
    <VAR>name_format</VAR> are:
    <DL>
      <DT>prefix+zt<DD>Causes tiff2mrc to generate output file names as if
        <A HREF="#tiffSeries">"prefix_z#_t#.tif"</A> had been selected for
        the name format in the user interface.
      <DT>prefix+z<DD>Causes tiff2mrc to generate output file names as if
        <A HREF="#tiffSeries">"prefix_z#.tif"</A> had been selected for the
        name format in the user interface.
      <DT>prefix+t<DD>Causes tiff2mrc to generate output file names as if
        <A HREF="#tiffSeries">"prefix_t#.tif"</A> had been selected for the
        name format in the user interface.
    </DL>

  <DT><CODE>-indices=</CODE><VAR>low</VAR><CODE>:</CODE><VAR>high</VAR>[<CODE>:</CODE><VAR>increment</VAR>]
  <DD>If you use -in and -multi to read multiple images from one file,
    use -indices to select a subset of the images that will be transfered
    to the output.  If you do not set -indices, no additional constraints
    will be imposed on the images converted.  When tiff2mrc uses page numbers
    from the file (the first image has a page number and you use
    -ignore_pagenum=none or -ignore_pagenum=max), the images are selected
    by their page numbers.  Otherwise, images are selected by their position
    in the file where the images are number consecutively starting with zero.
    You specify the range by two or three integers:  <VAR>low</VAR>,
    <VAR>high</VAR>, and <VAR>increment</VAR>.  If you omit
    <VAR>increment</VAR>, tiff2mrc will assume it is one if <VAR>high</VAR> is
    greater than or equal to <VAR>low</VAR> and will assume it is negative one
    if <VAR>high</VAR> is less than <VAR>low</VAR>.  An image will be
    transfered to the output if its index, <VAR>iv</VAR>, satisfies the
    following:  if <VAR>increment</VAR> is zero, <VAR>iv</VAR> must equal
    <VAR>low</VAR>; otherwise, <VAR>iv</VAR> minus <VAR>low</VAR> must be
    evenly divisible by <VAR>increment</VAR>, and (<VAR>iv</VAR> -
    <VAR>low</VAR>) / <VAR>increment</VAR> must be greater than or equal to
    zero and less than or equal to (<VAR>high</VAR> - <VAR>low</VAR>) /
    <VAR>increment</VAR>.  Whether <VAR>low</VAR> is less than or equal to
    <VAR>high</VAR> or not does not affect how the images are ordered in the
    output:  the images will be ordered by page number or by position in the
    input file.

  <DT><CODE>-multi=</CODE><VAR>option</VAR>
  <DD>If you use -in to specify a single input file, use this option to
    control what is done if that file contains multiple images.
    <VAR>option</VAR> may be one of the following:
    <DL>
      <DT>first<DD>Use only the first image in the file.  This is the default.
      <DT>z<DD>Treat each image as a separate z section.
      <DT>t<DD>Treat each image as a separate time point.
      <DT>w<DD>Treat each image as a separate wavelength.
    </DL>

  <DT><CODE>-palette=</CODE><VAR>conversion</VAR>
  <DD>Specifies how to convert TIFF files which have a color table.
    <VAR>conversion</VAR> may be one of the following:
    <DL>
      <DT>rgb<DD>Create an output file with three wavelengths with
        each wavelength corresponding to one color component (red, green,
        blue).
      <DT>gray<DD>Ignores the color table and creates an output with a
        single wavelength containing data values the raw image values from
        the input.  This is the default.
      <DT>grey<DD>Is a synonym for the gray option.
      <DT>inverted<DD>Ignores the color table and creates an output with a
        single wavelength containing the contrast-reversed raw image values.
    </DL>

  <DT><CODE>-prefix=</CODE><VAR>pref</VAR>
  <DD>Sets the prefix to use in the input file name template.  If you do not
    specify the prefix, tiff2mrc will use an empty string.

  <DT><CODE>-t=</CODE><VAR>start</VAR><CODE>:</CODE><VAR>end</VAR>[<CODE>:</CODE><VAR>increment</VAR>]
  <DD>Sets the range of time point numbers to use when generating multiple
    input file names.  If you omit the increment, tiff2mrc will use an
    increment of one if <VAR>end</VAR> is greater than or equal to
    <VAR>start</VAR> and use an increment of negative one if <VAR>end</VAR> is
    less than <VAR>start</VAR>.  If you do not set a time point range,
    tiff2mrc will assume a range which starts at zero, ends at zero, and has
    an increment of one.

  <DT><CODE>-template=</CODE><VAR>custom_template</VAR>
  <DD>Sets the <A HREF="#tiffSeries">file name template</A> tiff2mrc will
    use when generating input file names.  If you specify this option, it
    will take precedence over a -in option.

  <DT><CODE>-z=</CODE><VAR>start</VAR><CODE>:</CODE><VAR>end</VAR>[<CODE>:</CODE><VAR>increment</VAR>]
  <DD>Sets the range of z indices to use when generating multiple input file
    names.  If you omit the increment, tiff2mrc will use an increment of one
    if <VAR>end</VAR> is greater than or equal to <VAR>start</VAR> and use an
    increment of negative one if <VAR>end</VAR> is less than <VAR>start</VAR>.
    If you do not set a z range, tiff2mrc will assume a range which starts at
    zero, ends at zero, and has an increment of one.
</DL>

<P>This example creates the file fish.dat in the current directory
which contains, as time points, the images from f0001.tif through f1000.tif
in /var/tmp:

<PRE>
    tiff2mrc -template=/var/tmp/f%4t.tif -t=1:1000 fish.dat
</PRE>

<P>This example extracts all the images from exp1.tif and saves them as
z sections in the MRC file exp1.mrc:

<PRE>
    tiff2mrc -in=exp1.tif -multi=z exp1.mrc
</PRE>

<H3>Topics</H3>
<P>
   <A HREF="#tiff2mrc">Overview</A> |
   <A HREF="#inputFileMode">File Selection</A> |
   <A HREF="#multipleImages">Multiple Image TIFFs</A> |
   <A HREF="#tiffSeries">Multiple Files</A> |
   <A HREF="#palette">Palettes</A> |
   <A HREF="#log">Messages</A> |
   Command Line
<HR>

</BODY>
</HTML>
