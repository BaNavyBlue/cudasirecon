<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
  <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <TITLE>Priism Help: Optical Transfer and Pupil Functions</TITLE>
  <META NAME="Description" CONTENT="Describes formats and procedures for working with optical transfer funcions (OTFs) and pupil functions in Priism.">
  <META NAME="Keywords" CONTENT="otf,pupil function">
  <LINK REV=MADE HREF="mailto:ive@msg.ucsf.edu">
</HEAD>
<BODY>

<H1><A NAME="otf_and_pupil">Optical Transfer and Pupil Functions</A></H1>
<H2>Overview</H2>

<P>Deconvolution algorithms frequently assume that one knows how the
microscope blurs the image of the sample.  The point spread function (PSF)
is one way to describe the microscope's blur.  Deconvolution algorithms
in Priism do not use the point spread function directly.  Instead, they expect
either the optical transfer function (OTF) or pupil function both of which
can be derived from the point spread function.

<P>The point spread function is the image that a point source of light makes in
the microscope.  Priism's deconvolution algorithms (with one exception) assume
that the point spread function does not depend on the position of the point
in the microscope's field of view.  The transfer function for the microscope
is the Fourier transform of the point spread function.  In Priism's
documentation, we frequently use the terms optical transfer function or
contrast transfer function as synonyms for the transfer function of the
microscope.  Others are more accurate with their terminology:  using optical
transfer function to refer to the component of the net transfer function that
arises from the optics of the microscope (excluding the contributions from the
camera, for instance) and using the contrast function to refer to the squared
modulus of the intensity of an image of a square-wave pattern.

<P>The pupil function describes the optics of the microscope.  Using a process
called phase retrieval and assumptions about the other contributions to the
point spread function that are not part of the optics (namely the camera), it
is possible to compute a pupil functions from the point spread function.

<H3>Topics</H3>
<P>OTFs and pupil functions |
   <A HREF="#selecting_otf">Selecting the OTF or pupil function</A> |
   <A HREF="#measuring_otf">Measuring the OTF or pupil function</A> |
   <A HREF="#otf_format">OTF or pupil function file formats</A>

<H3>Related Priism Topics</H3>
<P><A HREF="core2_decon.html">ER-Decon II application</A> |
   <A HREF="core_decon.html">ER-Decon application</A> |
   <A HREF="phretavr.html">phretavr (phase retrieval)</A> |
   <A HREF="pffit.html">pffit (fits the pupil function)</A> |
   <A HREF="superimpose_psf.html">superimpose_psf (prepocesses PSF measurements)</A> |
   <A HREF="FTransform3D.html">FTransform3D (3D Fourier transform)</A> |
   <A HREF="radialft_asym.html">radialft_asym (radially averages transfer function)</A> |
   <A HREF="Priism.html">Priism</A>
<HR>

<H2><A NAME="selecting_otf">Selecting the OTF or Pupil Function</A></H2>
<P>Priism's deconvolution applications will automatically select an OTF or
pupil function when you select a data file to deconvolve.  They do so based
on the lens number recorded in the data file's header.  The mapping between
lens number and an OTF or pupil function is defined by the CTF/CTF.def file
in the Priism distribution (or on a per-user basis by a .iveprefs/CTF.def
file in the user's home directory). The default mapping is to one of the two
axially and radially symmetric OTFs for the old om1 microscope that was in
John Sedat's lab at UCSF.

<P>Several sample radially-symmetric OTFs are available in the CTF
subdirectory of the Priism distribution that were measured on John Sedat's
om1.  In general, you should use a measured (or theoretically modeled) OTF for
your microscope rather than one of those sample OTFs:  the section
<A HREF="#measuring_otf">Measuring the OTF or Pupil Function</A> describes how
to generate an OTF file.  Of the sample OTFs, the ones with "lens12" in the
file name were taken with an Olympus 60x 1.4 NA objective and the ones with
"lens13" in the file name were taken with a Nikon 100x objective.
lens12.realctf and lens13.realctf represent axially- and radially-symmetric
PSFs which assume that you have adjusted the immersion oil to give a symmetric
PSF.  If you have not adjusted the immersion oil, you should use an asymmetric
PSF to obtain a better result from the deconvolution.  All asymmetric OTFs
have names of the form
<CODE>lens12_</CODE><VAR>refractive index</VAR><CODE>_asym.ctf</CODE>.  If you
want to select the appropriate asymmetric OTF to use, first examine your data
to see if the out-of-focus blur is mostly thrown below (lower z)
the object or above it (higher z).  If most of the blur is thrown
below, choose one of the asymmetric OTFs with a refractive index less than
1.5140 (the refractive index of the immersion oil that gave the most axially
symmetric PSF with the lens).  If most of the blur is above the object, choose
one of the asymmetric OTFs with a refractive index greater than 1.5140.

<H3>Topics</H3>
<P><A HREF="#otf_and_pupil">OTFs and pupil functions</A> |
   Selecting the OTF or pupil function |
   <A HREF="#measuring_otf">Measuring the OTF or pupil function</A> |
   <A HREF="#otf_format">OTF or pupil function file formats</A>
<HR>

<H2><A NAME="measuring_otf">Measuring the OTF or Pupil Function</A></H2>
<P>If you do not already have the OTF or pupil function for your imaging
system, the recommended method for obtaining one is to measure it
experimentally.  I'll outline a procedure for measuring the OTF or pupil
function with an emphasis on the computational aspects or those peculiar to
Priism's deconvolution application.  For a fuller consideration of the
process, consult the literature; two references are:

<OL>
  <LI>Hiraoka, Y., Sedat, J.W., and Agard, D.A. (1990). Determination of the
    three-dimensional imaging properties of an optical microscope system:
    partial confocal behavior in epi-fluorescence microscopy. Biophys. J., 57:
    325-333.
  <LI>Hiraoka, Y., Sedat, J.W., and Agard, D.A. (1987). The use of a
    charge-coupled device for quantitative optical microscopy of biological
    structures. Science 238: 36-41.
</OL>

<P>To generate a 3D OTF for the deconvolution application,

<OL>
  <LI>Image a single fluorescent bead at evenly spaced optical sections.
    To improve the signal-to-noise ratio at the edges of the point spread
    function without saturating the peak, it can be useful to take <VAR>n</VAR>
    images at each section; these are then computationally combined offline.
    Because Priism's deconvolution program will modify the OTF to match
    different pixel spacings or wavelengths, it is not necessary to use the
    same pixel spacing and wavelength for imaging the bead and for imaging
    your normal samples.
  <LI>If you collected multiple images for each optical section, combine them.
    To combine the sections using an unweighted sum, you can use
    <A HREF="RunProj.html">RunProj</A> or
    <A HREF="superimpose_psf.html">superimpose_psf</A>.  superimpose_psf
    also sums the photosensor readings, interpolates a peak position, and
    can estimate and subtract a constant background level.
  <LI>Correct for variations in the illumination intensity.  For data with
    one of the known extended header formats (the
    <A HREF="IM_ref2.html#IMRtExHdrType">IM library documentation</A> lists
    them), <A HREF="CCDCor.html">CCDCor</A> can do this for you using the
    illumination intensity measurements in the extended header.
  <LI>Remove the background not due to the bead.  If the background can be
    assumed to be a constant and you have an estimate of its value, you can
    subtract that value during the calculation of the Fourier transform of the
    PSF (see below).  <A HREF="superimpose_psf.html">superimpose_psf</A>
    includes the option to estimate (from the edge pixels of the in-focus
    section and the sections above and below the in-focus section) and subtract
    that estimate.  When removing the background, you'll also want to coerce
    to zero any elements of the PSF that are negative.
    <A HREF="Threshold.html">Threshold</A> can do that (set the condition to
    "above or equal to threshold", the threshold and background to zero, and
    the result to "masked data").  If you are planning to correct the phases
    to subpixel accuracy, it's best to defer the coercion of the negative
    values until the Fourier transform step.
  <LI>Determine the position of the peak in order to correct the phases
    in the OTF.  The correction to the phases can either be done
    as part of the Fourier transform step or, if you use radially averaging,
    during the radially averaging step.
    <A HREF="superimpose_psf.html">superimpose_psf</A> can interpolate
    the position of the peak; it uses a quadratic fit to the brightest pixel
    and that pixel's six immediate neighbors.
  <LI>At this point you have a measured PSF.  Perform a 3D Fourier transform
    to compute the OTF.  Priism's
    <A HREF="FTransform3D.html">3D Fourier transform</A> can do that for you;
    it will also subtract a constant background and apply the shift to position
    the PSF peak at the origin.  If you use Priism's Fourier transform, keep
    the following points in mind:
    <UL>
      <LI>Do not turn on the "Fully complex" toggle button.
      <LI>Do not turn on the "Zero frequency centered" toggle button.
      <LI>Turn off the "Convert units" toggle button.
      <LI>If you use non-integral shifts, the result may not match the
        expected result if one or more dimensions have an even number of
        samples (see <A HREF="FTransform3D.html#Shift">FTransform3D.html</A>
        for a fuller description of the problem).  Also, the shifted result
        could have negative values when reverse transformed (i.e. the
        interpolation of the PSF using the Fourier series is not guaranteed
        to be non-negative everywhere).  In that case, you could do the
        transform with this procedure:
        <OL>
          <LI>Perform an initial forward transform as a fully-complex transform
            with the non-integral shifts.  Do not convert the unit spacing or
            center the zero frequency.
          <LI>Reverse transform that result as a fully-complex transform with
            with the shifts set to zero.  Do not convert the unit spacing or
            center the frequency.
          <LI>Extract the real component of that result and coerce any negative
            values to zero by running <A HREF="Threshold.html">Threshold</A>
            on the result.  In Threshold, set it to write the output as
            floating-point and use the condition, "generic expression", with
            the expression set to "real(p) &gt;= 0", the background set to
            zero, and the result set to "masked data".
          <LI>Perform a final forward transform without the "Fully complex"
            toggle button on and use shifts of zero.  Do not convert the unit
            spacing or center the zero frequency.
        </OL>
    </UL>
  <LI>At this point you have a full 3D OTF that is usable by the deconvolution
    application.  To improve the signal-to-noise ratio in the OTF, it has
    been common practice to radially average the OTF; this has the drawback
    of throwing away real radial asymmetries that are present.  If you
    wish to radially average the OTF, the command line application
    <A HREF="radialft_asym.html">radialft_asym</A> can do this for you.
  <LI>Once you have computed an OTF, you may want to add it the database of
    available OTFs and pupil functions; the front end to the deconvolution
    application consults that database to choose the default OTF or pupil
    function for a data set based on the lens number in the data set's header.
    The database is stored in the CTF.def file which is in the CTF subdirectory
    of the Priism distribution; the comments at the beginning of the file
    describe the format of CTF.def.  An individual user may override some or
    all of the database by creating a CTF.def in the .iveprefs subdirectory of
    his or her home directory.
</OL>

<P>The steps for generating a pupil function are similar, but instead of
the 3D Fourier transform step and the optional radial averaging, do the
following:

<OL>
  <LI>Use the phase retrieval application,
    <A HREF="phretavr.html">phretavr</A>, to estimate an image of the pupil
    function from your measured PSF.
  <LI>You may want to fit Zernike polynomials to the pupil function image
    and use that fit instead of the full image.  The application,
    <A HREF="pffit.html">pffit</A>, can do the fitting for you.
  <LI>Once you have the pupil function image or the fit to that image, you
    can enter it into the CTF.def database just as you would with an OTF.
</OL>

<H3>Topics</H3>
<P><A HREF="#otf_and_pupil">OTFs and pupil functions</A> |
   <A HREF="#selecting_otf">Selecting the OTF or pupil function</A> |
   Measuring the OTF or pupil function |
   <A HREF="#otf_format">OTF or pupil function file formats</A>
<HR>

<H2><A NAME="otf_format">OTF or Pupil Function Formats</A></H2>
<P>The format for OTF files read by the deconvolution applications is the
standard Priism image file format (consult the
<A HREF="IM_ref2.html">IM library documentation</A> for details).  If the
OTF is one where radial symmetry has been imposed, the file also has the
following special attributes:

<UL>
  <LI>The file has only one 2D section per wavelength; that section represents
    the radially averaged OTF for the wavelength.
  <LI>The x dimension (fastest varying) of the 2D section represents the z
    direction from the image space; the y dimension of the 2D section
    represents the radial direction (i.e. perpendicular to the z axis) from the
    image space.
  <LI>The x and y pixel spacing in the header should be set so the units are in
    cycles/micron.
  <LI>The value at coordinates (<VAR>i</VAR>, <VAR>j</VAR>) in the 2D section
    (where <VAR>i</VAR> is greater than or equal to zero and less than
    <VAR>nx</VAR>, the size of the x dimension, and <VAR>j</VAR> is greater
    than or equal to zero and less than <VAR>ny</VAR>, the size of the y
    dimension) is the OTF for the axial frequency <VAR>kz</VAR> and
    and radial frequency <VAR>kr</VAR>.  <VAR>kz</VAR> is
    <VAR>i</VAR>*<VAR>dkz</VAR> if <VAR>i</VAR> is less than or equal to
    <VAR>nx</VAR>/2; <VAR>dkz</VAR> is the x pixel spacing in
    cycles/micron from the header.  If <VAR>i</VAR> is greater than
    <VAR>nx</VAR>/2, <VAR>kz</VAR> is
    (<VAR>i</VAR>-<VAR>nx</VAR>)*<VAR>dkz</VAR>.  <VAR>kr</VAR>
    is <VAR>j</VAR>*<VAR>dkr</VAR> where <VAR>dkr</VAR> is the y pixel spacing
    in cycles/micron from the header.
  <LI>For each wavelength, the data values have been multiplied by a constant
    so that the value at (0,0) is 1.
</UL>

<P>For a full 2D or 3D OTF (no assumption of radial symmetry), the file has
the following special attributes:

<UL>
  <LI>The x and y pixel spacing (<VAR>dx</VAR> and <VAR>dy</VAR> respectively)
    in the header should be set to the spatial domain values, in units of
    microns.  For a 3D OTF, the z pixel spacing (<VAR>dz</VAR>) must also
    be set to the z spacing, in units of microns, for the spatial domain.
  <LI>The value at coordinates (<VAR>i</VAR>, <VAR>j</VAR>, <VAR>k</VAR>) in
    a volume (where <VAR>i</VAR> is greater than or equal to zero and less than
    <VAR>nx</VAR>, the size of the x dimension; <VAR>j</VAR> is greater
    than or equal to zero and less than <VAR>ny</VAR>, the size of the y
    dimension; <VAR>k</VAR> is greater than or equal to zero and less than
    <VAR>nz</VAR>, the size of the z dimension) is the OTF at the spatial
    frequencies <VAR>kx</VAR>, <VAR>ky</VAR>, and <VAR>kz</VAR>.  <VAR>kx</VAR>
    is <VAR>i</VAR> / (2 * (<VAR>nx</VAR> - 1) * <VAR>dx</VAR>).
    <VAR>ky</VAR> is <VAR>j</VAR> / (<VAR>ny</VAR> * <VAR>dy</VAR>)
    if <VAR>j</VAR> is less than or equal to <VAR>ny</VAR> / 2 and
    is (<VAR>j</VAR> - <VAR>ny</VAR>) / (ny * <VAR>dy</VAR>) otherwise.
    <VAR>kz</VAR> is <VAR>k</VAR> / (<VAR>nz</VAR> * <VAR>dz</VAR>)
    if <VAR>k</VAR> is less than or equal to <VAR>nz</VAR> / 2 and
    is (<VAR>k</VAR> - <VAR>nz</VAR>) / (ny * <VAR>dz</VAR>) otherwise.
  <LI>Unless you use the option, -nonorm_otf, the value at (0,0,0) for a
    wavelength must be non-zero (without -nonorm_otf, the deconvolution
    application will scale all values in the transfer function by the inverse
    of the zero frequency value).
</UL>

<P>For either radially-symmetric or non-radially symmetric OTF files, the
emission wavelength, in nanometers, should be specified in the header so that
the deconvolution application can modify the OTF as necessary if there is a
wavelength mismatch with the data to be deconvolved.

<P>The format for pupil function images is the standard Priism file format.
The file also has the following special attributes:

<UL>
  <LI>The <A HREF="IM_ref2.html#ImageTypes">image type value</A> stored in the
    header is 8000.  The value v1 in the header holds the numerical aperture
    times ten and the value v2 in the header holds the immersion media
    refractive index times one hundred.
  <LI>The x and y pixel spacing <VAR>dx</VAR> and <VAR>dy</VAR> respectively)
    in the header should be expressed in units cycles / microns.
  <LI>If <VAR>dx</VAR> and <VAR>dy</VAR> are the x and y pixel spacing values
    in the header and <VAR>ox</VAR> and <VAR>oy</VAR> are the x and y origin
    values in the header, the pixel coordinate pair, (i, j), corresponds to
    a spatial frequency, in cycles / micron, of
    ((i + nearest_integer(ox / dx)) * dx, (j + nearest_integer(oy / dy)) * dy).
  <LI>If the image data values are complex-valued, the first image in each
    wavelength is assumed to be the image of the pupil function.  If the image
    data values are not complex-valued, the first image in each wavelength
    is assumed to hold the amplitude component of the pupil and the second
    image in each wavelength is assumed to hold the phase component.
</UL>

<P>Like OTF files, pupil function images should include the emission wavelength
value or values, in nanometers, in the header so that the deconvolution
application can modify the pupil function as necessary if there is a wavelength
mismatch with the data to be deconvolved.

<P>The files used to store the result of fitting Zernike polynomials to the
pupil function image are plain text.  The first line of the file must be

<PRE>
#parametric_pupil_format 0
</PRE>

<P>After that there are zero or more components each of which is either a
blank line or one of the following:

<P><CODE>#</CODE><VAR>attribute name</VAR> [attribute values]<BR>
[coefficient values]

<P>or

<P><CODE>#</CODE> <VAR>label text</VAR>

<P>Valid attributes are:
<DL>
  <DT>numerical_aperture<DD>Has a single attribute value, the assumed
    numerical aperture, and no coefficient values.
  <DT>immersion_refractive_index<DD>Has a single attribute value, the
    refractive index for the immersion media, and no coefficient values.
  <DT>lens_id<DD>Has a single attribute value, the integer lens identification
    number, and no coefficient values.
  <DT>zernike_set_for_amplitude<DD>Has two integer attribute values and
    no coefficient values.  The two attribute values, <VAR>n</VAR> and
    <VAR>m</VAR>, specify the set of Zernike polynomials that were used to fit
    the amplitude component of the pupil function.  If <VAR>n</VAR>, the
    first attribute, is less than zero, no Zernike polynomials were used to fit
    amplitude component.  Otherwise, the Zernike polynomials that were used
    to fit the amplitude component are those whose radial component is of
    order <VAR>n</VAR>-1 or those whose radial component is of order
    <VAR>n</VAR> and whose angular dependence is <VAR>k</VAR> times the angle
    where <VAR>k</VAR> is greater than or equal to zero and less than or equal
    to <VAR>m</VAR>.  If <VAR>n</VAR> is greater than or equal to zero, then
    <VAR>m</VAR> must be greater than equal to zero and less than or equal
    to <VAR>n</VAR>; also, <VAR>n</VAR> minus <VAR>m</VAR> must be even.
  <DT>zernike_set_for_phase<DD>Has two integer attribute values and
    no coefficient values.  The two attribute values, <VAR>n</VAR> and
    <VAR>m</VAR>, specify the set of Zernike polynomials that were used to fit
    the phase component of the pupil function.  If <VAR>n</VAR>, the
    first attribute, is less than zero no Zernike polynomials were used to fit
    phase component.  Otherwise, the Zernike polynomials that were used
    to fit the phase component are those whose radial component is of
    order <VAR>n</VAR>-1 or those whose radial component is of order
    <VAR>n</VAR> and whose angular dependence is <VAR>k</VAR> times the angle
    where <VAR>k</VAR> is greater than or equal to zero and less than or equal
    to <VAR>m</VAR>.  If <VAR>n</VAR> is greater than or equal to zero, then
    <VAR>m</VAR> must be greater than equal to zero and less than or equal
    to <VAR>n</VAR>; also, <VAR>n</VAR> minus <VAR>m</VAR> must be even.
  <DT>polar_fourier_set_for_amplitude<DD>Has two integer attribute values
    and no coefficient values.  The two attribute values, <VAR>n</VAR> and
    <VAR>m</VAR>, specify the set of polar Fourier terms used to fit the
    residual of the amplitude component of the pupil function after the fit
    to the Zernike polynomials.  If <VAR>n</VAR> is less than zero or
    <VAR>m</VAR> is less than zero, then no polar Fourier terms were used.
    Otherwise there are 4 * <VAR>n</VAR> * <VAR>m</VAR> + 2 *
    (<VAR>n</VAR> + <VAR>m</VAR>) + 1 terms.
  <DT>polar_fourier_set_for_phase<DD>Has two integer attribute values
    and no coefficient values.  The two attribute values, <VAR>n</VAR> and
    <VAR>m</VAR>, specify the set of polar Fourier terms used to fit the
    residual of the phase component of the pupil function after the fit
    to the Zernike polynomials.  If <VAR>n</VAR> is less than zero or
    <VAR>m</VAR> is less than zero, then no polar Fourier terms were used.
    Otherwise there are 4 * <VAR>n</VAR> * <VAR>m</VAR> + 2 *
    (<VAR>n</VAR> + <VAR>m</VAR>) + 1 terms.
  <DT>wavelength_count<DD>Has a single attribute value, the number of
    wavelengths for which there are fit coefficients, and no coefficient
    values.
  <DT>wavelengths_um<DD>To be effective, this attribute should appear after
    the wavelength_count attribute in the file.  The wavelengths_um attribute
    is expected to have <VAR>n</VAR> attribute values which are the
    wavelengths, in microns; <VAR>n</VAR> is the number of wavelengths from
    the wavelength_count attribute.  This attribute has no coefficient values.
  <DT>zernike_coeff_amplitude_<VAR>i</VAR><DD>Specifies the coefficients
    for the Zernike polynomials used to fit the pupil function amplitude for
    the <VAR>i</VAR>th wavelength (where <VAR>i</VAR> is greater than or equal
    to zero and less than the number of wavelengths set by the
    wavelength_count attribute).  To be effective, this attribute should appear
    after the wavelength_count and zernike_set_for_amplitude attributes in the
    file.  This attribute has no attribute values and the coefficient values
    follow, one per line, where each line has the form
    <VAR>g</VAR> <VAR>h</VAR> <VAR>c</VAR> [<VAR>s</VAR>].
    <VAR>g</VAR> is an integer greater than or equal to zero and less
    than or equal to the number of radial orders set by the
    zernike_set_for_amplitude attribute.  <VAR>h</VAR> is an integer greater
    than or equal to zero and less than or equal to <VAR>g</VAR> (and, if
    <VAR>g</VAR> is equal to the number of radial orders set by the
    zernike_set_for_amplitude attribute, <VAR>h</VAR> must also be less than
    or equal to the second attribute value, <VAR>m</VAR> from that attribute).
    The difference between <VAR>g</VAR> and <VAR>h</VAR> must be divisible
    by two.  <VAR>c</VAR> is the coefficient for the Zernike polynomial,
    cos(<VAR>h</VAR>*theta) * sum over s from 0 to
    (<VAR>g</VAR>-<VAR>h</VAR>)/2 of (-1)^s r^(<VAR>g</VAR>-2s)
    (<VAR>g</VAR>-s)! / (s! ((<VAR>g</VAR>+<VAR>h</VAR>)/2-s)!
    ((<VAR>g</VAR>-<VAR>h</VAR>)/2-s)!).  If <VAR>h</VAR>
    is not zero, then <VAR>s</VAR> is the coefficient for the Zernike
    polynomial, sin(<VAR>h</VAR>*theta) * sum over s from 0 to
    (<VAR>g</VAR>-<VAR>h</VAR>)/2 of (-1)^s r^(<VAR>g</VAR>-2s) (g-s)! /
    (s! ((<VAR>g</VAR>+<VAR>h</VAR>)/2-s)! ((<VAR>g</VAR>-<VAR>h</VAR>)/2-s)!).
  <DT>zernike_coeff_phase_<VAR>i</VAR><DD>Specifies the coefficients
    for the Zernike polynomials used to fit the pupil function phase for the
    <VAR>i</VAR>th wavelength (where <VAR>i</VAR> is greater than or equal to
    zero and less than the number of wavelengths set by the
    wavelength_count attribute).  To be effective, this attribute should appear
    after the wavelength_count and zernike_set_for_phase attributes in the
    file.  This attribute has no attribute values and the coefficient values
    follow, one per line, where each line has the form:
    <VAR>g</VAR> <VAR>h</VAR> <VAR>c</VAR> [<VAR>s</VAR>].
    <VAR>g</VAR> is an integer greater than or equal to zero and less
    than or equal to the number of radial orders set by the
    zernike_set_for_phase attribute.  <VAR>h</VAR> is an integer greater
    than or equal to zero and less than or equal to <VAR>g</VAR> (and, if
    <VAR>g</VAR> is equal to the number of radial orders set by the
    zernike_set_for_phase attribute, <VAR>h</VAR> must also be less than
    or equal to the second attribute value, <VAR>m</VAR> from that attribute).
    The difference between <VAR>g</VAR> and <VAR>h</VAR> must be divisible
    by two.  <VAR>c</VAR> is the coefficient for the Zernike polynomial,
    cos(<VAR>h</VAR>*theta) * sum over s from 0 to
    (<VAR>g</VAR>-<VAR>h</VAR>)/2 of (-1)^s r^(<VAR>g</VAR>-2s)
    (<VAR>g</VAR>-s)! / (s! ((<VAR>g</VAR>+<VAR>h</VAR>)/2-s)!
    ((<VAR>g</VAR>-<VAR>h</VAR>)/2-s)!).  If <VAR>h</VAR>
    is not zero, then <VAR>s</VAR> is the coefficient for the Zernike
    polynomial, sin(<VAR>h</VAR>*theta) * sum over s from 0 to
    (<VAR>g</VAR>-<VAR>h</VAR>)/2 of (-1)^s r^(<VAR>g</VAR>-2s)
    (<VAR>g</VAR>-s)! / (s! ((<VAR>g</VAR>+<VAR>h</VAR>)/2-s)!
    ((<VAR>g</VAR>-<VAR>h</VAR>)/2-s)!).
  <DT>polar_fourier_coeff_amplitude_<VAR>i</VAR><DD>Specifies the coefficients
    for the polar Fourier terms used to fit the residual of the pupil function
    amplitude for the <VAR>i</VAR>th wavelength (where <VAR>i</VAR> is greater
    than or equal to zero and less than the number of wavelengths
    set by the wavelength_count attribute).  To be effective, this attribute
    should appear after the wavelength_count and
    polar_fourier_set_for_amplitude attributes in the file.  This attribute
    has no attribute values and the coefficient values follow, one per line,
    where each line has the form:
    <VAR>g</VAR> <VAR>h</VAR> <VAR>p1</VAR> [<VAR>p2</VAR> [<VAR>p3</VAR> <VAR>p4</VAR>]].
    <VAR>g</VAR> is an integer greater than or equal to zero and less than
    or equal to the first attribute value, <VAR>n</VAR>, set by the
    polarf_set_for_amplitude attribute.  <VAR>h</VAR> is an integer greater
    than or equal to zero and less than or equal to the second attribute
    value, <VAR>m</VAR>, set by the polarf_set_for_amplitude attribute.
    <VAR>p1</VAR> is the coefficient for the polar Fourier term,
    cos(2*pi*<VAR>g</VAR>*r) * cos(<VAR>h</VAR>*theta).  If <VAR>g</VAR> is
    not zero and <VAR>h</VAR> is zero, <VAR>p2</VAR> is the coefficient for
    the polar Fourier term, sin(2*pi*<VAR>g</VAR>*r) *
    cos(<VAR>h</VAR>*theta).  If <VAR>g</VAR> is zero and <VAR>h</VAR> is not
    zero, <VAR>p2</VAR> is the coefficient for the polar Fourier term,
    cos(2*pi*<VAR>g</VAR>*r) * sin(<VAR>h</VAR>*theta).  If <VAR>g</VAR> and
    <VAR>h</VAR> are both not zero, then <VAR>p2</VAR> is the coefficient for
    the polar Fourier term, cos(2*pi*<VAR>g</VAR>*r) * sin(<VAR>h</VAR>*theta),
    <VAR>p3</VAR> is the coefficient for the polar Fourier term,
    sin(2*pi*<VAR>g</VAR>*r) * cos(<VAR>h</VAR>*theta), and <VAR>p4</VAR>
    is the coefficient for the polar Fourier term,
    sin(2*pi*<VAR>g</VAR>*r) * sin(<VAR>h</VAR>*theta).
  <DT>polar_fourier_coeff_phase_<VAR>i</VAR><DD>Specifies the coefficients
    for the polar Fourier terms used to fit the residual of the pupil function
    phase for the <VAR>i</VAR>th wavelength (where <VAR>i</VAR> is greater
    than or equal to zero and less than the number of wavelengths
    set by the wavelength_count attribute).  To be effective, this attribute
    should appear after the wavelength_count and
    polar_fourier_set_for_phase attributes in the file.  This attribute
    has no attribute values and the coefficient values follow, one per line,
    where each line has the form:
    <VAR>g</VAR> <VAR>h</VAR> <VAR>p1</VAR> [<VAR>p2</VAR> [<VAR>p3</VAR> <VAR>p4</VAR>]].
    <VAR>g</VAR> is an integer greater than or equal to zero and less than
    or equal to the first attribute value, <VAR>n</VAR>, set by the
    polarf_set_for_phase attribute.  <VAR>h</VAR> is an integer greater
    than or equal to zero and less than or equal to the second attribute
    value, <VAR>m</VAR>, set by the polarf_set_for_phase attribute.
    <VAR>p1</VAR> is the coefficient for the polar Fourier term,
    cos(2*pi*<VAR>g</VAR>*r) * cos(<VAR>h</VAR>*theta).  If <VAR>g</VAR> is
    not zero and <VAR>h</VAR> is zero, <VAR>p2</VAR> is the coefficient for
    the polar Fourier term, sin(2*pi*<VAR>g</VAR>*r) * cos(<VAR>h</VAR>*theta).
    If <VAR>g</VAR> is zero and <VAR>h</VAR> is not zero, <VAR>p2</VAR> is the
    coefficient for the polar Fourier term,
    cos(2*pi*<VAR>g</VAR>*r) * sin(<VAR>h</VAR>*theta).  If <VAR>g</VAR> and
    <VAR>h</VAR> are both not zero, then <VAR>p2</VAR> is the coefficient for
    the polar Fourier term, cos(2*pi*<VAR>g</VAR>*r) * sin(<VAR>h</VAR>*theta),
    <VAR>p3</VAR> is the coefficient for the polar Fourier term,
    sin(2*pi*<VAR>g</VAR>*r) * cos(<VAR>h</VAR>*theta), and <VAR>p4</VAR>
    is the coefficient for the polar Fourier term,
    sin(2*pi*<VAR>g</VAR>*r) * sin(<VAR>h</VAR>*theta).
</DL>

<P>As an example, here's what the file would look like for an ideal pupil
(no variation in amplitude or phase out to the limit imposed by the
numerical aperture) with numerical aperture of 1.3, immersion media refractive
index of 1.5180, and a wavelength of 630 nanometers:

<PRE>
#parametric_pupil_format 0
#numerical_aperture 1.3
#immersion_refractive_index 1.5180
#lens_id 0
#zernike_set_for_amplitude 0 0
#zernike_set_for_phase -1 0
#polar_fourier_set_for_amplitude -1 -1
#polar_fourier_set_for_phase -1 -1
#wavelength_count 1
#wavelengths_um 0.63
#zernike_coeff_amplitude_0
0 0 1
</PRE>

<H3>Topics</H3>
<P><A HREF="#otf_and_pupil">OTFs and pupil functions</A> |
   <A HREF="#selecting_otf">Selecting the OTF or pupil function</A> |
   <A HREF="#measuring_otf">Measuring the OTF or pupil function</A> |
   OTF or pupil function file formats
<HR>

</BODY>
</HTML>
