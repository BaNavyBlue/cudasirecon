<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
  <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <TITLE>Priism Help: Tracer / 3DModel's automodel</TITLE>
  <META NAME="Description" CONTENT="On-line help for a semiautomatic method to trace tubular structures.">
  <META NAME="Keywords" CONTENT="Priism,modeling,segmentation,semiautomatic,tubular">
  <LINK REV=MADE HREF="mailto:ive@msg.ucsf.edu">
</HEAD>
<BODY>

<H1><A NAME="Tracer">Tracer / 3DModel's automodel</A></H1>
<H2>Overview</H2>
<P>The stand-alone application Tracer and the automodel option in
<A HREF="3DModel.html">3DModel</A>'s options menu will both trace the axis
of tubular structures.  The tracing done by Tracer is fully automatic.
It searches for a point whose intensity is larger than the
<A HREF="#upper_thresh">upper threshold</A>, traces from there, and, after
marking the regions already searched, repeats the process.  With 3DModel's
automodel option, the starting point is an object which contains a single
point (unless you use the <A HREF="#find">"monitor steps" option</A>, where
the current point of the current object is used).  Both assume that the
input image data is 16-bit signed integers (shorts) and that it comes from
an image window.  <A HREF="CopyRegion.html">CopyRegion</A> can be used to
force that data to have that form; if you want to scale the data,
<A HREF="ImageArith.html">Image Arithmetic</A> may be used.

<H3>Topics</H3>
<P>
  <A HREF="#model_file">Model file</A> |
  <A HREF="#tracer_window">Window</A> |
  <A HREF="#upper_thresh">Upper threshold</A> |
  <A HREF="#lower_thresh">Lower threshold</A> |
  <A HREF="#step">Step size</A> |
  <A HREF="#sample">Sample size</A> |
  <A HREF="#zbox">Z box</A> |
  <A HREF="#max_ang">Max turn</A> |
  <A HREF="#gaussian">Gaussian</A> |
  <A HREF="#search">Search method</A> |
  <A HREF="#find">Find</A> |
  <A HREF="#step_limit">Step limit</A> |
  <A HREF="#start_search">Start search</A> |
  <A HREF="#undo_last">Undo last</A>

<H3>Related Priism Topics</H3>
<P>
  <A HREF="3DModel.html">3DModel</A> |
  <A HREF="CopyRegion.html">Copy Region</A> |
  <A HREF="ImageArith.html">Image Arithmetic</A> |
  <A HREF="Priism.html">Priism</A>
<HR>

<H2><A NAME="model_file">Model file</A></H2>
<P>When run as a stand-alone application, use this field to supply the name of the file to store the traced structures.

<P><A HREF="#Tracer">Return to overview.</A>
<HR>

<H2><A NAME="tracer_window">Window</A></H2>
<P>For the automodel option in 3DModel, enter which of image windows to
use in the "In window" field.  For the stand-alone tracing program, the
input can come from an image window; the number is specified in
the "In" field in the stand-alone program's main dialog.

<P><A HREF="#Tracer">Return to overview.</A>
<HR>

<H2><A NAME="upper_thresh">Upper threshold</A></H2>
<P>The stand-alone Tracer, a seed point to start tracing must first be
found.  Only those points whose intensities are greater than the
value shown in the "upper threshold" field are considered as possible seed
points (a seed point must also be two or more pixels from the edge of the
data set).

<P><A HREF="#Tracer">Return to overview.</A>
<HR>

<H2><A NAME="lower_thresh">Lower threshold</A></H2>
<P>The value in the "lower threshold" field is the lowest intensity level
that should be considered part of an object.

<P><A HREF="#Tracer">Return to overview.</A>
<HR>

<H2><A NAME="step">Step size</A></H2>
<P>The points in the traced structure will be a fixed distance, <VAR>d</VAR>
apart where <VAR>d</VAR> is the value shown in the "sample size" field times
the x pixel spacing.  The step size may also influence the region over
which intensity values are averaged; see the
<A HREF="#search">search method</A> topic for details.

<P>A recommended value for the step size is one that is greater than
half the thickness of the object and less than the distance between separate
structures.

<P><A HREF="#Tracer">Return to overview.</A>
<HR>

<H2><A NAME="sample">Sample size</A></H2>
<P>When tracing a structure, the program samples the average intensity of
blocks of pixels.  The size of the blocks is controlled by the value shown
in the "sample size" field (for more details also see the description under
the <A HREF="#search">search method</A> topic).  A good choice for the
sampling size is the thickness of the structure to be traced.

<P><A HREF="#Tracer">Return to overview.</A>
<HR>

<H2><A NAME="zbox">Z box</A></H2>
<P>In the stand-alone Tracer, the value shown in the "z box" field sets
the half-width in sections of the region searched to find a starting point
for tracing once a point above the <A HREF="#upper_thresh">upper threshold</A>
is found.  Also, once an object is traced, the region about it is marked as
already searched.  The "z box" value is the half-width in z about the object's
axis for the region so marked.

<P>In the stand-alone Tracer and in 3DModel's automodel option when only
one point is available to start with, the "z box" field also sets the half-
width in z to search when locating the second point in the object.

<P><A HREF="#Tracer">Return to overview.</A>
<HR>

<H2><A NAME="max_ang">Max turn</A></H2>
<P>When considering the next point to be added, a limit is applied to how
much the structure can bend.  This helps avoid the search from turning back
on itself.  The maximum deviation allowed from the line joining the two
previous points is shown in the menu next to the "max turn" label.  The
values are in degrees.

<P><A HREF="#Tracer">Return to overview.</A>
<HR>

<H2><A NAME="gaussian">Gaussian</A></H2>
<P>When the "gaus" toggle is on, the intensities averaged over the
<A HREF="#search">sample region</A> are weighted so that the those close to
the center of the region contribute more than those on the edge.

<P><A HREF="#Tracer">Return to overview.</A>
<HR>

<H2><A NAME="search">Search method</A></H2>
<P>Two different algorithms are available for tracing structures.  Depending
on which you use, you may wish to set the <A HREF="#step">step size</A>
and <A HREF="#sample">sample size</A> differently.  Both methods first
look straight ahead in the direction of the last two points added to the
structure and then in consecutively larger circles around the direction until
a maximum integrated intensity is found.  The difference in the two algorithms
is the shape of the area used to calculate the integrated intensity:

<DL>
  <DT>max intens<DD>Uses a sphere centered at each test point with a radius
    equal to the sample size divided by two.
  <DT>max tube<DD>Uses a cylinder which starts at the last point added and
    has a length equal to the step size and a radius equal to the sample
    size divided by two.
</DL>

<P><A HREF="#Tracer">Return to overview.</A>
<HR>

<H2><A NAME="find">Find</A></H2>
<P>With 3DModel's automodel option, you can choose to have the search algorithm
run to completion (it searches until it reaches the edge of the data set or
can no longer find any points meeting the <A HREF="#lower_thresh">intensity
threshold</A>; it then returns to the starting point and searches in the
opposite direction) or to have the search stop after a certain number of points
have been added (subsequent iterations then start at the current point of the
current object).  To use the former, select the "entire object" option in the
"find" menu.  For the latter, select the "monitor steps" option in the find
menu and enter the number of points to be added in each step into the
<A HREF="#step_limit">step limit</A> field.

<P><A HREF="#Tracer">Return to overview.</A>
<HR>

<H2><A NAME="step_limit">Step limit</A></H2>
<P>When using 3DModel's automodel option with the "monitor steps"
<A HREF="#search">search method</A>, the value shown in the "step limit" field
is the maximum number of points that will be added during each search.  If the
limit is zero, the search will continue until a boundary set by the lower
<A HREF="#lower_thresh">lower threshold</A> is crossed (i.e. just as if the
"entire object" search method were used).

<P><A HREF="#Tracer">Return to overview.</A>
<HR>

<H2><A NAME="start_search">Start search</A></H2>
<P>When run from 3D Model, press the "Start search" button (or the s key while
the mouse is positioned over the <A HREF="#tracer_window">window used for
tracing</A>), to start tracing a structure or to continue tracing a structure
when using the <A HREF="#find">"monitor steps" option</A>.

<P><A HREF="#Tracer">Return to overview.</A>
<HR>

<H2><A NAME="undo_last">Undo last</A></H2>
<P>When used from 3D model, pressing the "undolast" button will undo the
points added to the model by the last search.  If the
<A HREF="#find">"entire object" option</A> is used, this will also undo your
starting point, so you will need to reselect a new starting location.

<P><A HREF="#Tracer">Return to overview.</A>
<HR>

</BODY>
</HTML>
