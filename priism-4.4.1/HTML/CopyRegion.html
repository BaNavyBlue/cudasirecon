<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
  <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <TITLE>Priism Help: Copy Region</TITLE>
  <META NAME="Description" CONTENT="On-line help for Priism's application to copy portions of a data set to a new data set.">
  <META NAME="Keywords" CONTENT="Priism">
  <LINK REV=MADE HREF="mailto:ive@msg.ucsf.edu">
</HEAD>
<BODY>

<H1><A NAME="CopyRegion">Copy Region</A></H1>
<H2>Overview</H2>

<P>CopyRegion copies (with an <A HREF="#Conversions">optional conversion
of data types</A>, change of the <A HREF="#ByteOrder">byte order</A> or
change of the <A HREF="#HeaderFormat">header format</A>) all or part of a data
set to a new data set.  CopyRegion's user interface uses the
<A HREF="Region.html">same set of controls</A> for selecting and processing a
region as other Priism applications.  Besides the controls for the
<A HREF="#HeaderFormat">header format</A> and
<A HREF="#ByteOrder">byte order</A>, the other controls are used when the new
data set is written to a window.  The <A HREF="#RGB">RGB</A> toggle selects
whether multiple wavelengths are displayed simultaneously as different color
components in a single image or if images contain a single wavelength in
pseudocolor.  The <A HREF="#AutoScl">AutoScl</A> and
<A HREF="#Restore">Restore</A> buttons as well as the <A HREF="#W_SCL">fields
for the scaling on each wave</A> select how the data is mapped to the pixel
values displayed in the image.

<P>When used to open a complete data set in an image window, CopyRegion is very
similar to <A HREF="ViewFile.html">ViewFile</A>.  The difference is that
CopyRegion makes a copy of the data in memory (and scratch space on the
local file system) while ViewFile only loads the data as needed and does
not have to keep a copy (though it may do so while space is available).
The effect of these differences is that ViewFile returns control to the
user more quickly, but once control is returned, the initial access to the
data and images is faster when CopyRegion is used.  Using CopyRegion instead
of ViewFile also increases the amount of memory and disk space that Priism
uses.

<H3>Topics</H3>
<P>
  Overview |
  <A HREF="Region.html">Region processing</A> |
  <A HREF="#HeaderFormat">Header format</A> |
  <A HREF="#ByteOrder">Byte order</A> |
  <A HREF="#RGB">RGB</A> |
  <A HREF="#AutoScl">AutoScl</A> |
  <A HREF="#Restore">Restore</A> |
  <A HREF="#W_SCL">Wave scales</A> |
  <A HREF="#Conversions">Conversions</A> |
  <A HREF="#CommandLine">Command line</A>

<H3>Related Priism Topics</H3>
<P>
   <A HREF="Priism.html">Priism</A> |
   <A HREF="ViewFile.html">ViewFile</A> |
   <A HREF="Scale.html#Scale">Scale values</A>

<HR>

<H2><A NAME="HeaderFormat">Header Format</A></H2>
<P>Priism's native file format is a variant of the MRC file format used in
x-ray crystallography.  Priism supports two different header formats for those
files.  One is intended to be compatible with the
<A HREF="http://www2.mrc-lmb.cam.ac.uk/image2000.html" TARGET="top">Image2000 format</A>.
The other is particular to Priism. The
<A HREF="IM_ref2.html#ImageFormat">documentation for Priism's IM library</A>
describes the header formats in more detail.

<P>When writing a new data set or overwriting an existing data set, CopyRegion
can change the header format used if the output has a single wavelength (only
Priism's header format directly handles multiple wavelengths and CopyRegion
will always use it when the output has multiple wavelengths).  You would
normally only do this to import or export data from Priism.  By default,
CopyRegion's output will have the same header format as the input does.  To
change the header format that will be used, change the menu next to the button
labeled "Header" in CopyRegion's main dialog.  The choices in the menu are:
<DL>
  <DT>input or input (Priism) or input (Image2000)<DD>Use the header format
    from the input.  CopyRegion will change the choice to "input (Priism)"
    or "input (Image2000)" to indicate the header format of the input.
  <DT>Priism<DD>Use the header format particular to Priism.
  <DT>Image2000<DD>Use Image2000's header format with the additional fields
    from Priism's format that do not conflict with those in the Image2000
    format.
</DL>

<P>You can get results similar to using CopyRegion with the header format
set to "Image2000" by running <A HREF="mrc2image2000.html">mrc2image2000</A>
or <A HREF="mrc2ccp4.html">mrc2ccp4</A>.  CopyRegion will retain any portions
of the header that do not overlap with portions specified by the Image2000
format and will also carry over Priism's extended header and lower resolution
data.  mrc2image2000 and mrc2ccp4 will only use the header fields defined by
those formats (all the rest of the header will be set to zero), will convert
the image samples to floating-point or complex-valued floating-point, and
strip any Priism-style extended header or lower resolution information.

<H3>Topics</H3>
<P>
  <A HREF="#CopyRegion">Overview</A> |
  <A HREF="Region.html">Region processing</A> |
  Header format |
  <A HREF="#ByteOrder">Byte order</A> |
  <A HREF="#RGB">RGB</A> |
  <A HREF="#AutoScl">AutoScl</A> |
  <A HREF="#Restore">Restore</A> |
  <A HREF="#W_SCL">Wave scales</A> |
  <A HREF="#Conversions">Conversions</A> |
  <A HREF="#CommandLine">Command line</A>

<HR>

<H2><A NAME="ByteOrder">Byte Order</A></H2>
<P>When writing a new data set or overwriting an existing data set, CopyRegion
can change the byte order used for the data.  Since Priism's applications
accept both byte orders (big- and little-endian), changing the byte order is
usually only useful when exporting data.  By default, CopyRegion will write
data in the computer's native byte order.  You can force CopyRegion to use
a different order by changing the menu next to the button labeled
"Byte order" in CopyRegion's main dialog.  The choices in the menu are:
<DL>
  <DT>machine (big) or machine (little)<DD>Use the computer's
    native order.  If the computer is big endian, the choice in the menu is
    "machine (big)"; otherwise, the choice in the menu is "machine (little)".
  <DT>input or input (big) or input (little)<DD>Use the byte order of
    the input.  CopyRegion will change the choice to "input (big)" or
    "input (little)" to indicate whether the input is big- or little- endian.
  <DT>big-endian<DD>Use big-endian order for the output.
  <DT>little-endian<DD>Use little-endian order for the output.
</DL>

<H3>Topics</H3>
<P>
  <A HREF="#CopyRegion">Overview</A> |
  <A HREF="Region.html">Region processing</A> |
  <A HREF="#HeaderFormat">Header format</A> |
  Byte order |
  <A HREF="#RGB">RGB</A> |
  <A HREF="#AutoScl">AutoScl</A> |
  <A HREF="#Restore">Restore</A> |
  <A HREF="#W_SCL">Wave scales</A> |
  <A HREF="#Conversions">Conversions</A> |
  <A HREF="#CommandLine">Command line</A>

<HR>

<H2><A NAME="RGB">RGB</A></H2>
<P>When the output of CopyRegion is written to an image window, select
this toggle to have the data displayed with multiple wavelengths combined
to form a single image.  Up to three wavelengths can be displayed
simultaneously with each wavelength assigned a different primary color
(red, green, or blue).  If the toggle is not selected, wavelengths are not
superimposed and the image is shown in pseudocolor (typically shades of
grey).  The RGB toggle only affects how the data is displayed initially;
use the <A HREF="Monitor.html">controls on the image window</A> to switch
between the display mades after CopyRegion has written the data.

<H3>Topics</H3>
<P>
  <A HREF="#CopyRegion">Overview</A> |
  <A HREF="Region.html">Region processing</A> |
  <A HREF="#HeaderFormat">Header format</A> |
  <A HREF="#ByteOrder">Byte order</A> |
  RGB |
  <A HREF="#AutoScl">AutoScl</A> |
  <A HREF="#Restore">Restore</A> |
  <A HREF="#W_SCL">Wave scales</A> |
  <A HREF="#Conversions">Conversions</A> |
  <A HREF="#CommandLine">Command line</A>

<HR>

<H2><A NAME="AutoScl">AutoScl</A></H2>
<P>Select this toggle when you want each section, when copied to an image
window, to be displayed in such a way that the range of data values in the
section maps to the full range of image values.  The default scaling parameters
for each wave will still be those set from the <A HREF="#W_SCL">wave scaling
controls</A>, but each section will have its own scaling parameters set and
those defaults won't take effect.

<H3>Topics</H3>
<P>
  <A HREF="#CopyRegion">Overview</A> |
  <A HREF="Region.html">Region processing</A> |
  <A HREF="#HeaderFormat">Header format</A> |
  <A HREF="#ByteOrder">Byte order</A> |
  <A HREF="#RGB">RGB</A> |
  AutoScl |
  <A HREF="#Restore">Restore</A> |
  <A HREF="#W_SCL">Wave scales</A> |
  <A HREF="#Conversions">Conversions</A> |
  <A HREF="#CommandLine">Command line</A>

<HR>

<H2><A NAME="Restore">Restore</A></H2>
<P>Use this button to load the <A HREF="#W_SCL">wave scaling values</A> that
had been used previously with the input data set and had been saved from
the image window's <A HREF="Scale.html">Scale function</A>.

<H3>Topics</H3>
<P>
  <A HREF="#CopyRegion">Overview</A> |
  <A HREF="Region.html">Region processing</A> |
  <A HREF="#HeaderFormat">Header format</A> |
  <A HREF="#ByteOrder">Byte order</A> |
  <A HREF="#RGB">RGB</A> |
  <A HREF="#AutoScl">AutoScl</A> |
  Restore |
  <A HREF="#W_SCL">Wave scales</A> |
  <A HREF="#Conversions">Conversions</A> |
  <A HREF="#CommandLine">Command line</A>

<HR>

<H2><A NAME="W_SCL">Wave scaling parameters</A></H2>
<P>When CopyRegion writes its output to a window and the
<A HREF="#AutoScl">AutoScl</A> toggle is not on, these values set how
the data is mapped to the quantities shown in the image.  For details about how
this mapping is done, see the <A HREF="Scale.html#Scale">"Scaling Values"
topic</A> in the documentation for the
<A HREF="Scale.html">image window's Scale application</A>.

<P>If CopyRegion's input is a window, the default scale values are those
for that window.  When the input is a file, the default scale values are
drawn from the minimum and maximum values recorded in the file's header.  If
you have looked at a file before and saved the scale parameters used (the
<A HREF="Scale.html">documentation for Scale</A> describes how to do this),
you can use the <A HREF="#Restore">Restore button</A> to load those scale
parameters.

<H3>Topics</H3>
<P>
  <A HREF="#CopyRegion">Overview</A> |
  <A HREF="Region.html">Region processing</A> |
  <A HREF="#HeaderFormat">Header format</A> |
  <A HREF="#ByteOrder">Byte order</A> |
  <A HREF="#RGB">RGB</A> |
  <A HREF="#AutoScl">AutoScl</A> |
  <A HREF="#Restore">Restore</A> |
  Wave scales |
  <A HREF="#Conversions">Conversions</A> |
  <A HREF="#CommandLine">Command line</A>

<HR>

<H2><A NAME="Conversions">Conversions</A></H2>
<P>By default, the data type of the output from CopyRegion is the same
as the data type of the input.  If the output data type (selected with the
<A HREF="Region.html#MODE">Mode control</A>) is not the default, then a
conversion is done.  There are three special cases for the conversion
process:

<UL>
<LI>When converting data to bytes, the <A HREF="#W_SCL">wave
scale values</A> are used to map the data to values between 0 and 255.  The
case where the first two scaling values are zero is treated like any other for
this conversion.

<LI>When converting complex data to any of the purely real formats, only
the real part is converted; the imaginary part is discarded.

<LI>For the conversion of a purely real format to a complex one, the imaginary
part of the result is set to zero and the real part is set to the converted
value.
</UL>

<H3>Topics</H3>
<P>
  <A HREF="#CopyRegion">Overview</A> |
  <A HREF="Region.html">Region processing</A> |
  <A HREF="#HeaderFormat">Header format</A> |
  <A HREF="#ByteOrder">Byte order</A> |
  <A HREF="#RGB">RGB</A> |
  <A HREF="#AutoScl">AutoScl</A> |
  <A HREF="#Restore">Restore</A> |
  <A HREF="#W_SCL">Wave scales</A> |
  Conversions |
  <A HREF="#CommandLine">Command line</A>

<HR>

<H2><A NAME="CommandLine">Command Line</A></H2>
<P>CopyRegion accepts the command-line arguments described in
<A HREF="Region.html#COMMANDLINE">Region.html</A>.  In addition, it has
the following options (parts in brackets are optional):

<DL>
  <DT><CODE>-autoscale</CODE>
  <DD>If this option is present and the output is an image window, each
    section will be scaled separately as described in the
    <A HREF="#AutoScl">AutoScl topic</A>.

  <DT><CODE>-endian=</CODE><VAR>format</VAR>
  <DD>Sets the <A HREF="#ByteOrder">byte order</A> for the output when not
    appending to an existing data set.  <VAR>format</VAR> must be of the
    following:
    <DL>
      <DT>machine<DD>Uses the computer's native byte order.  That is what
        will get if you do not use the <CODE>-endian</CODE> option.
      <DT>input<DD>Uses the byte order of the input.
      <DT>big<DD>Uses big-endian byte order.
      <DT>little<DD>Uses little-endian byte order.
    </DL>

  <DT><CODE>-header=</CODE><VAR>format</VAR>
  <DD>Sets the <A HREF="#HeaderFormat">header format</A> for the output when
    not appending to an existing data set.  <VAR>format</VAR> must be one of
    the following:
    <DL>
      <DT>input<DD>Uses the header format from the input.  This is what you
        will get if you do not use the <CODE>-header</CODE> option.
      <DT>priism<DD>Uses Priism's header format.
      <DT>image2000<DD>Uses the Image2000 format.  If the output would has
        multiple wavelengths, CopyRegion will ignore this and use Priism's
        header format.
    </DL>

  <DT><CODE>-restore_scale</CODE>
  <DD>If the this option is present, CopyRegion will look up the scaling
    values for the input in the recently saved parameters from the image
    window's <A HREF="Scale.html">scale function</A>.  If scaling values
    for the input are found, then those are used and any -scl options
    (see below) are ignored.

  <DT><CODE>-rgb</CODE>
  <DD>If this option is present and the output is an image window, the
    data will be displayed with multiple wavelengths superimposed as
    different color components in the same image.

  <DT><CODE>-scl1=</CODE><VAR>bound1</VAR>[<CODE>:</CODE><VAR>bound2</VAR>[<CODE>:</CODE><VAR>exp</VAR>[<CODE>:</CODE><VAR>flag</VAR>]]]
  <DD>Sets the scaling parameters for the output drawn from the first
    wavelength of the input.  Takes one to four parameters; parameters not
    specified take on their default values (see the
    <A HREF="#W_SCL">Wave scales topic</A> for what the default values are).
    The first two parameters are the intensity bounds for scaling, the third
    is the exponent, and the fourth sets what happens to data values outside of
    the intensity bounds.  The documentation for the image window's
    <A HREF="Scale.html">Scale function</A> describes the parameters in
    more detail.  The scaling parameters set by this option will have no
    effect if you also use <CODE>-autoscale</CODE>; they may also be overrided
    when you use <CODE>-restore_scale</CODE>.  There are similar options
    (<CODE>-scl2</CODE>, <CODE>-scl3</CODE>, <CODE>-scl4</CODE>, and
    <CODE>-scl5</CODE>) to set the scaling for the output from other input
    wavelengths.
</DL>

<P>As an example, the following copies the first two wavelengths from fish.dat
into window 3 using a reversed scaling between 500 and 2500 for the first
wavelength and a scaling between 700 and 3000 with a gamma correction factor
of 0.5 for the second wavelength:
<PRE>
    CopyRegion fish.dat 3 -w=0:1 -scl1=2500:500 -scl2=700:3000:0.5
</PRE>

<H3>Topics</H3>
<P>
  <A HREF="#CopyRegion">Overview</A> |
  <A HREF="Region.html">Region processing</A> |
  <A HREF="#HeaderFormat">Header format</A> |
  <A HREF="#ByteOrder">Byte order</A> |
  <A HREF="#RGB">RGB</A> |
  <A HREF="#AutoScl">AutoScl</A> |
  <A HREF="#Restore">Restore</A> |
  <A HREF="#W_SCL">Wave scales</A> |
  <A HREF="#Conversions">Conversions</A> |
  Command line
<HR>

</BODY>
</HTML>
