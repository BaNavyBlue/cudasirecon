<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
  <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <TITLE>Priism Help: mrc2ccp4</TITLE>
  <META NAME="Description" CONTENT="On-line help for converter from Priism's native file format to CCP4's variant of the MRC format.">
  <META NAME="Keywords" CONTENT="Priism,convert,CCP4">
  <LINK REV=MADE HREF="mailto:ive@msg.ucsf.edu">
</HEAD>
<BODY>

<H1><A NAME="mrc2ccp4">Convert from Priism's Native Format to CCP4's Variant of
the MRC Format</A></H1>
<H2>Overview</H2>
<P>This application takes a Priism file and writes it out as a file in
<A HREF="http://www.ccp4.ac.uk" TARGET="_top">CCP4</A>'s native format.

<P>mrc2ccp4 has the <A HREF="Region.html">standard set of Priism controls</A>
for selecting a subset of the Priism file to convert.  For the conversion,
enter the name of the file to be generated in the
<A HREF="#output_file">"Output file"</A> field.  If the input file uses
floating-point values or complex floating-point values to represent the
data, mrc2ccp4 can perform the conversion in place (in other words, the
output file name can be the same as the input file name); otherwise, the
output file name must be different than the input file name.  By default,
mrc2ccp4 will generate a file using the native byte ordering for the operating
system and machine where you run mrc2ccp4.  To generate a file with the
non-native byte ordering, turn on the <A HREF="#swap_bytes">"swap bytes"</A>
toggle button.

<P>mrc2ccp4 by default does not set a skew transformation in the header of
the CCP4 file.  If you turn on the "include skew" toggle button, mrc2ccp4
will include the skew transformation calculated from the rotation angles and
origin in the Priism file's header:  consult the
<A HREF="#include_skew">"Include Skew"</A> topic for details about the
transformation.

<P>mrc2ccp4 will only convert the first wavelength and time point that you
select.  mrc2ccp4 will not transfer the wavelength information from the
Priism header.  It only transfers the extended header if the extended header
appears to contain symmetry information (i.e. the space group field in the
header is not zero).

<H3>Topics</H3>
<P>
    Overview |
    <A HREF="Region.html">Region processing</A> |
    <A HREF="#output_file">Output file</A> |
    <A HREF="#swap_bytes">Swap bytes</A> |
    <A HREF="#include_skew">Include skew</A> |
    <A HREF="#CommandLine">Command line</A>

<H3>Related Priism Topics</H3>
<P>
    <A HREF="Priism.html">Priism</A>
<HR>

<H2><A NAME="output_file">Output File</A></H2>
<P>Enter the name of the CCP4 file to generate in the field next to the
"Output file" button or use the "Output file" button to select the file with
a file selection dialog.  As currently implemented, mrc2ccp4 will allow the
input file and the output file to be the same (i.e. the conversion is
performed in place) if the input file uses floating-point or complex
floating-point values to represent the data.

<P><A HREF="#mrc2ccp4">Return to overview</A>
<HR>

<H2><A NAME="swap_bytes">Swap Bytes</A></H2>
<P>By default, mrc2ccp4 generates CCP4 files in the native byte ordering
for the machine and operating system where you run mrc2ccp4.  To generate
a file with the non-native byte ordering, turn on the "swap bytes" toggle
button.

<P><A HREF="#mrc2ccp4">Return to overview</A>
<HR>

<H2><A NAME="include_skew">Include Skew</A></H2>
<P>By default, mrc2ccp4 does not set a skew transformation in the header of
the CCP4 file.  If you turn on the "include skew" toggle button, mrc2ccp4
will include a transformation matrix and translation vector in the header.
The transformation matrix entries (s11, s12, ...) will be the product of
three matrices as given by:

<PRE>
[ s11  s12  s13 ]   [ 1     0        0    ] [  cos(b)  0   sin(b) ] [  cos(g)  -sin(g)  0 ]
[ s21  s22  s23 ] = [ 0   cos(a)  -sin(a) ] [    0     1     0    ] [  sin(g)   cos(g)  0 ]
[ s31  s32  s33 ]   [ 0   sin(a)   cos(a) ] [ -sin(b)  0   cos(b) ] [    0        0     1 ]
</PRE>

<P>where a, b, and g are the 4-byte floating-point values, in units of degrees,
at bytes 185 through 188, 189 through 192, and 193 through 196, respectively in
the Priism header.  The translation will be the product of the inverse of the
S matrix times the origin values in the Priism header (o1, o2, and o3 are the
4-byte floating-point values at bytes 213 through 216, 217 through 220, and
209 through 212, respectively):

<PRE>
[ t1 ]   [  cos(g)   sin(g)  0 ] [  cos(b)  0  -sin(b) ] [  1     0        0    ] [ o1 ]
[ t2 ] = [ -sin(g)   cos(g)  0 ] [    0     1     0    ] [  0   cos(a)   sin(a) ] [ o2 ]
[ t3 ]   [    0        0     1 ] [  sin(b)  0   cos(b) ] [  0  -sin(a)   cos(a) ] [ o3 ]
</PRE>

<P>The matrix and translation are intended to be consistent with Priism's
geometric conventions:  like those conventions, they do not take into
account nonorthogonal coordinate axes.

<P><A HREF="#mrc2ccp4">Return to overview</A>
<HR>

<H2><A NAME="CommandLine">Command Line</A></H2>
<P>mrc2ccp4 accepts the command-line arguments described in
<A HREF="Region.html#COMMANDLINE">Region.html</A>.  In addition, it has
the following options:

<DL>
  <DT><CODE>-out=</CODE><VAR>n</VAR>
  <DD>Sets the name of the output file to be <VAR>n</VAR>.  If you do not
    include this option, mrc2ccp4 attempts to perform the conversion in
    place.

  <DT><CODE>-swab</CODE>
  <DD>Causes mrc2ccp4 to generate files with the non-native byte ordering.
    By default, mrc2ccp4 generates files with the native byte ordering.

  <DT><CODE>-skew</CODE>
  <DD>Causes mrc2ccp4 to set the skew transformation entries in the header
    from the tilt angles and origin of the Priism file.  For details,
    consult the <A HREF="#include_skew">"Include Skew"</A> topic.
</DL>

<P>The example below extracts a 160 x 160 x 160 region from a.dat
and writes it to a.ccp4 in the non-native byte ordering.

<PRE>
    mrc2ccp4 a.dat -x=0:159 -y=0:159 -z=0:159 -out=a.ccp4 -swab
</PRE>

<P><A HREF="#mrc2ccp4">Return to overview</A>
<HR>

</BODY>
</HTML>
