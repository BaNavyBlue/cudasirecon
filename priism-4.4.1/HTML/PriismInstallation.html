<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
  <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <TITLE>Installation Instructions for Priism 4</TITLE>
  <META NAME="Author" CONTENT="IVE Development Team">
  <META NAME="Description" CONTENT="Describes how to install Priism 4.">
  <META NAME="Keywords" CONTENT="IVE,Priism,installation">
  <LINK REV=MADE HREF="mailto:ive@msg.ucsf.edu">
</HEAD>

<BODY>

<H1>Installation Instructions for Priism 4</H1>

<P>The instructions below describe the installation of Priism.  If Priism was
packaged with version 3.2 of the VolumePro 1000 driver, the compressed archive
containing the driver is in the vp1000 directory of the Priism distribution.
Follow the instructions in vp1000/VP1000ReleaseNotes-Linux.txt to install
the driver (ignore the final step in the installation instructions and the
verification procedure since the include files and silver demonstration
application are not included).

<H2><A NAME="Step1">1.  Unpack the downloaded archvive</A></H2>
<P>Uncompress the files from the downloaded archive.  From the command line
this can be done as follows where <VAR>archive</VAR> should be replaced with
the full path name of the downloaded file:

<BLOCKQUOTE>
  <CODE>gunzip -c</CODE> <VAR>archive</VAR> <CODE>| tar -xf -</CODE>
</BLOCKQUOTE>

<P>This will place the files in a directory called priism-<VAR>version</VAR>
where <VAR>version</VAR> is the version number (for example, 4.2.3).  You
can move that directory or change its name.

<P>Some browsers will automatically uncompress the archive when you
download it.  In that case, gunzip will complain that the file is not
in gzip format, and you would want to use the following commands instead:

<BLOCKQUOTE>
  <CODE>tar -xf</CODE> <VAR>archive</VAR>
</BLOCKQUOTE>

<P>Other browers will automatically uncompress the archive and extract
the component files into a new directory.  In that case, simply move
or rename that directory so it is where you want Priism to be installed.

<HR>

<H2><A NAME="Step2">2.  Run post_install.sh</A></H2>
<P>post_install.sh fixes up the paths in the Priism setup files.  On Mac OS X
it also updates the symbol tables of the archive libraries included with
Priism.  On Linux and Mac OS X systems, post_install.sh will also ask
about the location of Matlab (if it is installed) to configure the Priism to
.mat file converters.

<P>The easiest way to run post_install.sh is to use the Finder on Mac OS X
or a file manager on Linux to open the directory where Priism is installed
and then double-click on the file with the name, post_install.command.  You
could also run it from the command-line as follows:

<BLOCKQUOTE>
  <CODE>cd</CODE> <VAR>install_dir</VAR><BR>
  <CODE>./post_install.sh</CODE>
</BLOCKQUOTE>

<P>where you would replace <VAR>install_dir</VAR> with the path to where you
put Priism in the first step.

<HR>

<H2><A NAME="Step3">3.  Try it out</A></H2>
<P>Before starting Priism, an X server must be running and the DISPLAY
environment variable must be set appropriately so clients can connect to
the server (setting the DISPLAY to :0.0 is generally appropriate for clients
connecting to an X server running on the same machine).  In Mac OS X 10.5
or later, Apple's X11 will start on demand, so you do not need to start it
before starting Priism.

<P>On Mac OS X 10.5 or later or Linux with an X server already running, you
can use the Finder or file manager to double-click on the Priism.command file
in the Priism installation directory and that should start Priism.  From the
command-line, you can use the following to start Priism if csh or tcsh is
your shell:

<BLOCKQUOTE>
  <CODE>source</CODE> <VAR>install_dir</VAR><CODE>/Priism_setup</CODE><BR>
  <CODE>Priism</CODE>
</BLOCKQUOTE>

<P>If you use sh or an sh-compatible shell like bash, the you should now
be able to start Priism by entering the follow at the command line:

<BLOCKQUOTE>
  <CODE>.</CODE> <VAR>install_dir</VAR><CODE>/Priism_setup.sh</CODE><BR>
  <CODE>Priism</CODE>
</BLOCKQUOTE>

<P>In all cases, a thin dialog containing a menu bar should appear (some
window managers may expect you to select a location for the dialog before is
is shown).  If the dialog does not appear, check that you did run
post_install.sh and have installed the other required libraries.

<HR>

<H2><A NAME="Step4">4.  Customize Priism_setup and Priism_setup.sh (optional)</A></H2>
<P>The setup files, Priism_setup and Priism_setup.sh, contain settings that
should work for most systems.  Some settings that you may want to modify or
override are discussed below; others are mentioned with comments in
Priism_setup and Priism_setup.sh.

<H3>Location of the shared memory file</H3>
<P>The default versions of Priism_setup and Priism_setup.sh cause the shared
memory file and related temporary files to be put in whatever directory the
environment variable TMPDIR contains or, if TMPDIR is not set, /var/tmp.
Because these files may be large (their size is related to the amount of image
data loaded into Priism; this can easily be hundreds of megabytes), you will
want to override or change the default if the default location does not have
much space.  To override the default, set the environment variable IVE_SHMDIR
to the directory where the files are to be placed.  This must be done before
Priism is started (it can happen before or after reading Priism_setup or
Priism_setup.sh).  To change the default, alter the logic for how IVE_SHMDIR
is set in Priism_setup and Priism_setup.sh (in the original versions this
happens at lines 241-247 in Priism_setup and line 233 in Priism_setup.sh

<H3>Working set size</H3>
<P>There is a limit, the working set size, on how much space the image data
and the scaled images derived from that data can take up in the shared memory
file.  When that limit is exceeded, Priism will start discarding scaled images
or moving image data out of the shared memory file and into other temporary
files.  There is a crude heuristic in Priism_setup and Priism_setup.sh which
sets the working set based on how much RAM your machine has.  This heuristic
may not be optimal for your system.  For instance, the working set is set at
256 megabytes for Mac or 32-bit Linux systems with more than 320 megabytes
of RAM; for systems like that you may want Priism to use more memory so you
can load more image data without incurring the performance hit when the
working set size is exceeded.

<P>To override the default working set size, set the environment variable
IVE_WORKING_SET to the number of megabytes that the working set should be.
This must be done be done before Priism is started and after Priism_setup or
Priism_setup.sh is read since they will reset IVE_WORKING_SET.  To change the
default, you can alter the heuristic (lines 185-210 in the original
Priism_setup and lines 175-202 in the original Priism_setup.sh) and the default
of 96 megabytes when the amount of RAM could not be determined (line 155 of
the original Priism_setup and line 149 of the original Priism_setup.sh).

<P>If you change the working set to be something close to or larger than the
maximum size of the shared memory file (the value of IVE_SIZE environment
variable which is in units of megabytes or 300 megabytes if IVE_SIZE is not
set), you must also change the maximum size of the shared memory file (see
below for details).

<H3>Working unit</H3>
<P>Priism divides the working set into blocks of a fixed size called the
working unit.  For versions prior to 4.1.5, the default working unit is
6 megabytes; for versions 4.1.5 and later, the default working unit is
16 megabytes.  The effect of the working unit is:

<UL>
  <LI>In versions of Priism prior to 4.1.2, any attempt to load a data set
    whose full 2D section size is greater than the working unit would fail.
  <LI>For Priism versions 4.1.2 and later, if it is possible to allocate new
    blocks from the working set, then Priism can use a multiple of the
    working unit to accommodate data sets where a section is larger than
    the working unit.  However, Priism can not coalesce blocks from the
    working set once they are allocated so that, depending on what data sets
    have been loaded previously, it may be not possible or inefficient to load
    a data set with a section size greater than the working unit.
</UL>

<P>You can set the working unit by setting the environment variable
IVE_WORKING_UNIT.  The units of IVE_WORKING_UNIT are megabytes and the value
must be an integer.

<H3>Maximum size of the shared memory file</H3>
<P>The shared memory file has a maximum size that is fixed when the file
is created.  This maximum size defaults to 300 megabytes except on x86_64 Linux
systems where a default is set based on that amount of memory the system
has.  If you increase the working set to something close to or greater the
maximum size of the shared memory file, you must also increase the maximum size
for Priism to work well.  To change the maximum size, set the environment
variable IVE_SIZE to the size in megabytes.  This must be done after reading
Priism_setup or Priism_setup.sh and before Priism is started.  The absolute
maximum size is 1000 megabytes for the 32-bit Mac OS X version (at 1000
megabytes, Priism can not start), 2000 megabytes for x86 Linux or x86_64 Linux
when using the 32-bit Priism executables (at 2000 megabytes, Priism can not
start), and 1048575 megabytes for x86_64 Linux or Mac OS X when using the
64-bit Priism executables.

<HR>

<H2><A NAME="Step5">5.  Configure batch execution environment and queues (optional)</A></H2>
<P>Some parts of Priism can submit a script to perform a task offline with
the choice to either run it locally or submit it to a batch queue.
<A HREF="BatchRegion.html#queue">BatchRegion.html</A> in the HTML directory of
the Priism distribution describes how you configure the batch queues and the
environment for locally executed parallel jobs.

<HR>

<H2>Related Priism Topics</H2>
<P>
   <A HREF="Priism.html">Priism</A> |
   <A HREF="PriismRequirementsX86Linux.html">Priism requirements for x86 Linux</A> |
   <A HREF="PriismRequirementsOSX.html">Priism requirements for Mac OS X</A> |
   <A HREF="Limitations.html">Known problems</A> |
   <A HREF="RecentChanges.html">Recent changes</A> |
   <A HREF="http://msg.ucsf.edu/IVE/Download/index.html">Priism download site</A>

<HR>
<ADDRESS>
  IVE Development Team (<A HREF="mailto:ive@msg.ucsf.edu">ive@msg.ucsf.edu</A>)
</ADDRESS>

</BODY>
</HTML>
