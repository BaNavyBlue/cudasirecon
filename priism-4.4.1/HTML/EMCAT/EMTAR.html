<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
  <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <TITLE>Priism Help: EMTAR</TITLE>
  <META NAME="Description" CONTENT="On-line help for the graphical front-end to align and reconstruct a 3D volume from EM tomography data.">
  <META NAME="Keywords" CONTENT="Priism,EM,tomography,alignment,reconstruction,weighted backprojection">
  <LINK REV=MADE HREF="mailto:ive@msg.ucsf.edu">
</HEAD>
<BODY>

<H1><A NAME="EMTAR">EMTAR</A></H1>
<H2>Overview</H2>

<P>EMTAR is a front-end for alignment and reconstruction of EM tomography
data.  The basic recipe for generating a reconstruction is:

<OL>
  <LI>Enter the file name for the tilt series in the field adjacent
    to the "Tilt series" button, or press the "Tilt series" button to
    select the tilt series file name with a file dialog.
  <LI>If you've added multiple resolution to the input tilt series using
    <A HREF="../AppendRes.html">AppendRes</A> with a z scaling of one,
    then you can enter the resolution level (zero is the highest) to
    process in the <A HREF="#Resolution">"Resolution" field</A>.  This
    can be especially useful if you are doing preliminary reconstructions
    of large datasets.
  <LI>As a guide for selecting a region of interest for reconstruction,
    reconstruct a single slice.  To do so, turn on the "setup to find
    reconstruction bounds" toggle button and then press the "Do It" button.
  <LI>Select the region of interest for reconstruction; the
    <A HREF="#SelectRegion">"Select region" topic</A> describes how to
    do so in more detail.
  <LI>Reconstruct the region of interest.  To to do so, turn off the
    "setup to find reconstruction bounds" toggle button and press the
    "Do It" button.
</OL>

<P>If you wish to use an <A HREF="BALIGN.html">alignment based on fiducial
markers</A> (gold beads, for example), you can follow the same recipe but
turn off the rough alignment and alignment calculations and use the
result from the markers instead as massnorm's input alignment parameter file.

<P>The actual processing is implemented as a series of steps, and the EMTAR
dialog reflects this by having a toggle button to turn on or off each step
and a button adjacent to that toggle button for opening a dialog with the
parameters specific to that step.  The steps are:

<DL>
  <DT>Median filter<DD>This is a 2D median filter (identical to the median
    filter in Priism's <A HREF="../Filter2D.html">Filter2D</A>).  It is
    included here because it can be useful for low signal-to-noise cases
    to use a filtered version of the raw tilt series in the mass normalization
    and alignment calculations.
  <DT><A HREF="ALIGN2D.html">Rough alignment</A><DD>Computes an initial guess
    at the alignment so that it is possible to restrict the region of analysis
    in the mass normalization calculation.  For data from the UCSF tomography
    data collection on TECNAI systems, it is possible to extract this
    information from the tilt series' extended header.  As a fallback,
    the full cross-correlation alignment procedure can be used but with
    the parameters suitable for a quick and rough alignment calculation.
  <DT><A HREF="MASSNORM.html">Mass normalization</A><DD>Computes the
    relationship between intensities in the projections and sample mass
    densities.
  <DT><A HREF="FINDAXIS.html">Determine tilt axis</A><DD>Determines the
    orientation of the tilt axis in the projections.
  <DT><A HREF="PFOCUSRAMP.html">CTF correction</A><DD>Can correct the
    tilt series for the effects of the contrast transfer function.
  <DT><A HREF="ALIGN2D.html">Alignment</A><DD>Uses cross-correlation
    calculations to determine the alignment parameters for the tilt series.
  <DT><A HREF="APPL_PRM.html">Apply parameters</A><DD>Takes the alignment
    and mass normalization results and applies them to the raw tilt series
    to give an aligned tilt series where the individual pixel values have
    been converted to accumulated mass density.
  <DT><A HREF="EWBP.html">EWBP</A><DD>Performs a weighted backprojection
    of the aligned and normalized tilt series to arrive at a 3D reconstruction.
  <DT><A HREF="TAPIR.html">TAPIR</A><DD>Uses an iterative algorithm to
    arrive at a 3D reconstruction.  Use this instead of the weighted
    backprojection when you want a higher fidelity reconstruction at the
    expense of significantly more computation.
  <DT><A HREF="GPURECON.html">GPURECON</A><DD>This runs a client program that
    contacts one or more servers to perform the reconstruction.  The servers
    use graphics cards to accelerate the calculation.  You can use this instead
    of EWBBP or TAPIR.
</DL>

<P>EMTAR executes the steps by writing out a short text file with the
commands to be run.  By default, when you press the "Do It" button that
text file is executed immediately on the current machine.  To change the
name of the command file, the name of the log file generated during processing,
or how the command file is executed, Use the "Options" button in EMTAR's
main dialog.  It opens a dialog in which you can control set those
parameters.

<H3>Topics</H3>
<P>
   Overview |
   <A HREF="#SelectRegion">Select region</A> |
   <A HREF="#Parameters">Parameters</A> |
   <A HREF="#OtherControls">Other controls</A> |
   <A HREF="Parallel.html">Parallel execution</A>

<H3>Related Priism Topics</H3>
<P>
   <A HREF="../Priism.html">Priism</A> |
   <A HREF="BALIGN.html">Alignment with markers</A> |
   <A HREF="../Filter2D.html">Filter2D</A> |
   <A HREF="ALIGN2D.html">Alignment</A> |
   <A HREF="MASSNORM.html">Mass normalization</A> |
   <A HREF="FINDAXIS.html">Determine tilt axis</A> |
   <A HREF="PFOCUSRAMP.html">CTF correction</A> |
   <A HREF="APPL_PRM.html">Apply parameters</A> |
   <A HREF="EWBP.html">EWBP</A> |
   <A HREF="TAPIR.html">TAPIR</A> |
   <A HREF="GPURECON.html">GPURECON</A>
<HR>

<H2><A NAME="SelectRegion">SelectRegion</A></H2>
<P>To select the region of interest in XY, do the following:
<OL>
  <LI>If you already have a reconstruction and want to use it for selection
    of the region, first <A HREF="../Flip.html">flip the reconstruction</A>
    if you have not already done so and then turn on the
    "use flipped reconstruction" toggle button in EMTAR's main dialog.
    By default, EMTAR assumes that the flipped reconstruction has the same
    name as the tilt series but with a .xyzw extension.  If that is not
    the case, press the "Change file names" button in EMTAR's main dialog
    and use the dialog that appears to change the "Flipped reconstruction for
    XY" file name.  When the "use flipped reconstruction" toggle button is
    off, EMTAR uses the raw tilt series for selection.
  <LI>Load the target data (either the raw tilt series or the flipped
    reconstruction) into an image window.  You can use
    <A HREF="../ViewFile.html">ViewFile</A> or
    <A HREF="../CopyRegion.html">CopyRegion</A> in Priism to do that.
    For the raw tilt series, you could also use the "Tilt series" entry
    in the EMTAR's "Display" menu (which is simply a shortcut for calling
    <A HREF="../CopyRegion.html">CopyRegion</A> with the correct file name).
  <LI>Press the "XY" button next to "Select region" in EMTAR's main dialog.
    That will open up a dialog and display the selected region in the image
    window.  You can adjust the selected region with the mouse.  To shift
    the entire region as a unit, position the mouse pointer in the center of
    the region, press the right mouse button, drag the mouse, and then release
    the right mouse button when done.  To shift one edge of the region,
    position the mouse pointer at the edge, press the right mouse button, drag
    the mouse, and then release the mouse pointer when done.  You can also
    change the bounds for the selected region by directly editing the values
    in the "EMTAR: Select XY" dialog.  Pressing the "Apply" button in that
    dialog transfers the current parameters to the main dialog and leaves
    the dialog open.  The "Close" button is similar but closes the dialog as
    well.  The "Cancel" button closes the dialog and does not transfer the
    region parameters to the main dialog.
</OL>

<P>To select the region of interest in XZ, do the following:
<OL>
  <LI>First, you need to generate a reconstruction.  A single slice is
    sufficient, and you can turn on the "setup to find reconstruction bounds"
    in the EMTAR main dialog and then press the "Do It" button in the EMTAR
    main dialog to generate that slice.
  <LI>By default, EMTAR assumes that the reconstruction will have the same
    name as the tilt series but with a .xzyw extension.  If that is not
    the case, press the "Change file names" button in EMTAR's main dialog
    and use the dialog that appears to change the "Reconstruction for XZ"
    file name.
  <LI>Load the reconstruction into an image window.  You can use
    <A HREF="../ViewFile.html">ViewFile</A> or
    <A HREF="../CopyRegion.html">CopyRegion</A> in Priism to do that.
    You could also use the "Display" menu in EMTAR's main dialog: if the
    reconstruction was from EWBP, then select "EWBP reconstruction" from
    the "Display" menu; otherwise, select "TAPIR reconstruction".
  <LI>Press the "XZ" button next to "Select region" in EMTAR's main dialog.
    That will open up a dialog and display the selected region in the image
    window.  You can adjust the selected region with the mouse.  To shift
    the entire region as a unit, position the mouse pointer in the center of
    the region, press the right mouse button, drag the mouse, and then release
    the right mouse button when done.  To shift one edge of the region,
    position the mouse pointer at the edge, press the right mout button, drag
    the mouse, and then release the mouse pointer when done.  You can also
    change the bounds for the selected region by directly editing the values
    in the "EMTAR: Select XZ" dialog.  Pressing the "Apply" button in that
    dialog transfers the current parameters to the main dialog and leaves
    the dialog open.  The "Close" button is similar but closes the dialog as
    well.  The "Cancel" button closes the dialog and does not transfer the
    region parameters to the main dialog.
</OL>

<H3>Topics</H3>
<P>
   <A HREF="#EMTAR">Overview</A> |
   Select region |
   <A HREF="#Parameters">Parameters</A> |
   <A HREF="#OtherControls">Other controls</A>
<HR>

<H2><A NAME="Parameters">Parameters</A></H2>
<P>The following parameters are set in EMTAR's main menu.

<DL>
  <DT><A NAME="TiltSeries">TiltSeries</A>
  <DD>This is the name of the file containing the raw projection data stack
    from the CCD (i.e. measured in terms of electron counts; data stacks
    with the contrast inverted can not be handled).

  <DT><A NAME="Resolution">Resolution</A>
  <DD>Selects which resolution to process from the input tilt series.  0 is
    the highest (full) resolution.  You can use Priism's
    <A HREF="../AppendRes.html">AppendRes</A> to add resolutions to a tilt
    series; when you do so, use a z scaling of one since you do not want the
    lower resolutions to combine information from different projections.
    When you process a resolution other than the full resolution, any
    size-related parameters are still specified in the full resolution units:
    the backend processing will scale the values appropriately.  Similarly,
    the generated alignment parameters will be in terms of the full resolution
    coordinate system and are transformed, as necessary, when working with a
    lower resolution.

  <DT><A NAME="ReconShift">Shift (XYZ)</A>
  <DD>Specifies the center of the reconstructed projection.  A good way to
    select the values for the shift parameters is to select the region of
    interest with the mouse (see the
    <A HREF="#SelectRegion">"Select region" topic</A> for details).

  <DT><A NAME="ReconSize">Size (XYZ)</A>
  <DD>The first value is the lateral dimension of the reconstruction
    in pixels.  The second is the number of 2D reconstruction slices.
    The third is the thickness of the reconstruction in pixels and should be
    greater than the thickness of the object of interest.  As with the shifts,
    you can interactively set these with the mouse (see the
    <A HREF="#SelectRegion">"Select region" topic</A> for details).
</DL>

<H3>Topics</H3>
<P>
   <A HREF="#EMTAR">Overview</A> |
   <A HREF="#SelectRegion">Select region</A> |
   Parameters |
   <A HREF="#OtherControls">Other controls</A>
<HR>

<H2><A NAME="OtherControls">Other Controls</A></H2>
<P>Other controls in EMTAR's main dialog are:

<DL>
  <DT><A NAME="NX:NY:NV">NX:NY:NV</A>
  <DD>The first two values display, respectively, the x and y dimension of the
    projections.  The third value displays the number of projections in the
    tilt series.

  <DT><A NAME="Display">Display menu</A>
  <DD>The display menu is a shortcut for displaying the input tilt series
    or output image or plot files within Priism.  The entries in the menu
    are:
    <DL>
      <DT>Tilt series<DD>Displays the image file specified by the
       <A HREF="#TiltSeries">"Tilt series" field</A> in EMTAR's main dialog.
      <DT>Filtered series<DD>Displays the output of the median filter, i.e.
        the image file specified by the "FilteredSeries" field in the median
        filter dialog.
      <DT>Aligned & normalized series<DD>Displays the output of apply
        parameters, i.e. the image file specified by the "AlignedSeries" field
        in the apply parameters dialog.
      <DT>CTF corrected series<DD>Displays the output of CTF correction.
      <DT>EWBP reconstruction<DD>Displays the reconstruction generated by the
        weighted backprojection calculation, i.e. the image file specified by
        the "Reconstruction" field in the EWBP dialog.
      <DT>TAPIR reconstruction<DD>Displays the reconstruction generated by
        the iterative algorithm, i.e. the image file specified by the
        "Reconstruction" field in the TAPIR dialog.
      <DT>Stretched and apodized series<DD>Displays the optional output,
        specified by the <A HREF="ALIGN2D.html#StretchedSeries">"Stretched series" field</A>
        in the alignment special parameters dialog, from the alignment
        calculation.
      <DT>Cross correlations (alignment)<DD>Displays the optional
        cross-correlation peak images output from the alignment calculation.
        The name of the image file is listed in the 
        <A HREF="ALIGN2D.html#CrossCorrelationImages">"Cross correlations" field</A>
        of the alignment's special parameters dialog.
      <DT>Cross correlations (tilt axis)<DD>Displays the optional
        cross-correlation images generated by the calculations to determine
        the tilt axis orientation.  The name of the image file is listed in
        the
        <A HREF="FINDAXIS.html#CrossCorrelationImages">"Cross correlations" field</A>
        of the tilt axis determination's special parameters dialog.
      <DT>MASSNORM fit<DD>Displays the optional graphs generated by the
        mass normalization calculation.  The name of the file is set with the
        <A HREF="MASSNORM.html#FitGraph">"Fit graph" field</A> in the mass
        normalization special parameters dialog.
      <DT>Tilt axis (composite)<DD>Displays the optional composite
        cross-correlation graphs generated by the calculations to determine the
        tilt axis orientation.  The name of the file is set with the
        <A HREF="FINDAXIS.html#CompositePlots">"Composite plots" field</A> in
        the find axis special parameters dialog.
      <DT>Tilt axis (pairwise)<DD>Displays the optional cross-correlation
        graphs for each tilt angle pair generated by the calculations to
        determine the tilt axis orientation.  The name of the file is set with
        the <A HREF="FINDAXIS.html#PairwisePlots">"Pairwise plots" field</A>
        in the find axis special parameters dialog.
    </DL>
</DL>

<H3>Topics</H3>
<P>
   <A HREF="#EMTAR">Overview</A> |
   <A HREF="#SelectRegion">Select region</A> |
   <A HREF="#Parameters">Parameters</A> |
   Other controls
<HR>

</BODY>
</HTML>
