<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
  <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <TITLE>Priism Help: EWBP</TITLE>
  <META NAME="Description" CONTENT="On-line help for the application which calculates the weighted back-projection reconstruction of a 3D volume from a mass normalized and aligned tilt series.">
  <META NAME="Keywords" CONTENT="Priism,EM,tomography,reconstruction,weighted backprojection">
  <LINK REV=MADE HREF="mailto:ive@msg.ucsf.edu">
</HEAD>
<BODY>

<H1><A NAME="EWBP">EWBP</A></H1>
<H2>Overview</H2>
<P>This program (EWBP, elliptical-square weighted backprojection) computes
the weighted backprojection (WBP) reconstruction of a volume from a
mass normalized and aligned series of projections.  WBP is a linear
shift-invariant algorithm, hence the reconstruction can be described by its
point spread function. The only thing one can manipulate with this algorithm
is its weighting function. The reconstruction is computed by multiplying the
Fourier transform of each projection with its weighting function and
backprojecting the weighted values into the reconstruction volume.

<P>The current program provides a set of weighting functions.  Besides the
conventional r*-weighting function which is valid for a regular tilt series,
there is the so-called elliptical-square weighting function which applies
to arbitrary tilting geometry of the projection set and also takes care of
the scaling problem (that is, the scales of the reconstruction and that
of the projections correspond to each other).  The elliptical-square
weighting function is recommended for all situations.

<P>Here's an example command file for EWBP:
<PRE>
    (time ewbp /mama/weiping/prog/junk.MnAln \
     /mama/weiping/prog/junk.xzyw -dimxz=128:150 -iy=0:127 \
     -filter=2 -reconxz=128:150 -moderec=2 -hdfilt=1 \
     -positivity=1 ) &gt; /mama/weiping/emrecon.log
</PRE>

<H3><A NAME="Parameters">Parameters</A></H3>
<P>
   <A HREF="#AlignedSeries">AlignedSeries</A> |
   <A HREF="#Reconstruction">Reconstruction</A> |
   <A HREF="#NX:NY:NV">NX:NY:NV</A> |
   <A HREF="#OutputXZSize">Output XZ size</A> |
   <A HREF="#YRange">Y range</A> |
   <A HREF="#WeightingFunction">Weighting function</A> |
   <A HREF="#ParticleXZSize">Particle XZ size</A> |
   <A HREF="#OutputFormat">Output format</A> |
   <A HREF="#HammingFilter">Hamming filter</A> |
   <A HREF="#r*HammingFilter">r* Hamming Filter</A> |
   <A HREF="#Positivity">Positivity</A> |
   <A HREF="#Resolution">Resolution</A> |
   <A HREF="#ResolutionScale">Resolution scale</A> |
   <A HREF="#Multires">Add multires</A>


<H3>Related Priism Topics</H3>
<P>
  <A HREF="../Priism.html">Priism</A> |
  <A HREF="ReconCoordSys.html">Reconstruction coordinate system</A> |
  <A HREF="EMTAR.html">Alignment and reconstruction</A> |
  <A HREF="MASSNORM.html">MASSNORM</A> |
  <A HREF="APPL_PRM.html">APPL_PRM</A> |
  <A HREF="TAPIR.html">TAPIR</A> |
  <A HREF="GPURECON.html">GPURECON</A> |
  <A HREF="Parallel.html">Parallel execution</A> |
  <A HREF="BALIGN.html">Alignment with markers</A>

<HR>

<H2><A NAME="AlignedSeries">Aligned Series</A></H2>
<P>This is the name of the input file which contains the mass normalized and
aligned projection series created by <A HREF="APPL_PRM.html">APPL_PRM</A>.
On the command line, the name of the file with mass-normalized and aligned
data is the first argument.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="Reconstruction">Reconstruction</A></H2>
<P>This is the name of the file that will contain the data for the
reconstructed volume.  On the command line, the name of for the output image
data is the second argument.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="NX:NY:NV">NX:NY:NV</A></H2>
<P>The first two values are, respectively, the x and y dimensions of the
data in <A HREF="#AlignedSeries">the input projection series</A>.  The last
value is the number of projections in the series.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="OutputXZSize">Output XZ Size</A></H2>
<P>These two values set the x and z dimensions, in pixels, of the
reconstructed volume (the volume is written as slices parallel to the
xz plane so these values are the dimensions of a single slice).  The z
dimension should be greater than the specimen thickness.  When the
reconstructed volume is used as an input for <A HREF="TAPIR.html">TAPIR</A>,
the z dimension should be twice the specimen thickness to limit contamination
of the TAPIR reconstruction by volatile projection direct components; also,
the sizes for the TAPIR reconstruction and the initial reconstruction should
be the same.

<P>On the command line, the dimensions of the reconstruction are set with
<CODE>-reconxz=</CODE><VAR>nx</VAR><CODE>:</CODE><VAR>nz</VAR>.  When the
dimensions are not set, <VAR>nx</VAR> is taken to be the same size as the
x dimension of an input projection, and <VAR>nz</VAR> is set to one-fourth
of <VAR>nx</VAR>.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="YRange">Y Range</A></H2>
<P>These two values set the range of y pixels from the
<A HREF="#AlignedSeries">aligned tilt series</A> to use in the reconstruction.
The first is the first index (running from 0 to the number of y pixels minus
one) to use, and the second is the last possible index to use.

<P>From the command line, use
<CODE>-iy=</CODE><VAR>start_index</VAR><CODE>:</CODE><VAR>last_index</VAR> to
set the range of y pixels used in the reconstruction.  If you do not specify a
range, all y pixels are used:  <VAR>start_index</VAR> is set to zero and
<VAR>last_index</VAR> is set to the number of y pixels minus one.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="WeightingFunction">Weighting Function</A></H2>
<P>There are three choices for the weighting function to use in the
weighted backprojection:
<DL>
  <DT>elliptical-square
  <DD>Can be applied to arbitrary tilt geometry of the projection set and
    handles the scaling problem (the scales of the reconstruction and of the
    projections correspond to each other with this weighting function).  Tends
    to be more stable than the elliptical weighting function since it avoids
    the possibility of very large values at some projection Fourier points.
    The elliptical-square weighting function is the recommended weighting
    function.
  <DT>r*
  <DD>Is valid for regular tilt series but does not properly scale the
    reconstruction so it can not be used to generate an initial guess for
    TAPIR.
  <DT>elliptical
  <DD>Is similar to the elliptical-square weighting function but tends to be
    less stable.
</DL>

<P>To specify the weighting function from the command line use
<CODE>-filter=</CODE><VAR>code</VAR> where <VAR>code</VAR> is
one of the following:
<DL>
  <DT>1<DD>elliptical weighting function
  <DT>2<DD>elliptical-square weighting function
  <DT>3<DD>r*-weighting function
</DL>

<P>When no weighting function is specified on the command line, 
the default is to use the elliptical-square function.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="ParticleXZSize">Particle XZ Size</A></H2>
<P>These two values are, respectively, the x and z dimensions in pixels of the
particle and are used when computing the elliptical or elliptical-square
weighting functions.

<P>To specify the particle dimensions from the command line, use
<CODE>-sizexz=</CODE><VAR>nx</VAR><CODE>:</CODE><VAR>nz</VAR>.  If the
particle size is not set, the program uses the x and z dimensions of a
reconstruction slice for the dimensions of the particle.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="OutputFormat">Output Format</A></H2>
<P>This parameter controls the data type used to represent the values in
the reconstructed volume.  You have the choice of using a four byte
floating-point representation or a two byte signed integer representation.

<P>To set the output data type from the command line, use
<CODE>-moderec=2</CODE> for the floating-point representation or
<CODE>-moderec=1</CODE> for the signed integer representation.  If neither
is set, the floating-point representation is used.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="HammingFilter">Hamming Filter</A></H2>
<P>When the toggle is on, a Hamming filter is applied to the data
before the reconstruction; when it is off, no Hamming filter is applied.
On the command line, the way to turn on the Hamming filter applied before
the reconstruction is to use <CODE>-hdfilt=</CODE><VAR>any value</VAR>.
The default behavior is not to apply the initial Hamming filter if no
such option is supplied.

<P>This switch is normally not used.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="r*HammingFilter">r* Hamming Filter</A></H2>
<P>This toggle only affects the reconstruction when the r*-weighting function
is used.  When the toggle is off, no Hamming filter is combined with the
r*-weighting function for reconstruction; when it is on, a Hamming filter is
combined with the weighting function.  When you use the r*-weighting function
and turn on both this option and the
<A HREF="#HammingFilter">Hamming filter</A> option, the projections will be
filtered twice with a Hamming filter.  On the command line, the way to combine
a Hamming filter with the r*-weighting function is to use
<CODE>-hrfilt=</CODE><VAR>any value</VAR>.  The default behavior is to not
include a Hamming filter with the r*-weighting function if no such command
line option has been supplied.

<P>This switch is normally not used.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="Positivity">Positivity</A></H2>
<P>When this toggle is on, data values in reconstructed volume which are
less than zero are coerced to zero (a positivity constraint).  No such
constraint is applied when the switch is off (the default behavior).  On
the command line, the way to force the positivity constraint is to supply
a <CODE>-positivity=</CODE><VAR>any value</VAR> option.  If no command line
option is supplied, the default is to not apply a positivity constraint.

<P>This switch is normally not used.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="Resolution">Resolution</A></H2>
<P>The resolution parameter selects which resolution to process from the
input tilt series.  Normally, the tilt series has been preprocessed with
<A HREF="APPL_PRM.html">apply parameters</A>, and the highest resolution
in the tilt series corresponds to the resolution you want.  In those
situations, you would set the resolution parameter to zero (the default value)
to select the highest resolution from the tilt series.

<P>On the command line, use
<PRE>
    <CODE>-res=</CODE><VAR>i</VAR>
</PRE>
<P>to have the reconstruction use the <VAR>i</VAR>th resolution from the
tilt series.  When run from the command line and no resolution is selected,
the reconstruction will use the highest resolution present in the input tilt
series.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="ResolutionScale">Resolution Scale</A></H2>
<P>The resolution scale parameter controls the scale factor applied to the
reconstruction and particle size parameters.  In the typical case where you
select a resolution level to process from the main dialog of
<A HREF="EMTAR.html">EMTAR</A>, the graphical interface will automatically fill
in the resolution scale correctly.  In the case where you are running the
reconstruction directly on a downsampled tilt series but still specify the
reconstruction sizes in terms of the full resolution, you should set the
resolution scale to be the same as the downsampling factor (if the data is
scaled down by a factor of four set the resolution scale parameter to four).

<P>On the command line, use
<PRE>
    <CODE>-rscale=</CODE><VAR>i</VAR>
</PRE>
<P>to set the resolution scale to be <VAR>i</VAR>.  When run from the
command line without the -rscale option, ewbp will use a scale factor equal to
two raised to the power of the <A HREF="#Resolution">resolution level</A>
selected with -res.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="Multires">Add Multires</A></H2>
<P>Turn on the "Add multires" toggle button to cause ewbp to add lower
resolutions to the reconstruction if the x and y dimensions of the
reconstruction are large enough.  Turn off the "Add multires" toggle button to
cause ewbp to generate a reconstruction with a single resolution.

<P>On the command line, include
<PRE>
    <CODE>-multires</CODE>
</PRE>
<P>in the command-line options for ewbp to cause ewbp to add lower resolutions
to the reconstruction if the x and y dimensions of the reconstruction are large
enough.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

</BODY>
</HTML>
