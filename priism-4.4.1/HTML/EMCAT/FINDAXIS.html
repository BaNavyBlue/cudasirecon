<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
  <TITLE>Priism Help: FINDAXIS</TITLE>
  <META NAME="Description" CONTENT="On-line help for the application which determines the tilt axis of a tilt series.">
  <META NAME="Keywords" CONTENT="Priism,EM,tomography,tilt axis">
  <LINK REV=MADE HREF="mailto:ive@msg.ucsf.edu">
</HEAD>
<BODY>

<H1><A NAME="FINDAXIS">FINDAXIS</A></H1>
<H2>Overview</H2>
<P>FINDAXIS determines the orientation of the tilt axis for a tomographic
tilt series.  FINDAXIS tries a <A HREF="#Axis">range of orientations</A> to
determine which gives the best cross-correlation values for a
<A HREF="#Tilts">set of image pairs</A> from the tilt series.

<P>Below is a an example command line for FINDAXIS.  The command takes the
tilt series, test.stk, and <A HREF="MASSNORM.html">MASSNORM</A>-generated
parameters, test.bprmMn, and updates the parameters with the estimated
position of the tilt axis.  It samples with a spacing of 0.1 degrees the
orientation angles within +/-10 degrees of the orientation recorded for the
first projection in test.bprmMn.

<PRE>
    find_axis test.stk -iprmfile=test.bprmMn -oprmfile=test.bprmMn \
        -axis=-180:10:0.1 -smooth -phaseweight
</PRE>

<H3><A NAME="Parameters">Parameters</A></H3>
<P>
   <A HREF="#TiltSeries">Tilt series</A> |
   <A HREF="#NX:NY:NV">NX:NY:NV</A> |
   <A HREF="#InputAlignment">Input alignment</A> |
   <A HREF="#OutputAlignment">Output alignment</A> |
   <A HREF="#Axis">Axis</A> |
   <A HREF="#Tilts">Tilts</A> |
   <A HREF="#Smooth">Smooth</A> |
   <A HREF="#CrossCorrelationImages">Cross correlations</A> |
   <A HREF="#CompositePlots">Composite plots</A> |
   <A HREF="#PairwisePlots">Pairwise plots</A> |
   <A HREF="#WienerCoefficient">Wiener coefficient</A> |
   <A HREF="#TiltOffset">Tilt offset</A> |
   <A HREF="#PhaseWeighting">Phase weighting</A> |
   <A HREF="#Resolution">Resolution</A>

<H3>Related Priism Topics</H3>
<P>
  <A HREF="../Priism.html">Priism</A> |
  <A HREF="EMTAR.html">Alignment and reconstruction</A>
<HR>

<H2><A NAME="TiltSeries">Tilt Series</A></H2>
<P>In the graphical user interface, the "Tilt series" field holds the name
of the file containing the tilt series data.  On the command line, pass the
name of the tilt series file as the first argument.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="NX:NY:NV">NX:NY:NV</A></H2>
<P>In the graphical user interface, the "NX:NY:NV" field displays the
dimensions of <A HREF="#TiltSeries">tilt series</A>.  The first value in the
field is the number of pixels in the x dimension, the second value in the
field is the number of pixels in the y dimension, and the third value is the
number of projections.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="InputAlignment">Input Alignment</A></H2>
<P>In the graphical user interface, the "Input alignment" field holds the name
of the input alignment parameter file.  Normally you would use none or the name
of a parameter file generated by <A HREF="MASSNORM.html">MASSNORM</A>.  On the
command line, specify the name of the input parameter file with the option
<PRE>
    <CODE>-iprmfile=</CODE><VAR>file_name</VAR>
</PRE>
<P>If you do not specify an input parameter file on the command line, FINDAXIS
will assume that the input parameters are available in a file with the same
base file name as the input tilt series but with a ".bprmMn" extension.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="OutputAlignment">Output Alignment</A></H2>
<P>In the graphical user interface, the "Output alignment" field is the name
of the output alignment parameter file that FINDAXIS will generate.  On the
command-line, specify the name of the output parameter file with the option
<PRE>
    <CODE>-oprmfile=</CODE><VAR>file_name</VAR>
</PRE>
<P>If the name is none, FINDAXIS will not write out the alignment parameters
with updated values for the tilt axis orientation and tilt angles.  If no
output parameter file is specified on the command line, FINDAXIS will write
the alignment parameters to a file with the same name as the tilt series but
with a ".bprmMn" extension.  The name of the output parameter file may be the
same as that for the input parameter file:  FINDAXIS will modify the tilt axis
orientation and tilt angle values and leave the others unchanged.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="Axis">Axis</A></H2>
<P>FINDAXIS searches a range of angles to identify the orientation of the
tilt axis.  The "Initial guess" field in the graphical user interface specifies
the center, in units of degrees, of the range to search.  When the adjacent
"default" toggle is on, the center of the range will be the axis orientation
for the first projection as specified in the input parameter file or the
extended header of the tilt series (if the orientation can not be determined
from either of those sources, FINDAXIS will use a value of zero for the center
of the range).  The width, in degrees, of the range is twice the value shown in
the "Search range" field.  The "Step size" field specifies the accuracy, in
degrees, of the search; the amount of computation needed is inversely
proportional to the accuracy.

<P>On the command line, use
<PRE>
    <CODE>-axis=</CODE><VAR>initial_guess</VAR><CODE>:</CODE><VAR>half_range</VAR><CODE>:</CODE><VAR>accuracy</VAR>
</PRE>
<P>to set the range of angles to search.  If <VAR>initial_guess</VAR> is -180,
the center of the range will the axis orientation for the first projection as
specified in the input parameter file or the extended header of the tilt
series.  If the -axis option is not included on the command line, FINDAXIS will
use the axis orientation for the first projection (either from the input
parameter file or from the extended header) as the center of the range, five
degrees as half the width of the range, and an accuracy of a half of a
degree.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="Tilts">Tilts</A></H2>
<P>Roughly speaking,
<UL>
  <LI>Projections with tilt angles whose absolute values, in degrees, are less
    than the smaller of the values in the "First tilt pair" field are not used
    in the calculations to determine the tilt axis orientation.  Projections
    with tilt angles whose absolute values, in degrees, are greater than
    the larger of the values in the "First tilt pair" field plus the value of
    the "Tilt range" field are not used as well.
  <LI>For a tilt series with a uniform tilt angle spacing, the angle spacing
    for the pairs of images used will be the difference between the larger
    value in the "First tilt pair" field and the smaller value in that field.
  <LI>For a tilt series with a uniform tilt angle spacing, the number of pairs
    of images used will be twice the value shown in the "Tilt range" field
    divided by the tilt angle spacing in degrees.
</UL>

<P>To be specific, determination of the tilt axis will use two sets of pairs
of projections from the tilt series.  The first set contains <VAR>n1</VAR>
pairs.  <VAR>n1</VAR> is the number of tilt angles in the tilt series with
values between <VAR>t2</VAR> degrees and <VAR>t2</VAR> + <VAR>r</VAR> degrees
where <VAR>t2</VAR> is the larger of the values shown in the "First tilt pair"
field and <VAR>r</VAR> is the value shown in the "Tilt range" field.  The pairs
are drawn sequentially from the tilt series starting with the pair which most
closely matches the angles show in the "First tilt pair" field and proceeding
in order of increasing tilt angle.  The second set contains <VAR>n2</VAR>
pairs.  <VAR>n2</VAR> is the number of tilt angles in the tilt series with
values between -<VAR>t2</VAR> - <VAR>r</VAR> and -<VAR>t2</VAR>.  The pairs
are drawn sequentially from the tilt series starting with the pair which most
closely matches the negated values in the "First tilt pair" field and
proceeding in order of decreasing tilt angle.

<P>On the command line, the option

<PRE>
    <CODE>-tilts=</CODE><VAR>t0</VAR><CODE>:</CODE><VAR>t1</VAR><CODE>:</CODE><VAR>range</VAR>
</PRE>

<P>sets the pairs of projection to use.  The absolute value of <VAR>t0</VAR>
and the absolute value of <VAR>t1</VAR> are the tilt angles, in degrees, for
the first pair.  <VAR>range</VAR>, in degrees, has the same effect as the
value in the "Tilt range" field of the graphical user interface.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="Smooth">Smooth</A></H2>
<P>If the "Smooth" toggle button in the graphical user interface is on,
FINDAXIS smoothes the cross-correlation images along the direction
perpendicular to the assumed tilt axis.  Smoothing is useful for images from
thick samples but not for thin samples.  On the command line, use
<PRE>
    <CODE>-smooth</CODE>
</PRE>
<P>to turn on smoothing.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="CrossCorrelationImages">Cross Correlations</A></H2>
<P>For use in debugging or diagnosing problems, FINDAXIS can write out the
cross-correlation images for the last pair of tilt angles.  The generated file
will have one image for each trial value of the tilt axis orientation.  To
set the name of the file from the graphical user interface, enter the name
in the "Cross correlations" field.  On the command line, use
<PRE>
    <CODE>-cor_out=</CODE><VAR>name</VAR>
</PRE>
<P>to set the file name for the cross-correlation images.  If the name is equal
to none or you do not use the -cor_out option on the command line, FINDAXIS
will not write the cross-correlation images.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="CompositePlots">Composite Plots</A></H2>
<P>If the name in the "Composite plots" field is different then none, FINDAXIS
will create a file with that name and use that file to store graphs of the
composite cross-correlation value as a function of assumed tilt axis
orientation.  The composite cross-correlation value is a geometric mean of
cross-correlation values determined for different tilt angle pairs.  The
file will contain two graphs:  one to show composite cross-correlation values
where the average uses all tilt angle pairs and another to show the composite
cross-correlation values when the average uses just the positive tilt angle
pairs or just the negative tilt angle pairs.  You can use
<A HREF="../2d_plot.html">2d_plot</A> (in the "Misc" menu of Priism) to plot
the contents of the file.  The command-line option to specify the name of
the file is
<PRE>
    <CODE>-plotfile=</CODE><VAR>name</VAR>
</PRE>
<P>If you do not include a -plotfile= option on the command line, FINDAXIS
will generate a file with the same name as the tilt series but with a ".aplt"
extension.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="PairwisePlots">Pairwise Plots</A></H2>
<P>If the name in the "Pairwise plots" field is different then none, FINDAXIS
will create a file with that name and use that file to store graphs of the
cross-correlation value as a function of assumed tilt axis orientation for each
tilt angle pair.  You can use <A HREF="../2d_plot.html">2d_plot</A> (in the
"Misc" menu of Priism) to plot the contents of the file.  The command-line
option to specify the name of the file is
<PRE>
    <CODE>-pairfile=</CODE><VAR>name</VAR>
</PRE>
<P>If you do not include a -pairfile= option on the command line, FINDAXIS
will not generate the cross-correlation graphs for each tilt angle pair.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="WienerCoefficient">Wiener Coefficient</A></H2>
<P>When you use <A HREF="#PhaseWeighting">phase weighting</A> of the
cross-correlations, there is a term like that in a Wiener filter to keep
things well behaved when the amplitude of the cross-correlation value in the
frequency domain approaches zero.  The term is an estimate of the
high-frequency power spectral density times the value in the user interface's
"Wiener coefficient" field.  A higher value for the "Wiener coefficient"
increases the suppression of the low amplitude components.  To set the
coefficient on the command line, use
<PRE>
    <CODE>-mult=</CODE><VAR>value</VAR>
</PRE>
<P>When the coefficient is not set on the command line, FINDAXIS will use a
value of fifty.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="TiltOffset">Tilt Offset</A></H2>
<P>FINDAXIS can apply an offset to all the tilt angles (if you use an
<A HREF="#InputAlignment">input parameter file</A> that is the source of the
angles; otherwise, FINDAXIS gets them from the header of the
<A HREF="#TiltSeries">tilt series</A>).  By default, FINDAXIS does not
apply an offset.  If you wish to offset the angles (for instance to correct
of a systematic problem in the reported tilt angles) then set the "Tilt
offset" field to the desired offset in degrees.  From the command line, you
can set the tilt angle shift with
<PRE>
    <CODE>-ang_shift=</CODE><VAR>shift</VAR>
</PRE>
<P>where you would replace <VAR>shift</VAR> with the value of the offset
in degrees.

<P>If you use an input parameter file from
<A HREF="MASSNORM.html">MASSNORM</A>, you will not normally set an angle
shift because MASSNORM fits the observed intensities and applies a correction
to the reported tilt angles as necessary.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="PhaseWeighting">Phase Weighting</A></H2>
<P>FINDAXIS can use phase weighting to sharpen the peaks in the
cross-correlation images at the expense of less robustness in the face of
noise.  From the user interface, you can turn phase weighting on or off
by turning on or off the "Phase weighting" toggle button in the special
parameters dialog.  By default, phase weighting is on in the graphical user
interface.  On the command line, you can specify
<PRE>
    <CODE>-phaseweight</CODE>
</PRE>
<P>to turn on phase weighting; if you do not specify that option, FINDAXIS
will not use phase weighting.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

<H2><A NAME="Resolution">Resolution</A></H2>
<P>The resolution parameter selects which resolution to process from the
input tilt series.  0 is the highest (full) resolution.  From the user
interface, you would normally select the resolution from the main
<A HREF="EMTAR.html">EMTAR</A> dialog and allow the software to propagate
the setting to the individual processing stages.  You can also set the
resolution to process specifically for the tilt axis calculations from the
special parameters dialog for "Determine tilt axis".

<P>On the command line, use
<PRE>
    <CODE>-res=</CODE><VAR>i</VAR>
</PRE>
<P>to have the tilt axis calculations work with the <VAR>i</VAR>th resolution.
When run from the command line and no resolution is selected, the tilt axis
calculations will use the highest resolution present in the input tilt
series.

<P><A HREF="#Parameters">Return to the list of parameters</A>
<HR>

</BODY>
</HTML>
