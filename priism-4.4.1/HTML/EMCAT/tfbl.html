<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
  <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <TITLE>Priism Help: Bead List Resample</TITLE>
  <META NAME="Description" CONTENT="On-line help for the applications to adjust bead lists to correspond to a resampling or extraction of a subset from a tilt series.">
  <META NAME="Keywords" CONTENT="Priism,EM,tomography,alignment">
  <LINK REV=MADE HREF="mailto:ive@msg.ucsf.edu">
</HEAD>
<BODY>

<H1><A NAME="tfbl">Bead List Resample</A></H1>
<H2>Overview</H2>

<P>The lists of markers from the <A HREF="BALIGN.html">bead alignment programs</A>
do not include information about the pixel spacing or origin.  Therefore, it
is not possible to use a list with a resampled or binned version of the tilt
series from which the list was generated.  Rather than recalculate a list of
markers from scratch for the altered version of the tilt series, you can use
Bead List Resample to generate a new list from an existing one by transforming
the marker coordinates.

<P>As an example, assume that you have a tilt series, a.stk, with 2048 x 2048
images.  For a variety of reasons, you may want to align and reconstruct
a version of a.stk, b.stk, which has been binned to 512 x 512.  If you then
want to take the marker coordinates for the binned version, b.sl2, and refine
them for aligning and reconstructing the original tilt series, you would:

<OL>
  <LI>Use Bead List Resample with an input file of b.sl2, an output file of
    a.sl2, and a sampling ratio of 4 to create a list of coordinates usable
    with a.stk.
  <LI>Use the <A HREF="BEAD_ALIGN_INTERACTIVE.html">interactive last stage of
    the bead alignment programs</A> to refine the coordinates and calculate
    the alignment parameters.
  <LI>Use the calculated alignment parameters with the
    <A HREF="EMTAR.html">reconstruction applications</A> to generate
    the reconstruction of a.stk.
</OL>

<H3>Topics</H3>
<P>
    Overview |
    <A HREF="#InputFile">Input file</A> |
    <A HREF="#OutputFile">Output file</A> |
    <A HREF="#SamplingRatio">Sampling ratio</A> |
    <A HREF="#InputProjections">Input projections</A> |
    <A HREF="#OutputProjections">Output projections</A> |
    <A HREF="#XYRange">XY range</A> |
    <A HREF="#XYOffset">XY offset</A> |
    <A HREF="#CommandLine">Command line</A>

<H3>Related Priism Topics</H3>
<P>
    <A HREF="../Priism.html">Priism</A> |
    <A HREF="BALIGN.html">Bead alignment</A> |
    <A HREF="EMTAR.html">Reconstruction</A>
<HR>

<H2><A NAME="InputFile">Input File</A></H2>
<P>For the interactive Bead List Resample, use the "Input file" field
to enter the name of the unmatched (.pl, .rbl, or .sbl) or matched (.sl)
marker list that you want to convert.  You can use the button adjacent to
the field to bring up a file browser for selection of the file.

<P><A HREF="#tfbl">Return to overview</A>
<HR>

<H2><A NAME="OutputFile">Output File</A></H2>
<P>For the interactive Bead List Resample, use the "Output file" field
to enter the name for the output parameter file.  You can use the button
adjacent to the field to bring up a file browser for selection of the file.

<P><A HREF="#tfbl">Return to overview</A>
<HR>

<H2><A NAME="SamplingRatio">Sampling Ratio</A></H2>
<P>Let <VAR>x1</VAR> be the x pixel spacing of the tilt series used to
generate the input marker list and <VAR>x2</VAR> be the x pixel spacing of
the tilt series for which you want to generate a marker list.  Then enter the
ratio of <VAR>x1</VAR> to <VAR>x2</VAR> in the "Sampling ratio" field.

<P>Like the other alignment and reconstruction applications, Bead List
Resample assumes the pixels in the tilt series are square:  i.e. the
ratio calculated above will hold true for the y pixel spacing as well.

<P><A HREF="#tfbl">Return to overview</A>
<HR>

<H2><A NAME="InputProjections">Input Projections</A></H2>
<P>In the interactive Bead list Resample, the controls immediately below
the "Input projections" label control which projections are included from
the input marker list.  The controls are:

<DL>
  <DT>All<DD>If the "All" toggle button is on, all projections from the input
    marker list are considered for included in the output list (for a
    matched list, the <A HREF="#OutputProjections">"Count" control for output
    projections</A> may limit the total number included in the output).  If
    the "All" toggle button is off, the "Range" and "Increment" fields
    described below are active and control which projections to include from
    the input.
  <DT>Range<DD>The first value in the "Range" field is the zero-based
    index of the first projection to include.  The second value in the "Range"
    field is the zero-based index of the last projection to include.
  <DT>Increment<DD>The value in the "Increment" field is the step between
    adjacent projections included from the input list:  for instance, use
    an increment of two to skip every other projection.
</DL>

<P><A HREF="#tfbl">Return to overview</A>
<HR>

<H2><A NAME="OutputProjections">Output Projections</A></H2>
<P>In the interactive Bead List Resample, the controls immediately below
the "Output projections" label control the output numbering for the projections
selected from the input list.  The controls are:

<DL>
  <DT>Auto<DD>If the "Auto" toggle button is on, the projections selected
    from the input are numbered zero for the first projection, one for the
    second, and so on.  If the input list is a matched list, the number of
    projections in the output is the minimal number necessary to cover
    the specified input projection range.  If the "Auto" toggle button is
    off, the "Start", "Increment", and, for matched lists, "Count" fields
    described below control the output numbering for the selected input
    projections.
  <DT>Start<DD>The value in the "Range" field is the zero-based index
    for the projection in the output which is the counterpart for the
    first projection selected from the input list.
  <DT>Increment<DD>For input projections <VAR>i</VAR> and
    <VAR>i</VAR>+<VAR>d</VAR> where <VAR>d</VAR> is the input section
    increment, the corresponding output projection indices will differ
    by <VAR>s</VAR> where <VAR>s</VAR> is the value shown in the "Increment"
    field.
  <DT>Count<DD>The "Count" field only has an effect if the input list is
    a matched list.  In that case, use the "Count" field to limit the
    total number of projections included in the output list; the projections
    will be numbered from zero to the value in the "Count" field minus one.
</DL>

<P><A HREF="#tfbl">Return to overview</A>
<HR>

<H2><A NAME="XYRange">XY Range</A></H2>
<P>In the interactive Bead List Resample, the first value in the "X range"
field is lower bound for the x coordinate of markers included in the
output, and the second value in the same field is the upper bound for the x
coordinate of markers included in the output.  If the "All" toggle button
immediately adjacent "X range" field is on, the values in the field are
ignored and no restrictions are enforced on the x coordinates of the markers.
The "Y range" controls function similarly but control the range of y
coordinates accepted.

<P><A HREF="#tfbl">Return to overview</A>
<HR>

<H2><A NAME="XYOffset">XY Offset</A></H2>
<P>The value in the "X offset" field is added to each x coordinate before
scaling by the pixel spacing ratio and writing the transformed coordinate
to the output list.  In a similar fashion, the value in the "Y offset field"
is added to each y coordinate.

<P><A HREF="#tfbl">Return to overview</A>
<HR>

<H2><A NAME="CommandLine">Command Line</A></H2>
<P>A command-line application, tfbl, provides the same operations as
the interactive Bead List Resample.  To reproduce the example from the
<A HREF="#tfbl">overview</A> (calculate a bead list, a.sl2, from another bead
list, b.sl2, for the tilt series at one-quarter of the resolution), use
<PRE>
     tfbl b.sl2 -ratio=4 -out=a.sl2
</PRE>
<P>The full command-line syntax is (optional parts are shown in braces; parts
to be replaced with a value appropriate for your case are shown in italics):

<PRE>
    tfbl <VAR>input_file</VAR> [-ratio=<VAR>r</VAR>] \
        [-istart=<VAR>is</VAR>] [-iend=<VAR>ie</VAR>] [-istep=<VAR>ii</VAR>] \
        [-ostart=<VAR>os</VAR>] [-ostep=<VAR>oi</VAR>] \
        [-out=<VAR>out_name</VAR>] [-nv=<VAR>count</VAR>] [-xrange=l[:u]] \
        [-yrange=l[:u]] [-xoff=o] [-yoff=o]
</PRE>

<DL>
  <DT><VAR>input_file</VAR><DD>Is the name of the input marker list.
    If the name is - (a single hyphen), tfbl reads the marker list from
    standard input.
  <DT><CODE>-ratio=</CODE><VAR>r</VAR><DD>Sets the ratio, <VAR>r</VAR>, of the
    x pixel spacing assumed for the input marker list to the x  pixel spacing
    assumed for the output marker list.  tfbl assumes that the ratio of the y
    pixel spacings is also <VAR>r</VAR>.  If you do not specify a pixel
    spacing ratio, tfbl assumes the ratio is one.
  <DT><CODE>-istart=</CODE><VAR>is</VAR><DD>Sets the zero-based index for the
    first projection to use from the input marker list.  If you do not
    specify the first projection to use, tfbl will start from projection zero.
  <DT><CODE>-iend=</CODE><VAR>ie</VAR><DD>Sets the zero-based index for the
    last projection to use from the input marker list.  If you do not specify
    the last projection to use, tfbl will end with the highest projection
    index in the input marker list.
  <DT><CODE>-istep=</CODE><VAR>ii</VAR><DD>Sets the index increment between
    adjacent projections to use from the input marker list.  <VAR>ii</VAR>
    must not be zero.  If you do not specify an increment, tfbl uses an
    increment of one.
  <DT><CODE>-ostart=</CODE><VAR>os</VAR><DD>Sets the destination projection
    in the output for the starting projection that you selected with
    <CODE>-istart</CODE>.  <VAR>os</VAR> is the zero-based index of the
    destination projection.  If you do not set the destination projection,
    tfbl assumes that the destination is projection zero in the output.
  <DT><CODE>-ostep=</CODE><VAR>oi</VAR><DD>Sets the increment between
    destination projections for adjacent projections taken from input marker
    list.  If you do not set the destination increment, tfbl uses an increment
    of one.
  <DT><CODE>-out=</CODE><VAR>name</VAR><DD>Sets the name of the file to
    create for the output marker list.  If you use this option more
    than once, only the last has any effect.  If you do not specify the name
    of the output file, tfbl writes the generated marker list to standard
    output.
  <DT><CODE>-nv=</CODE><VAR>count</VAR><DD>If the input marker list is a
    matched list (.sl), sets the total number of projections (which will
    be numbered from 0 to <VAR>count</VAR>-1) in the output marker list.  Has
    no effect if the input marker list is not matched.  If you do not set the
    number of output projections for a matched list, tfbl uses the smallest
    number that will accommodate the destination projections for the
    projections selected from the input marker list.
  <DT><CODE>-xrange=</CODE><VAR>l</VAR>[<CODE>:</CODE><VAR>u</VAR>]<DD>
    Sets the range of x coordinates accepted from the input marker lists.
    Markers whose x coordinate is less than <VAR>l</VAR> or greater than
    <VAR>u</VAR> will not be included in the output marker list.  If you
    do not specify <VAR>u</VAR>, tfbl does not place an upper limit on
    the x coordinate value.  If you do not set the x range, tfbl does not
    restrict the x coordinates at all.
  <DT><CODE>-yrange=</CODE><VAR>l</VAR>[<CODE>:</CODE><VAR>u</VAR>]<DD>
    Sets the range of y coordinates accepted from the input marker lists.
    Markers whose y coordinate is less than <VAR>l</VAR> or greater than
    <VAR>u</VAR> will not be included in the output marker list.  If you
    do not specify <VAR>u</VAR>, tfbl does not place an upper limit on
    the y coordinate value.  If you do not set the x range, tfbl does not
    restrict the y coordinates at all.
  <DT><CODE>-xoff=</CODE><VAR>o</VAR><DD>Sets the value, <VAR>o</VAR>, added
    to each x coordinate before scaling by the pixel spacing ratio.  If you
    do not specify an offset for the x coordinate, tfbl uses an offset of
    zero.
  <DT><CODE>-yoff=</CODE><VAR>o</VAR><DD>Sets the value, <VAR>o</VAR>, added
    to each y coordinate before scaling by the pixel spacing ratio.  If you
    do not specify an offset for the y coordinate, tfbl uses an offset of
    zero.
</DL>

</BODY>
</HTML>
