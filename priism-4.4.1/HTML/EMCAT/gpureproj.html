<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
  <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <TITLE>Priism Help: gpureproj</TITLE>
  <META NAME="Description" CONTENT="On-line help for a command-line application for reprojecting (with GPU acceleration) a 3D reconstruction to form a single-axis tilt series.">
  <META NAME="Keywords" CONTENT="Priism,EM,tomography,reprojection">
  <LINK REV=MADE HREF="mailto:ive@msg.ucsf.edu">
</HEAD>
<BODY>

<H1><A NAME="gpureproj">gpureproj</A></H1>
<H2>Overview</H2>

<P>gpureproj is a command-line application that takes a 3D reconstruction and
a model tilt series and generates another tilt series which is a reprojection
of the 3D reconstruction and has the same tilt angles as the model tilt series.
The x and y dimensions of the generated tilt series are the same as the x and y
dimensions of the reconstruction.  gpureproj is basically the same as
<A HREF="reproj.html">reproj</A> but uses one or more servers with graphics
cards to perform the projection calculations and expects the input
reconstruction to be stored in xyz order rather than the xzy order expected
by reproj. The command-line syntax for gpureproj is (optional parts are in
brackets)

<PRE>
    <CODE>rgemt_autostart</CODE> <VAR>recon_name</VAR> <VAR>model_series_name</VAR> <VAR>series_name</VAR> [-missingx=xhw:xpos] [-missingz=zhw:zpos] [-nomissing] [-res=i] [-rscale=i] [-multires] [-server=address [-server=address ...]] <CODE>-rgemt_client=gpureproj</CODE> [rgemt_autostart_options]
</PRE>

<P>or

<PRE>
    <CODE>gpureproj</CODE> <VAR>recon_name</VAR> <VAR>model_series_name</VAR> <VAR>series_name</VAR> [-missingx=xhw:xpos] [-missingz=zhw:zpos] [-nomissing] [-res=i] [-rscale=i] [-multires] [-server=address [-server=address ...]]
</PRE>

<P>The first form can start and stop the server software which communicates
with the graphics cards; it also has options to better integrate with queueing
software.  The
<A HREF="Parallel.html#GPUParallel">"GPU Parallel Settings" topic</A> in
<A HREF="Parallel.html">Parallel.html</A> describes how to use rgemt_autostart
and the options it takes.  The second form assumes that the server software,
used to communicate with the graphics cards, is already running.

<P>The three arguments to gpureproj are

<DL>
  <DT><VAR>recon_name</VAR><DD>Is the name of the MRC file containing the 3D
    reconstruction.  The reconstruction is assumed to be in the orientation
    (xyz) generated by Priism's <A HREF="GPURECON.html">gpurecon</A> module.
  <DT><VAR>model_series_name</VAR><DD>Is the name of the MRC file containing
    the model tilt series.  gpureproj only uses the header of this file.
  <DT><VAR>series_name</VAR><DD>Is the name of the MRC file that gpureproj will
    generate.  gpureproj will not work correctly if <VAR>series_name</VAR>
    refers to the same file as <VAR>model_series_name</VAR>.
</DL>

<P>The seven options for gpureproj are

<DL>
  <DT><CODE>-missingx=</CODE><VAR>xhw</VAR><CODE>:</CODE><VAR>xpos</VAR><DD>By
    default, gpureproj assumes that the reconstruction is part of a uniform
    slab.  gpureproj then rescales the reprojection result from the
    reconstruction to account for the material beyond the reconstruction bounds
    Use -missingx to change the half width in x of the slab to be
    <VAR>xhw</VAR> and the x position of the slab's center to be
    <VAR>xpos</VAR>.  Both are in units of the reconstruction samples.  The
    position is relative to the reconstruction sample coordinate, 0.5 *
    reconstruction_x_size.  By default, the slab's half width in x is 1e38
    before accounting for resolution factors, and its position is zero.
    <CODE>-nomissing</CODE> overrides the effect of this option.
  <DT><CODE>-missingz=</CODE><VAR>zhw</VAR><CODE>:</CODE><VAR>zpos</VAR><DD>Is
    like <CODE>-missingx</CODE> but sets the half width and center position of
    the slab in z.  The units for both are reconstruction samples, and the
    position is relatvie to the reconstruction sample coordinate,
    0.5 * reconstruction_z_size.  By default, the slab's half width in z,
    after accounting for resolution factors, is one half of the reconstruction
    z size, and its position is zero.
    <CODE>-nomissing</CODE> overrides the effect of this option.
  <DT><CODE>-nomissing</CODE><DD>Causes gpureproj to assume that there is
    no material beyond the bounds of the reconstruction.  This option overrides
    the effects of <CODE>-missingx</CODE> and <CODE>-missingz</CODE>.
  <DT><CODE>-res=</CODE><VAR>i</VAR><DD>Causes gpureproj to read from the
    <VAR>i</VAR>th resolution of the reconstruction.  <VAR>i</VAR> must
    be a non-negative integer less than the number of resolutions in the
    reconstruction.  If you do not specify the -res option, reproj will use
    the highest resolution (i.e. act as if you gave it the option -res=0).
  <DT><CODE>-rscale=</CODE><VAR>i</VAR><DD>gpureproj will divide the half
    widths and positions set via <CODE>-missingx</CODE> and
    <CODE>-missingz</CODE> by <VAR>i</VAR>.  <VAR>i</VAR> must be a positive
    integer.  You would normally use this option if the input reconstruction
    was computed at a lower resolution, but you specified the slab
    characteristics for a higher resolution (usually so that you could switch
    resolutions and only change <CODE>-rscale</CODE> or <CODE>-res</CODE>
    options without changing all of the other options that depend on the
    resolution).  By default, <VAR>i</VAR> will be two raised to an exponent
    equal to the resolution level, as set by <CODE>-res</CODE>.
  <DT><CODE>-multires</CODE><DD>Causes gpureproj to add lower resolutions to
    the generated tilt series if the x and y dimensions are sufficiently large.
    If you do not specify this option, gpureproj will generate a tilt series
    with a single resolution.
  <DT><CODE>-server=</CODE><VAR>address</VAR><DD>Specifies the name of a
    server to use.  You can use multiple -server options to have the
    calculations performed on more than one server.  If you do not specify
    any -server options, gpureproj will look at the environment variable
    RGEMT_SERVER_LIST.  The value of the variable should be a comma-separated
    list of the addresses to use.  If you use
    <A HREF="Parallel.html#GPUParallel">rgemt_autostart</A>, keep in mind that
    it, depending on what options you use, can override any servers you set
    with <CODE>-server</CODE> options.  An address is usually just the host
    name (for instance, msg.ucsf.edu) or IP number (for instance,
    169.230.30.46) of the server to contact.  If the server does not use the
    default port number, 20248, you should add a colon followed by the port
    number to use at the end of the address (as an example, msg.usf.edu:20000,
    would contact port 20000 on msg.ucsf.edu).  The address may also contain a
    specification of the protocol to use immediately before the host name or
    IP number.  Currently one protocol is understood:
    <DL>
      <DT>rgemt1://<DD>This protocol routes all communication between the
        client and server over a single TCP connection.  This is the default
        protocol when the address does not include a protocol specification.
    </DL>
</DL>

<H2>Related Priism Topics</H2>
<P>
  <A HREF="../Priism.html">Priism</A> |
  <A HREF="ReconCoordSys.html">Reconstruction coordinate system</A> |
  <A HREF="Parallel.html#GPUParallel">rgemt_autostart</A> |
  <A HREF="GPURECON.html">gpurecon</A> |
  <A HREF="EMTIARGPU.html">Iterative alignment + reconstruction</A> |
  <A HREF="RAGPU.html">Refine alignment</A>
<HR>

</BODY>
</HTML>
