<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
  <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <TITLE>Priism Help: Rotate3D</TITLE>
  <META NAME="Description" CONTENT="On-line help for Priism's application to reorient or resample a data set.">
  <META NAME="Keywords" CONTENT="Priism">
  <LINK REV=MADE HREF="mailto:ive@msg.ucsf.edu">
</HEAD>
<BODY>

<H1><A NAME="Rotate3D">Rotate3D</A></H1>
<H2>Overview</H2>

<P>Rotate3D can reorient an input image arbitrarily in 3D. It can also
resample the data to a finer or coarser grid.  Quadratic interpolation
is used to determine the output values.

<H3>Topics</H3>
<P>
  Overview |
  <A HREF="Region.html">Region processing</A> |
  <A HREF="#Angle">Angle</A> |
  <A HREF="#PixelSize">Pixel size</A> |
  <A HREF="#OutputDimensions">Output dimensions</A> |
  <A HREF="#RotationCenter">Rotation center</A> |
  <A HREF="#Translation">Translation</A> |
  <A HREF="#FillValue">Fill value</A> |
  <A HREF="#RolloffDistance">Rolloff distance</A> |
  <A HREF="#CommandLine">Command line</A>

<H3>Related Priism Topics</H3>
<P>
   <A HREF="Priism.html">Priism</A> |
   <A HREF="Flip.html">Flip</A> |
   <A HREF="Resample2D.html">Resample2D</A>
<HR>

<H2><A NAME="Angle">Angle</A></H2>
<P>The three values in this field in the main menu are the rotation
angles applied to the x'', y', and z coordinate axes.  As suggested by the
primes, The order in which the rotations are applied is the opposite of the
order in which the values are listed in the field: the first rotation is about
z and the last rotation is about the rotated x axis.

<P>The angles are assumed to be in degrees.  The sign convention is:
<UL>
  <LI>A positive value for the z angle rotates the positive y axis towards
    the positive x axis.
  <LI>A positive value for the y angle rotates the positive x' axis (modified
    by the first rotation) towards the positive z axis.
  <LI>A positive value to the x angle rotates the positive z' axis towards
    the positive y' axis.
</UL>
<P>When only rotating about the z axis, this sign convention is opposite
of that used in <A HREF="Resample2D.html">Resample2D</A>.

<P>The point which remains fixed during the rotation is set by the
<A HREF="#RotationCenter">rotation center controls</A> in the
<EM>Options Menu</EM>.  By default, it is the geometric center of the
selected input region.

<H3>Topics</H3>
<P>
  <A HREF="#Rotate3D">Overview</A> |
  <A HREF="Region.html">Region processing</A> |
  Angle |
  <A HREF="#PixelSize">Pixel size</A> |
  <A HREF="#OutputDimensions">Output dimensions</A> |
  <A HREF="#RotationCenter">Rotation center</A> |
  <A HREF="#Translation">Translation</A> |
  <A HREF="#FillValue">Fill value</A> |
  <A HREF="#RolloffDistance">Rolloff distance</A> |
  <A HREF="#CommandLine">Command line</A>
<HR>

<H2><A NAME="PixelSize">Pixel size</A></H2>
<P>This field in the main menu controls the x, y, and z pixel
spacings for the output volume.  The units are the same as the units
on the pixel spacings for the input data.  When a new input data set
is selected, the pixel spacings in the field are updated to be the
same as the input pixel spacings.

<H3>Topics</H3>
<P>
  <A HREF="#Rotate3D">Overview</A> |
  <A HREF="Region.html">Region processing</A> |
  <A HREF="#Angle">Angle</A> |
  Pixel size |
  <A HREF="#OutputDimensions">Output dimensions</A> |
  <A HREF="#RotationCenter">Rotation center</A> |
  <A HREF="#Translation">Translation</A> |
  <A HREF="#FillValue">Fill value</A> |
  <A HREF="#RolloffDistance">Rolloff distance</A> |
  <A HREF="#CommandLine">Command line</A>
<HR>

<H2><A NAME="OutputDimensions">Output dimensions</A></H2>
<P>The x, y, and z sizes of the output file are set by two controls
in the <EM>Options Menu</EM>.  The first is the <EM>Autosize</EM> toggle.
When it is on, the output size is such that the full volume of the input
region is included in the output file.  When it is off, you can use the
second control, the text field just below the toggle, to directly set
the x, y, and z sizes.  By default, the <EM>Autosize</EM> toggle is on.

<H3>Topics</H3>
<P>
  <A HREF="#Rotate3D">Overview</A> |
  <A HREF="Region.html">Region processing</A> |
  <A HREF="#Angle">Angle</A> |
  <A HREF="#PixelSize">Pixel size</A> |
  Output dimensions |
  <A HREF="#RotationCenter">Rotation center</A> |
  <A HREF="#Translation">Translation</A> |
  <A HREF="#FillValue">Fill value</A> |
  <A HREF="#RolloffDistance">Rolloff distance</A> |
  <A HREF="#CommandLine">Command line</A>
<HR>

<H2><A NAME="RotationCenter">Rotation center</A></H2>
<P>The rotation center is the point which remains fixed during the rotation,
and, unless a non-zero <A HREF="#Translation">translation is applied</A>, it
is the point at the center of the output volume.

<P>If the input region has only one wavelength and one time point, you
can turn the <EM>Use center of intensity</EM> toggle on in the
<EM>Options Menu</EM> to have the rotation center be located at the center
of intensity of the input volume.  Otherwise, the x, y, and z coordinates of
the rotation center are shown in the text field just below the toggle and can
be changed.  The coordinate system used has (0, 0, 0) at one corner of a z
stack in the input source and (nx, ny, nz) at the opposite corner where nx,
ny, and nz are the full dimensions of the input source (i.e. not necessarily
the dimensions of the region to process).  The lower lefthand corner of the
ith z section (i running from 0 to nz - 1) in the input source is at
(0, 0, i - 0.5).

<P>Whenever a new region or file is selected, the rotation center is
reset to the geometric center of the new region.

<H3>Topics</H3>
<P>
  <A HREF="#Rotate3D">Overview</A> |
  <A HREF="Region.html">Region processing</A> |
  <A HREF="#Angle">Angle</A> |
  <A HREF="#PixelSize">Pixel size</A> |
  <A HREF="#OutputDimensions">Output dimensions</A> |
  Rotation center |
  <A HREF="#Translation">Translation</A> |
  <A HREF="#FillValue">Fill value</A> |
  <A HREF="#RolloffDistance">Rolloff distance</A> |
  <A HREF="#CommandLine">Command line</A>
<HR>

<H2><A NAME="Translation">Translation</A></H2>
<P>The translation field in the <EM>Options Menu</EM> sets the x, y,
and z displacement of the center of the output volume from the
<A HREF="#RotationCenter">rotation center</A>.  The displacements are
measured in units of output pixels.

<H3>Topics</H3>
<P>
  <A HREF="#Rotate3D">Overview</A> |
  <A HREF="Region.html">Region processing</A> |
  <A HREF="#Angle">Angle</A> |
  <A HREF="#PixelSize">Pixel size</A> |
  <A HREF="#OutputDimensions">Output dimensions</A> |
  <A HREF="#RotationCenter">Rotation center</A> |
  Translation |
  <A HREF="#FillValue">Fill value</A> |
  <A HREF="#RolloffDistance">Rolloff distance</A> |
  <A HREF="#CommandLine">Command line</A>
<HR>

<H2><A NAME="FillValue">Fill value</A></H2>
<P>In the output volume, points which map to back to points outside of the
input and more than the <A HREF="#RolloffDistance">rolloff distance</A> from
the input volume's edges, are filled with a fixed value.  When the
<EM>Use perimeter average</EM> toggle in the <EM>Options Menu</EM> is on,
this fill value is the average of the pixel values from the perimeter of the
input volume.  When that toggle is off, the value shown just below it is
used.  The value may be complex; the imaginary component is only used when
the output data is complex.

<H3>Topics</H3>
<P>
  <A HREF="#Rotate3D">Overview</A> |
  <A HREF="Region.html">Region processing</A> |
  <A HREF="#Angle">Angle</A> |
  <A HREF="#PixelSize">Pixel size</A> |
  <A HREF="#OutputDimensions">Output dimensions</A> |
  <A HREF="#RotationCenter">Rotation center</A> |
  <A HREF="#Translation">Translation</A> |
  Fill value |
  <A HREF="#RolloffDistance">Rolloff distance</A> |
  <A HREF="#CommandLine">Command line</A>
<HR>

<H2><A NAME="RolloffDistance">Rolloff distance</A></H2>
<P>In the output volume, points which map back to points that are outside
of the input volume but which are within the rolloff distance of the
input volume's edges have their values calculated from a linearly weighting
of the <A HREF="#FillValue">fill value</A> and the value interpolated at
the closest point which maps back to a point in the input volume.

<P>The rolloff distance is measured in the same units as are used for
the input data's pixel spacing.  The interpolation algorithm employed is more
efficient (~25%) when the rolloff distance is zero.

<H3>Topics</H3>
<P>
  <A HREF="#Rotate3D">Overview</A> |
  <A HREF="Region.html">Region processing</A> |
  <A HREF="#Angle">Angle</A> |
  <A HREF="#PixelSize">Pixel size</A> |
  <A HREF="#OutputDimensions">Output dimensions</A> |
  <A HREF="#RotationCenter">Rotation center</A> |
  <A HREF="#Translation">Translation</A> |
  <A HREF="#FillValue">Fill value</A> |
  Rolloff distance |
  <A HREF="#CommandLine">Command line</A>
<HR>

<H2><A NAME="CommandLine">Command Line</A></H2>
<P>Rotate3D accepts the command-line arguments described in
<A HREF="Region.html#COMMANDLINE">Region.html</A>.  In addition, it also
has the following options (optional parts are show in brackets):

<DL>
  <DT><CODE>-ang=</CODE><VAR>xrot</VAR>[<CODE>:</CODE><VAR>yrot</VAR>[<CODE>:</CODE><VAR>zrot</VAR>]]
  <DD>Specifies the rotation angles, in degrees, about the x'', y', and z
    coordinate axes.  Consult the <A HREF="#Angle">Angle topic</A> for details
    about the order of rotations and the sign conventions.  If you do not
    specify <CODE>-ang</CODE> on the command line, Rotate3D will not apply a
    rotation to the input data.  If you omit <VAR>yrot</VAR> and
    <VAR>zrot</VAR> or just <VAR>zrot</VAR>, Rotate3D assumes rotation angles
    of 0 for the omitted values.

  <DT><CODE>-delo=</CODE><VAR>xdel</VAR>[<CODE>:</CODE><VAR>ydel</VAR>[<CODE>:</CODE><VAR>zdel</VAR>]]
  <DD>Specifies the pixel spacing for the output.  If you do not specify
    <CODE>-delo</CODE> on the command line, Rotated3D will use the pixel
    spacings from the input data for the output data.  If you omit
    <VAR>ydel</VAR> and <VAR>zdel</VAR> or just <VAR>zdel</VAR>, Rotate3D uses
    the corresponding pixel spacings from the input data.

  <DT><CODE>-out=</CODE><VAR>nx</VAR>[<CODE>:</CODE><VAR>ny</VAR>[<CODE>:</CODE><VAR>nz</VAR>]]
  <DD>Specifies the x, y, and z dimensions for the output. If you do not
    specify <CODE>-out</CODE> on the command line or omit the trailing
    dimensions, then Rotate3D computes the minimum dimensions necessary to
    hold the transformed input region and uses the components of the minimum
    dimensions to fill in the missing values.

  <DT><CODE>-cenxyz=</CODE><VAR>xcen</VAR>[<CODE>:</CODE><VAR>ycen</VAR>[<CODE>:</CODE><VAR>zcen</VAR>]]
  <DD>Specifies the pixel coordinates, relative to the entire input data set,
    for the center of rotation.  If you do not specify <CODE>-cenxyz</CODE>
    on the command line or omit the coordinates for the trailing dimensions,
    Rotate3D uses the coordinates of the geometric center of the input region
    to replace the missing values.  If you also specify <CODE>-cofi</CODE> on
    the command line, Rotate3D ignores the values supplied with
    <CODE>-cenxyz</CODE>.

  <DT><CODE>-cofi</CODE>
  <DD>Specifies that Rotate3D should rotate the input data about its center
    of intensity.  You may only use this option if the input region has
    one wavelength and one time point.

  <DT><CODE>-tran=</CODE><VAR>xoff</VAR>[<CODE>:</CODE><VAR>yoff</VAR>[<CODE>:</CODE><VAR>zoff</VAR>]]
  <DD>Specifies a displacement, measured in units of output pixels, of the
    geometric center of the output volume from the center of rotation.  If
    you do not specify <CODE>-tran</CODE> on the command line, the geometric
    center of the output volume is the same as the center of rotation.  If
    you omit the displacements for the trailing dimensions, Rotate3D assumes
    displacements of zero for the missing values.

  <DT><CODE>-fill=</CODE><VAR>real_part</VAR>[<CODE>:</CODE><VAR>imag_part</VAR>]
  <DD>Specifies the value Rotate3D uses to fill parts of the output volume
    which map back to areas that are more than the rolloff distance beyond
    the boundaries of the input volume.  If you do not specify
    <CODE>-fill</CODE> or <CODE>-perim</CODE> on the command line, Rotate3D
    uses zero as the fill value.  You may omit <VAR>imag_part</VAR>; if you
    do so, Rotate3D uses a assumes that the fill value as an imaginary
    component of zero.  Rotate3D ignores <CODE>-fill</CODE> if you specify
    <CODE>-perim</CODE>.

  <DT><CODE>-perim</CODE>
  <DD>Specifies that Rotate3D should use the average edge intensity from
    the input region to fill the parts of the output volume
    which map back to areas that are more than the rolloff distance beyond
    the boundaries of the input volume.

  <DT><CODE>-roll_dist=</CODE><VAR>r</VAR>
  <DD>Specifies the rolloff distance (see the
    <A HREF="#RolloffDistance">Rolloff distance topic</A> for details).
    If you do not specify <CODE>-roll_dist</CODE> on the command line,
    Rotate3D assumes a rolloff distance of zero.
</DL>

<P>As an example the command-line below rotates the in.dat by 15 degrees
about the y axis and then 5 degrees about the rotated x axis.  Along with
the rotation it resamples the data to a grid with a uniform pixel spacing
of .1.  The result is written to out.dat.

<PRE>
    Rotate3D in.dat out.dat -ang=5:15:0 -delo=.1:.1:.1
</PRE>

<H3>Topics</H3>
<P>
  <A HREF="#Rotate3D">Overview</A> |
  <A HREF="Region.html">Region processing</A> |
  <A HREF="#Angle">Angle</A> |
  <A HREF="#PixelSize">Pixel size</A> |
  <A HREF="#OutputDimensions">Output dimensions</A> |
  <A HREF="#RotationCenter">Rotation center</A> |
  <A HREF="#Translation">Translation</A> |
  <A HREF="#FillValue">Fill value</A> |
  <A HREF="#RolloffDistance">Rolloff distance</A> |
  Command line
<HR>

</BODY>
</HTML>
