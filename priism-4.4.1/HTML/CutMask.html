<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
  <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <TITLE>Priism Help: Cut Mask</TITLE>
  <META NAME="Description" CONTENT="On-line help for Cut Mask.">
  <META NAME="Keywords" CONTENT="Priism,polygon,mask,cutout">
  <LINK REV=MADE HREF="mailto:ive@msg.ucsf.edu">
</HEAD>
<BODY>

<H1><A NAME="CutMask">Cut Mask</A></H1>
<H2>Overview</H2>
<P>Cut Mask takes an existing image data set and masks out regions to
generate a new data set.  The regions masked out are controlled
by a <A HREF="#Threshold">threshold</A> and a
<A HREF="#PolygonData">polygon list</A> created with
<A HREF="EditPolygon.html">Edit Polygon</A>,
<A HREF="2DObjFinder.html">2D Object Finder</A>, or
<A HREF="FPPolygons.html">FPPolygons</A>.  The masking can be done in one
of two ways:

<UL>
  <LI>A binary mask is generated where the regions to be masked out are set
    to zero and the rest is set to one.  Use the <EM>Mask</EM>
    <A HREF="#CreateMode">mode option</A> to get this behavior.
  <LI>The regions to be masked out are set to the first wavelength's minimum
    data value and the rest is unmodified.  Use the <EM>Data</EM> mode option
    to get this behavior.
</UL>

<H3>Topics</H3>
<P>
  Overview |
  <A HREF="#PolygonData">Polygon data</A> |
  <A HREF="#ZWT">Z, W, T</A> |
  <A HREF="#CreateMode">Mode</A> |
  <A HREF="#Area">Area</A> |
  <A HREF="#Threshold">Threshold</A> |
  <A HREF="#TrimOutput">Cut small</A> |
  <A HREF="#Rolloff">Rolloff</A>
 
<H3>Related Priism Topics</H3>
<P>
  <A HREF="EditPolygon.html">Edit Polygon</A> |
  <A HREF="2DObjFinder.html">2D Object Finder</A> |
  <A HREF="FPPolygons.html">FPPolygons</A> |
  <A HREF="Priism.html">Priism</A>
<HR>

<H2><A NAME="PolygonData">Polygon Data</A></H2>
<P>To specify the polygon data to be used, you must first specify the
data set to be masked by either pressing the <EM>Image file</EM> button to open
a file selection dialog or directly entering into the adjacent field the
window number or file name.  If the image data is from a window, Cut Mask
will detect if there are polygons loaded already and use those by default.
If the input is from a file or if a different set of polygons is desired for
a window, select the polygon list file by pressing the <EM>Polygon data</EM>
button to open a file selection dialog or enter the file name directly in the
adjacent field.

<P>When a new polygon list is chosen and there is already polygons loaded,
you will be prompted whether the new polygons should be appended to the current
list or should replace the current list.

<H3>Topics</H3>
<P>
  <A HREF="#CutMask">Overview</A> |
  Polygon data |
  <A HREF="#ZWT">Z, W, T</A> |
  <A HREF="#CreateMode">Mode</A> |
  <A HREF="#Area">Area</A> |
  <A HREF="#Threshold">Threshold</A> |
  <A HREF="#TrimOutput">Cut small</A> |
  <A HREF="#Rolloff">Rolloff</A>
<HR> 

<H2><A NAME="ZWT">Z, W, T</A></H2>
<P>Use the <EM>Z</EM>, <EM>W</EM>, <EM>T</EM> controls to restrict the
range of z sections, time points, and wavelengths that are processed from
the source data set.  For z and time, the range is specified by three
values: the starting index, the final index, and an increment.  For the
wavelengths, there is a toggle button per wavelength, and if the toggle is
on, the wavelength will be processed.

<P>When an input data set is selected, the z and time ranges and the
wavelength toggles are updated to cover the entire data set.  As a shortcut
to restore the controls to settings that cover the entire input data set,
press the <EM>set all</EM> button.

<H3>Topics</H3>
<P>
  <A HREF="#CutMask">Overview</A> |
  <A HREF="#PolygonData">Polygon data</A> |
  Z, W, T |
  <A HREF="#CreateMode">Mode</A> |
  <A HREF="#Area">Area</A> |
  <A HREF="#Threshold">Threshold</A> |
  <A HREF="#TrimOutput">Cut small</A> |
  <A HREF="#Rolloff">Rolloff</A>
<HR> 

<H2><A NAME="CreateMode">Mode</A></H2>
<P>Use the <EM>Mode</EM> option menu to control how the input data is
masked to generate the output.  There are two available options:

<DL>
  <DT>Mask<DD>Points in the input which are to be masked out (based on
    the <A HREF="#PolygonData">polygon list</A>, <A HREF="#Area">area
    setting</A>, and <A HREF="#Threshold">threshold</A>) are set to zero.
    Points in the input which are not masked out are set to one if the
    input data set is real-valued or 1 + i if the input data set is
    complex-valued.
  <DT>Data<DD>Points in the input which are to be masked out are
    set to the first wavelength's minimum data value if the input data set is
    real-valued (the minimum is read from the header of the input data set and
    is not recalculated) or zero if the input data set is complex-valued.  For
    points which are masked out, the value from the input data set is
    preserved.
</DL>

<P>If the <A HREF="#Rolloff">rolloff option</A> is enabled, points in the
masked out region near an masked-unmasked boundary will have their values
modified; consult the description of the rolloff option for details.

<H3>Topics</H3>
<P>
  <A HREF="#CutMask">Overview</A> |
  <A HREF="#PolygonData">Polygon data</A> |
  <A HREF="#ZWT">Z, W, T</A> |
  Mode |
  <A HREF="#Area">Area</A> |
  <A HREF="#Threshold">Threshold</A> |
  <A HREF="#TrimOutput">Cut small</A> |
  <A HREF="#Rolloff">Rolloff</A>
<HR> 

<H2><A NAME="Area">Area</A></H2>
<P>If the <EM>Area</EM> option is set to <EM>Inside</EM>, the masked
out points are those which are outside any of the polygons in the
<A HREF="#PolygonData">polygon list</A> or those which are inside one or
more of the polygons but which have intensity levels below the
<A HREF="#Threshold">intensity threshold</A>.  If the <EM>Area</EM> option
is set to <EM>Outside</EM>, the masked out points are those which are inside
one or more of the polygons and which have intensity values greater than or
equal to the intensity threshold.

<H3>Topics</H3>
<P>
  <A HREF="#CutMask">Overview</A> |
  <A HREF="#PolygonData">Polygon data</A> |
  <A HREF="#ZWT">Z, W, T</A> |
  <A HREF="#CreateMode">Mode</A> |
  Area |
  <A HREF="#Threshold">Threshold</A> |
  <A HREF="#TrimOutput">Cut small</A> |
  <A HREF="#Rolloff">Rolloff</A>
<HR> 

<H2><A NAME="Threshold">Threshold</A></H2>
<P>If the input data set is real-valued, a point falling inside a polygon
in the <A HREF="#PolygonData">polygon list</A> will have its value compared
to the threshold level to determine whether the point is to be masked out
or not (see the description of the <A HREF="#Area">area option</A> for
details).  For complex-valued data, the threshold is ignored and the
polygon list is the only factor that determines whether or not a point is
masked out.

<P>When a new input data set is chosen, the threshold is reset to the
minimum data value for the first wavelength, as recorded in the header
of the input data set.

<H3>Topics</H3>
<P>
  <A HREF="#CutMask">Overview</A> |
  <A HREF="#PolygonData">Polygon data</A> |
  <A HREF="#ZWT">Z, W, T</A> |
  <A HREF="#CreateMode">Mode</A> |
  <A HREF="#Area">Area</A> |
  Threshold |
  <A HREF="#TrimOutput">Cut small</A> |
  <A HREF="#Rolloff">Rolloff</A>
<HR> 

<H2><A NAME="TrimOutput">Cut small</A></H2>
<P>If the <EM>cut small</EM> toggle is not on, the generated data set
has the same x and y dimensions as the input data set.  If the toggle is on,
the x and y dimensions are set to be the smallest such that all polygons
in the polygon list are enclosed.

<H3>Topics</H3>
<P>
  <A HREF="#CutMask">Overview</A> |
  <A HREF="#PolygonData">Polygon data</A> |
  <A HREF="#ZWT">Z, W, T</A> |
  <A HREF="#CreateMode">Mode</A> |
  <A HREF="#Area">Area</A> |
  <A HREF="#Threshold">Threshold</A> |
  Cut small |
  <A HREF="#Rolloff">Rolloff</A>
<HR> 

<H2><A NAME="Rolloff">Rolloff</A></H2>
<P>If the <EM>rolloff</EM> toggle is on, the values at masked out points
near a masked-unmasked boundary are modified to smooth the variation in
intensity between unmasked and masked regions.  The smoothing is performed
as follows:

<OL>
  <LI>Given a masked out point, compute the distance, <VAR>d</VAR>, from the
    nearest unmasked point in the same section.
  <LI>If <VAR>d</VAR> is less than 5 pixels, the value at the masked out point
    is changed to <VAR>o</VAR> + <VAR>d</VAR> / 5 * (<VAR>m</VAR> -
    <VAR>o</VAR>).  If the <EM>Mask</EM> <A HREF="#CreateMode">mode option</A>
    is used, <VAR>o</VAR> is one if the input data is real-valued or
    1 + i if the input data is complex-valued, and <VAR>m</VAR> is zero.
    If the <EM>Data</EM> mode option is used, <VAR>o</VAR> is the value at
    the point in the input data set and <VAR>m</VAR> is the value used for
    masked out points (the first wavelength minimum value for real-valued
    data and zero for complex-valued data).
</OL>

<H3>Topics</H3>
<P>
  <A HREF="#CutMask">Overview</A> |
  <A HREF="#PolygonData">Polygon data</A> |
  <A HREF="#ZWT">Z, W, T</A> |
  <A HREF="#CreateMode">Mode</A> |
  <A HREF="#Area">Area</A> |
  <A HREF="#Threshold">Threshold</A> |
  <A HREF="#TrimOutput">Cut small</A> |
  Rolloff
<HR> 

</BODY>
</HTML>
