<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
  <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <TITLE>Reference: IVEDestroyEventContext</TITLE>
  <META NAME="Author" CONTENT="Eric Branlund">
  <META NAME="Description" CONTENT="Defines the behavior of IVEDestroyEventContext.">
  <LINK REV=MADE HREF="mailto:eric@msg.ucsf.edu">
</HEAD>

<BODY>

<H1>Reference: IVEDestroyEventContext</H1>
<H2>Overview</H2>
<P>Destroys a context created by
<A HREF="IVECreateEventContext.html">IVECreateEventContext</A> and
releases any resources associated with it.  If you destroy the event context
from the callback for an event handler, the event handler must not return;
if it does, it will attempt to access the destroyed event context with
undefined results.  With a multi-threaded event context, any threads currently
blocked in calls to <A HREF="IVEEventLoop.html">IVEEventLoop</A> or
<A HREF="IVEProcessEvent.html">IVEProcessEvent</A> when the event context is
destroyed will return from those calls.  Threads which are in an event handler
or in the process of invoking an event handler, must not return or they will
attempt to access the destroyed event context with undefined results.  One
approach for destroying a multi-threaded event context would be to have the
the thread that destroys the context perform the following steps:

<OL>
  <LI>Call
    <A HREF="IVERemoveAllEventTriggers.html">IVERemoveAllEventTriggers</A>.
  <LI>Install a message handler with
    <A HREF="IVESetMessageHandler.html">IVESetMessageHandler</A> whose callback
    routine does not return (causes the thread to exit or whatever...).
  <LI>For each other thread involved in event handling, use
    <A HREF="IVEPostMessage.html">IVEPostMessage</A> to post one message of the
    same type as registered in the previous step.
  <LI>Wait until all the threads in the event handling have invoked the
    message handler.
  <LI>Destroy the event context.
</OL>

<P>That recipe for destroying an event context assumes that your event handlers
rarely make calls to add new event handlers or make calls to remove event
handlers with <A HREF="IVERemoveInput.html">IVERemoveInput</A>,
<A HREF="IVERemoveSignal.html">IVERemoveSignal</A>,
<A HREF="IVERemoveTimer.html">IVERemoveTimer</A>, and
<A HREF="IVERemoveWorkProc.html">IVERemoveWorkProc</A>.  If the event handlers
themselves frequently change the set of event handlers, then you might try
the following recipe:

<OL>
  <LI>The thread which will destroy the context acquires a lock, sets
    a flag to signal that destruction is about to occur, releases the lock,
    ensures that there enough pending events so no threads will remain
    blocked in the event handling
    (<A HREF="IVEPostMessage.html">IVEPostMessage</A> may be convenient for
    that), and then waits for the other threads involved to exit event
    handling.
  <LI>All event handlers are coded to acquire a lock, check the flag for
    pending destruction.  If the flag is not set, the lock is released
    and execution of the event handler proceeds.  If the flag is set, the
    lock is release and a path is taken which is guaranteed not to return.
</OL>

<P>For a multi-threaded event context, it is not safe to destroy the context
from a destructor registered with pthread_key_create().

<H2>Prototype (C)</H2>
<P><CODE>#include "ive_eventloop.h"</CODE>
<BR><CODE>void IVEDestroyEventContext(IVEEventContext context);</CODE>
<H2>Prototype (Fortran)</H2>
<P><CODE>subroutine IVEDestroyEventContext(context)</CODE>
<BR><CODE>integer context</CODE>
<H2>Parameters</H2>
<DL>
  <DT><VAR>context</VAR><DD><VAR>context</VAR> is the context to be destroyed.
</DL>
<H2>Cross references</H2>
<P><A HREF="IVECreateEventContext.html">IVECreateEventContext</A>,
<A HREF="IVEEventLoop.html">IVEEventLoop</A>,
<A HREF="IVEPostMessage.html">IVEPostMessage</A>,
<A HREF="IVEProcessEvent.html">IVEProcessEvent</A>,
<A HREF="IVERemoveInput.html">IVERemoveInput</A>,
<A HREF="IVERemoveSignal.html">IVERemoveSignal</A>,
<A HREF="IVERemoveTimer.html">IVERemoveTimer</A>,
<A HREF="IVESetMessageHandler.html">IVESetMessageHandler</A>, and
<A HREF="IVEEventContext.html">IVEEventContext</A>

<HR>

<P>| <A HREF="Categories.html">categories</A>
   | <A HREF="Alphabetical.html">alphabetical</A>
   |

<HR>

<P>modified September 21, 2007
<ADDRESS>
  Eric Branlund (<A HREF="mailto:eric@msg.ucsf.edu">eric@msg.ucsf.edu</A>)
</ADDRESS>

</BODY>
</HTML>
